# üéØ –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π PID

**5 –º–∏–Ω—É—Ç —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**

---

## üí° –ß—Ç–æ —Ç–∞–∫–æ–µ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π PID?

–≠—Ç–æ **—É–º–Ω—ã–π —Ä–µ–≥—É–ª—è—Ç–æ—Ä** pH –∏ EC, –∫–æ—Ç–æ—Ä—ã–π:

1. ‚úÖ **–ù–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç** –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–∏–∑–∫–æ –∫ target (—ç–∫–æ–Ω–æ–º–∏—è —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤)
2. ‚úÖ **–ú—è–≥–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç** –ø—Ä–∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö
3. ‚úÖ **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç** –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö
4. ‚úÖ **–°–∞–º –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è** –ø–æ–¥ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É
5. ‚úÖ **–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç overdose** (–º–∞–∫—Å –¥–æ–∑–∞ + –∏–Ω—Ç–µ—Ä–≤–∞–ª)

---

## üéØ –ó–æ–Ω—ã —Ä–∞–±–æ—Ç—ã

### –î–ª—è pH (target = 7.0):

```
        DEAD         CLOSE          FAR
    ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí     ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí    ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
6.0  6.9  7.0  7.1  6.7     7.3        8.0
     [–ù–ï –ö–û–†–†–ï–ö–¢–ò–†–£–ï–ú] [–ú–Ø–ì–ö–û] [–ê–ì–†–ï–°–°–ò–í–ù–û]
```

- **DEAD** (6.9-7.1): –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º ‚Üí —ç–∫–æ–Ω–æ–º–∏—è —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤
- **CLOSE** (6.7-7.3): –ú–∞–ª—ã–µ –¥–æ–∑—ã (0.2-0.5 –º–ª)
- **FAR** (<6.7 –∏–ª–∏ >7.3): –ë–æ–ª—å—à–∏–µ –¥–æ–∑—ã (1.0-3.0 –º–ª)

### –î–ª—è EC (target = 2.0):

```
        DEAD          CLOSE           FAR
    ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí      ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí    ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
1.0  1.8  2.0  2.2  1.5      2.5          3.5
     [–ù–ï –ö–û–†–†–ï–ö–¢–ò–†–£–ï–ú]  [–ú–Ø–ì–ö–û]  [–ê–ì–†–ï–°–°–ò–í–ù–û]
```

---

## üõ°Ô∏è Safety –º–µ—Ö–∞–Ω–∏–∑–º—ã

### 1. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–æ–∑–∞ –∑–∞ —Ä–∞–∑:
- pH: **5.0 –º–ª**
- EC: **10.0 –º–ª**

### 2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –¥–æ–∑–∞–º–∏:
- –û–±–∞ —É–∑–ª–∞: **60 —Å–µ–∫—É–Ω–¥**

### 3. Emergency stop:
- –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö (pH < 5.0 –∏–ª–∏ > 9.0, EC < 0.5 –∏–ª–∏ > 5.0)
- –í—Å–µ –Ω–∞—Å–æ—Å—ã –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
- –ú–æ–∂–Ω–æ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é

---

## üìä –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π: pH —É–ø–∞–ª –¥–æ 6.2

```
T=0 —Å–µ–∫: pH = 6.2 (target = 7.0)
         ‚îú‚îÄ –û—à–∏–±–∫–∞: -0.8 (–±–æ–ª—å—à–∞—è!)
         ‚îú‚îÄ –ó–æ–Ω–∞: FAR
         ‚îú‚îÄ PID —Ä–∞—Å—á—ë—Ç: 1.5 –º–ª
         ‚îî‚îÄ –î–µ–π—Å—Ç–≤–∏–µ: –ù–∞—Å–æ—Å pH UP –Ω–∞ 1.5 –º–ª

T=60 —Å–µ–∫: pH = 6.5 (—É–ª—É—á—à–∏–ª–æ—Å—å, –Ω–æ –µ—â—ë –Ω–µ –¥–æ—Å—Ç–∏–≥–ª–∏)
          ‚îú‚îÄ –û—à–∏–±–∫–∞: -0.5
          ‚îú‚îÄ –ó–æ–Ω–∞: FAR
          ‚îú‚îÄ PID —Ä–∞—Å—á—ë—Ç: 0.9 –º–ª
          ‚îî‚îÄ –î–µ–π—Å—Ç–≤–∏–µ: –ù–∞—Å–æ—Å pH UP –Ω–∞ 0.9 –º–ª

T=120 —Å–µ–∫: pH = 6.8 (–ø–æ—á—Ç–∏ –¥–æ—Å—Ç–∏–≥–ª–∏)
           ‚îú‚îÄ –û—à–∏–±–∫–∞: -0.2
           ‚îú‚îÄ –ó–æ–Ω–∞: CLOSE
           ‚îú‚îÄ PID —Ä–∞—Å—á—ë—Ç: 0.3 –º–ª
           ‚îî‚îÄ –î–µ–π—Å—Ç–≤–∏–µ: –ù–∞—Å–æ—Å pH UP –Ω–∞ 0.3 –º–ª

T=180 —Å–µ–∫: pH = 7.0 (–¥–æ—Å—Ç–∏–≥–ª–∏!)
           ‚îú‚îÄ –û—à–∏–±–∫–∞: 0.0
           ‚îú‚îÄ –ó–æ–Ω–∞: DEAD
           ‚îî‚îÄ –î–µ–π—Å—Ç–≤–∏–µ: –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º ‚úÖ
```

**–ò—Ç–æ–≥–æ:** 3 –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏, 2.7 –º–ª —Ä–µ–∞–≥–µ–Ω—Ç–∞, 180 —Å–µ–∫—É–Ω–¥

---

## üöÄ –ö–∞–∫ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø—Ä–æ—à–∏—Ç—å

### 1. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞:

```batch
tools\rebuild_ph_ec.bat
```

**–í—Ä–µ–º—è:** ~3-5 –º–∏–Ω—É—Ç

### 2. –ü—Ä–æ—à–∏–≤–∫–∞ pH –Ω–æ–¥—ã:

```batch
tools\flash_ph.bat
```

**–ü–æ—Ä—Ç:** COM8 (–∏–∑–º–µ–Ω–∏ –≤ —Å–∫—Ä–∏–ø—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### 3. –ü—Ä–æ—à–∏–≤–∫–∞ EC –Ω–æ–¥—ã:

```batch
tools\flash_ec.bat
```

**–ü–æ—Ä—Ç:** COM11 (–∏–∑–º–µ–Ω–∏ –≤ —Å–∫—Ä–∏–ø—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìã –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö

### –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫:

```
I (1234) ph_mgr: Adaptive PID initialized
I (1235) ph_mgr: Zones set: dead=0.10, close=0.30, far=1.00
I (1236) ph_mgr: Safety set: max_dose=5.00 ml, min_interval=60000 ms
I (1237) ph_mgr: pH Manager initialized
I (1238) ph_mgr: Node ID: ph_001, pH target: 7.00
```

### –†–∞–±–æ—Ç–∞ PID:

```
I (10000) ph_mgr: pH UP: 0.45 ml [CLOSE zone] (current=6.85, target=7.00)
I (70000) ph_mgr: pH UP: 1.20 ml [FAR zone] (current=6.20, target=7.00)
D (130000) ph_mgr: PID: error=-0.050, zone=DEAD, out=0.00 ml
```

### Safety —Å—Ä–∞–±–æ—Ç–∞–ª:

```
D (35000) adaptive_pid: Safety interval not elapsed
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã MQTT:

```json
{
  "type": "command",
  "node_id": "ph_001",
  "command": "set_ph_target",
  "params": {"target": 6.5}
}
```

### –ß–µ—Ä–µ–∑ NVS (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ `node_config` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
- `ph_target` –∏–ª–∏ `ec_target`
- `pump_pid[].kp/ki/kd`
- `ph_min/ph_max` –∏–ª–∏ `ec_min/ec_max`

---

## ‚ùì FAQ

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ü–∏—è?**  
A: –í CLOSE –∑–æ–Ω–µ: ~1 —Ä–∞–∑ –≤ 1-2 –º–∏–Ω—É—Ç—ã. –í FAR –∑–æ–Ω–µ: ~1 —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É (—á–∞—â–µ).

**Q: –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –º—ë—Ä—Ç–≤—É—é –∑–æ–Ω—É?**  
A: –î–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `dead_zone = 0.0` —á–µ—Ä–µ–∑ `adaptive_pid_set_zones()`.

**Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å max_dose?**  
A: –ß–µ—Ä–µ–∑ `adaptive_pid_set_safety(pid, new_max_dose, min_interval)`.

**Q: –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–∞?**  
A: –î–∞, –µ—Å—Ç—å –∂—ë—Å—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã: Kp (0.1-10.0), Ki (0.001-1.0).

**Q: –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É PID?**  
A: –î–∞, —á–µ—Ä–µ–∑ `adaptive_pid_get_stats()` –∏–ª–∏ –≤ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ (TODO dashboard).

---

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢

**–î–û:**  
‚ö†Ô∏è –ü—Ä–æ—Å—Ç–æ–π PID ‚Üí —á–∞—Å—Ç—ã–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ ‚Üí –±–æ–ª—å—à–æ–π —Ä–∞—Å—Ö–æ–¥ —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤

**–ü–û–°–õ–ï:**  
‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π PID ‚Üí —É–º–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ ‚Üí —ç–∫–æ–Ω–æ–º–∏—è ~30-40% —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤

---

**–ù–ê–ß–ù–ò–¢–ï –°:**

```batch
tools\rebuild_ph_ec.bat
tools\flash_ph.bat
tools\flash_ec.bat
```

**–ù–ê–°–õ–ê–ñ–î–ê–ô–¢–ï–°–¨!** üöÄ

---

**–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `common/adaptive_pid/README.md`  
**–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç:** `–ê–î–ê–ü–¢–ò–í–ù–´–ô_PID_–§–ò–ù–ê–õ–¨–ù–´–ô_–û–¢–ß–ï–¢.md`

