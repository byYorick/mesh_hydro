# üêõ –ë–ê–ì–ò –í –ù–û–í–û–ú –ö–û–î–ï

## ‚ùå –ë–ê–ì #1: HTML Injection –≤ Telegram —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

**–§–∞–π–ª:** `TelegramService.php`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
$message = sprintf(
    "<b>–£–∑–µ–ª:</b> %s\n<b>–°–æ–±—ã—Ç–∏–µ:</b> %s",
    $error->node_id,      // ‚ùå –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å HTML
    $error->message       // ‚ùå –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å HTML
);
```

–ï—Å–ª–∏ `$error->message` —Å–æ–¥–µ—Ä–∂–∏—Ç `<script>alert(1)</script>`, Telegram –º–æ–∂–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:** –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å HTML —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã.

---

## ‚ùå –ë–ê–ì #2: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π cast –≤—Ä–µ–º–µ–Ω–∏ –≤ Schedule

**–§–∞–π–ª:** `app/Models/Schedule.php`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
protected $casts = [
    'time_start' => 'datetime:H:i',  // ‚ùå –ü–æ–ª–µ TIME, –∞ –Ω–µ DATETIME
    'time_end' => 'datetime:H:i',
];
```

–í –ë–î `time_start` –∏ `time_end` —ç—Ç–æ `TIME`, –∞ –Ω–µ `DATETIME`. Cast –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å cast –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π accessor.

---

## ‚ùå –ë–ê–ì #3: Shallow comparison –≤ calculateDiff

**–§–∞–π–ª:** `app/Models/ConfigHistory.php`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
foreach ($new as $key => $value) {
    if (!isset($old[$key]) || $old[$key] !== $value) {
        // ‚ùå –ï—Å–ª–∏ $value - –º–∞—Å—Å–∏–≤, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ
    }
}
```

–î–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `pump_pid`) —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º.

---

## ‚ùå –ë–ê–ì #4: –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π –∫–æ–≥–¥–∞ data –Ω–µ –º–∞—Å—Å–∏–≤

**–§–∞–π–ª:** `TelegramService.php`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
if (isset($error->data) && is_array($error->data)) {
    foreach ($error->data as $key => $value) {
        $message .= "‚Ä¢ {$key}: {$value}\n";  // ‚ùå –ß—Ç–æ –µ—Å–ª–∏ $value - –º–∞—Å—Å–∏–≤ –∏–ª–∏ –æ–±—ä–µ–∫—Ç?
    }
}
```

---

## ‚ùå –ë–ê–ì #5: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ Scheduler

**–§–∞–π–ª:** `SchedulerRunCommand.php`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ï—Å–ª–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—ã–ª–æ –∞–∫—Ç–∏–≤–Ω–æ, –Ω–æ –ø–æ—Ç–æ–º —Å—Ç–∞–ª–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ (–∏–∑–º–µ–Ω–∏–ª–∏ –≤—Ä–µ–º—è), —É–∑–µ–ª –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

---

## üõ†Ô∏è –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

–°–µ–π—á–∞—Å –∏—Å–ø—Ä–∞–≤–ª—é!

