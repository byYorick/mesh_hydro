# üìã –ñ—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π - Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**–î–∞—Ç–∞:** 22 –æ–∫—Ç—è–±—Ä—è 2025  
**–¶–µ–ª—å:** –û—á–∏—Å—Ç–∫–∞ –ë–î –æ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –æ—á–∏—Å—Ç–∫–∏ –ë–î
**–§–∞–π–ª:** `server/backend/app/Console/Commands/CleanTestDataCommand.php`

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
```bash
docker exec hydro_backend php artisan db:clean-test-data --force
```

**–£–¥–∞–ª—è–µ—Ç:**
- –í—Å–µ —É–∑–ª—ã (nodes)
- –í—Å—é —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é (telemetry)
- –í—Å–µ —Å–æ–±—ã—Ç–∏—è (events)
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã (commands)
- –û—à–∏–±–∫–∏ —É–∑–ª–æ–≤ (node_errors)

### 2. –û—á–∏—â–µ–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—á–∏—Å—Ç–∫–∏:**
```
‚úì –£–¥–∞–ª–µ–Ω–æ —É–∑–ª–æ–≤: 7
‚úì –£–¥–∞–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏: 864
‚úì –£–¥–∞–ª–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: 10
‚úì –£–¥–∞–ª–µ–Ω–æ –∫–æ–º–∞–Ω–¥: 0
‚úì –£–¥–∞–ª–µ–Ω–æ –æ—à–∏–±–æ–∫ —É–∑–ª–æ–≤: 0
```

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ:**
```
‚úì PID –ø—Ä–µ—Å–µ—Ç—ã: 6 –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–∏—Å—Ç–µ–º
```

### 3. –û—Ç–∫–ª—é—á–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∏–¥—ã
**–§–∞–π–ª:** `server/backend/database/seeders/DatabaseSeeder.php`

**–ë—ã–ª–æ:**
```php
$this->call([
    NodeSeeder::class,        // –¢–µ—Å—Ç–æ–≤—ã–µ —É–∑–ª—ã
    TelemetrySeeder::class,   // –¢–µ—Å—Ç–æ–≤–∞—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è
    EventSeeder::class,       // –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
]);
```

**–°—Ç–∞–ª–æ:**
```php
$this->call([
    PidPresetSeeder::class,   // –¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ PID –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
]);
```

### 4. –ù–∞—Å—Ç—Ä–æ–µ–Ω Production —Ä–µ–∂–∏–º
**–§–∞–π–ª:** `server/docker-compose.yml`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö:**
```yaml
- APP_ENV=production      # –ë—ã–ª–æ: local
- APP_DEBUG=false         # –ë—ã–ª–æ: true
- LOG_LEVEL=info          # –ë—ã–ª–æ: debug
```

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- backend
- mqtt_listener
- scheduler
- reverb

### 5. –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```bash
docker-compose down
docker-compose up -d
```

**–°—Ç–∞—Ç—É—Å:** –í—Å–µ 7 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚úÖ

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
| –¢–∞–±–ª–∏—Ü–∞ | –ó–∞–ø–∏—Å–µ–π | –°—Ç–∞—Ç—É—Å |
|---------|---------|--------|
| Nodes | 0 | –ë—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ MQTT |
| Telemetry | 0 | –ë—É–¥–µ—Ç –ø–æ—Å—Ç—É–ø–∞—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤ |
| Events | 0 | –ë—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–æ–π |
| Commands | 0 | –ë—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ API |
| PID Presets | 6 | ‚úÖ –ì–æ—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | –°—Ç–∞—Ç—É—Å | –ü–æ—Ä—Ç—ã |
|-----------|--------|-------|
| hydro_postgres | ‚úÖ Running (healthy) | 5432 |
| hydro_mosquitto | ‚úÖ Running | 1883, 9001 |
| hydro_backend | ‚úÖ Running | 8000, 6001 |
| hydro_frontend | ‚úÖ Running | 3000 |
| hydro_reverb | ‚úÖ Running | 8080 |
| hydro_mqtt_listener | ‚úÖ Running | - |
| hydro_scheduler | ‚úÖ Running | - |

### MQTT Listener
```
‚úÖ –ü–æ–¥–∫–ª—é—á—ë–Ω –∫ MQTT –±—Ä–æ–∫–µ—Ä—É
üì° –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–µ—Ç —Ç–æ–ø–∏–∫–∏:
   - hydro/telemetry/#
   - hydro/event/#
   - hydro/heartbeat/#
   - hydro/response/#
   - hydro/discovery
   - hydro/error/#
```

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Auto-Discovery

1. **ESP32 —É–∑–µ–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è**
2. **–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ WiFi**
3. **–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MQTT –±—Ä–æ–∫–µ—Ä—É** (mosquitto:1883)
4. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç discovery —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   ```json
   Topic: hydro/discovery
   Payload: {
     "node_id": "ph_001",
     "node_type": "ph",
     "mac_address": "AA:BB:CC:DD:EE:01",
     "firmware": "2.0.0",
     "hardware": "ESP32-C3"
   }
   ```
5. **MQTT Listener –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —É–∑–µ–ª –≤ –ë–î**
6. **–£–∑–µ–ª –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ**

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –≤ —Ñ–∞–π–ª–µ:
**`server/PRODUCTION_SETUP.md`**

–°–æ–¥–µ—Ä–∂–∏—Ç:
- –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é —É–∑–ª–æ–≤
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã:
1. ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
2. ‚è≥ –ü—Ä–æ—à–∏—Ç—å ESP32 —É–∑–ª—ã —á–µ—Ä–µ–∑ `idf.py flash`
3. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å WiFi –∏ MQTT –Ω–∞ —É–∑–ª–∞—Ö
4. ‚è≥ –£–∑–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è
5. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:
```bash
# 1. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
http://localhost:3000

# 2. API
http://localhost:8000/api/nodes

# 3. –õ–æ–≥–∏ MQTT
docker logs hydro_mqtt_listener -f
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞—è** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è production
- **–£–∑–ª—ã –¥–æ–±–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- **–í—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ**
- **PID –ø—Ä–µ—Å–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã** –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ** —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**  
**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**

