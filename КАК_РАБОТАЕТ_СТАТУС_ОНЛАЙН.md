# üìä –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –°–¢–ê–¢–£–° –û–ù–õ–ê–ô–ù/–û–§–õ–ê–ô–ù

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 20 –æ–∫—Ç—è–±—Ä—è 2025, 22:25  
**–í–µ—Ä—Å–∏—è:** Final v1.0

---

## ‚è±Ô∏è –¢–ê–ô–ú–õ–ê–ô–ù –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–ê

### –ö–æ–≥–¥–∞ —É–∑–µ–ª –û–¢–ö–õ–Æ–ß–ê–ï–¢–°–Ø:

```
T=0s      –£–∑–µ–ª –æ—Ç–ø—Ä–∞–≤–∏–ª –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
          Backend: last_seen_at = "2025-10-20 22:00:00"
          –ë–î: online = true
          Dashboard: üü¢ ONLINE

T=1-39s   –£–∑–µ–ª –º–æ–ª—á–∏—Ç (–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ)
          Backend: isOnline() = true (< 40 —Å–µ–∫)
          –ë–î: online = true
          Dashboard: üü¢ ONLINE

T=40s     –ü—Ä–æ—à–ª–æ 40 —Å–µ–∫—É–Ω–¥ —Å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
          Backend: isOnline() = false (‚â• 40 —Å–µ–∫)
          –ë–î: online = true (–µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞)
          Dashboard: üü¢ ONLINE (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)

T=0-30s   –û–∂–∏–¥–∞–Ω–∏–µ scheduled task
          (–º–∞–∫—Å–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥)

T=45s     Scheduled task –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
(–ø—Ä–∏–º–µ—Ä)  –ü—Ä–æ–≤–µ—Ä–∫–∞: online –≤ –ë–î (true) ‚â† isOnline() (false)
          –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ë–î: online = false ‚úÖ
          Dashboard: üü¢ ONLINE (–µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª)

T=0-5s    –û–∂–∏–¥–∞–Ω–∏–µ fallback polling
          (–º–∞–∫—Å–∏–º—É–º 5 —Å–µ–∫—É–Ω–¥)

T=48s     Fallback polling
(–ø—Ä–∏–º–µ—Ä)  API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: online = false
          Store –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: nodes[].online = false ‚úÖ
          Dashboard: üî¥ OFFLINE ‚úÖ
```

**–ò–¢–û–ì–û: –æ—Ç 40 –¥–æ 75 —Å–µ–∫—É–Ω–¥**
- 40 —Å–µ–∫ - —Ç–∞–π–º–∞—É—Ç offline
- 0-30 —Å–µ–∫ - –æ–∂–∏–¥–∞–Ω–∏–µ scheduled task
- 0-5 —Å–µ–∫ - –æ–∂–∏–¥–∞–Ω–∏–µ fallback polling

**–í —Å—Ä–µ–¥–Ω–µ–º: ~55 —Å–µ–∫—É–Ω–¥** ‚úÖ

---

## üéØ –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ì–¥–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ |
|----------|----------|---------------|
| **–¢–∞–π–º–∞—É—Ç offline** | 40 —Å–µ–∫—É–Ω–¥ | `config/hydro.php` |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞** | –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫ | `routes/console.php` |
| **Fallback polling** | –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫ | `echo.js` |

### –¶–≤–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤:

| –í—Ä–µ–º—è —Å last_seen | –¶–≤–µ—Ç | –°—Ç–∞—Ç—É—Å | online |
|-------------------|------|--------|--------|
| 0-39 —Å–µ–∫—É–Ω–¥ | üü¢ –ó–µ–ª–µ–Ω—ã–π | Online | true |
| 40-79 —Å–µ–∫—É–Ω–¥ | üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π | Warning | false |
| 80+ —Å–µ–∫—É–Ω–¥ | üî¥ –ö—Ä–∞—Å–Ω—ã–π | Offline | false |
| –ù–∏–∫–æ–≥–¥–∞ | ‚ö™ –°–µ—Ä—ã–π | Unknown | false |

---

## üìù –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ –≤ nodes.js:

**–ë—ã–ª–æ:** `online: true` —Ö–∞—Ä–¥–∫–æ–¥ ‚Üí –≤—Å–µ–≥–¥–∞ online  
**–°—Ç–∞–ª–æ:** `online: nodeData.online` ‚Üí —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å ‚úÖ

### 2. ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:

**–ë—ã–ª–æ:** –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (60 —Å–µ–∫)  
**–°—Ç–∞–ª–æ:** –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ ‚úÖ

### 3. ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç offline:

**–ë—ã–ª–æ:** 30 —Å–µ–∫—É–Ω–¥  
**–°—Ç–∞–ª–æ:** 40 —Å–µ–∫—É–Ω–¥ (–ø–æ —Ç–≤–æ–µ–π –ø—Ä–æ—Å—å–±–µ) ‚úÖ

---

## üîç –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨ –ß–¢–û –í–°–Å –†–ê–ë–û–¢–ê–ï–¢

### –¢–µ—Å—Ç 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É–∑–ª–∞

1. –í–∫–ª—é—á–∏ ESP32 —É–∑–µ–ª
2. –£–∑–µ–ª –Ω–∞—á–Ω–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ MQTT
3. Backend –ø–æ–ª—É—á–∞–µ—Ç ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç last_seen_at
4. –ë–î: online = true
5. Fallback polling (5 —Å–µ–∫) –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
6. Dashboard: üü¢ —É–∑–µ–ª ONLINE

**–í—Ä–µ–º—è: 1-5 —Å–µ–∫—É–Ω–¥** ‚úÖ

---

### –¢–µ—Å—Ç 2: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —É–∑–ª–∞

1. –í—ã–∫–ª—é—á–∏ ESP32 —É–∑–µ–ª (–ø–∏—Ç–∞–Ω–∏–µ, reset)
2. –£–∑–µ–ª –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ
3. –ü—Ä–æ—Ö–æ–¥–∏—Ç 40 —Å–µ–∫—É–Ω–¥
4. Backend: isOnline() = false
5. –û–∂–∏–¥–∞–Ω–∏–µ scheduled task (0-30 —Å–µ–∫)
6. Scheduled task –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î: online = false
7. Fallback polling (5 —Å–µ–∫) –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
8. Dashboard: üî¥ —É–∑–µ–ª OFFLINE

**–í—Ä–µ–º—è: 40-75 —Å–µ–∫—É–Ω–¥ (–≤ —Å—Ä–µ–¥–Ω–µ–º ~55 —Å–µ–∫)** ‚úÖ

---

### –¢–µ—Å—Ç 3: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ä—É—á–Ω—É—é
docker exec hydro_backend php artisan nodes:check-status

# –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
Ctrl + Shift + R
```

**–í—Ä–µ–º—è: –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ** ‚úÖ

---

## üéØ –ß–¢–û –û–ñ–ò–î–ê–¢–¨ –ù–ê DASHBOARD

### –ü–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —É–∑–ª–∞:

```
T=0s:     –£–∑–µ–ª –æ—Ç–∫–ª—é—á–µ–Ω
          Dashboard: üü¢ ONLINE (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)

T=45s:    –ü—Ä–æ—à–ª–æ ~45 —Å–µ–∫—É–Ω–¥
(–ø—Ä–∏–º–µ—Ä)  Dashboard: üü¢ ONLINE (–µ—â–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)

T=55s:    Scheduled task —Å—Ä–∞–±–æ—Ç–∞–ª + polling –æ–±–Ω–æ–≤–∏–ª
(–ø—Ä–∏–º–µ—Ä)  Dashboard: üî¥ OFFLINE ‚úÖ
```

**–ü–æ–¥–æ–∂–¥–∏ ~1 –º–∏–Ω—É—Ç—É –ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è!**

---

## üêõ –ï–°–õ–ò –ü–†–û–ë–õ–ï–ú–ê –û–°–¢–ê–ï–¢–°–Ø

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å?

```bash
# –ó–∞–ø—É—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é
docker exec hydro_backend php artisan nodes:check-status

# –ü—Ä–æ–≤–µ—Ä—å –ë–î
docker exec hydro_backend php artisan tinker --execute="echo json_encode(App\Models\Node::select('node_id', 'online')->get());"
```

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?

```bash
curl http://localhost:8000/api/nodes
```

–°–º–æ—Ç—Ä–∏ –Ω–∞ –ø–æ–ª–µ `"online": true/false`

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: Frontend –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è?

–û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å (F12):

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥:
```
üì° Fallback telemetry: ...
üîî Fallback event: ...
```

–ï—Å–ª–∏ –≤–∏–¥–∏—à—å ‚Üí fallback polling —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞?

```
Ctrl + Shift + R (hard refresh)
```

–û—á–∏—â–∞–µ—Ç –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ.

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢

–î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã offline —Å—Ç–∞—Ç—É—Å–∞:

- [x] –¢–∞–π–º–∞—É—Ç offline = 40 —Å–µ–∫—É–Ω–¥ ‚úÖ
- [x] Scheduled task –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ ‚úÖ
- [x] nodes.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç nodeData.online ‚úÖ
- [x] Fallback polling —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- [x] Backend –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω ‚úÖ
- [x] Frontend –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω ‚úÖ
- [x] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã ‚úÖ
- [ ] **–ü–æ–¥–æ–∂–¥–∞—Ç—å ~1 –º–∏–Ω—É—Ç—É –ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è** ‚è≥
- [ ] **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+Shift+R)** üîÑ

---

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!**

–ü—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å:
- ‚úÖ Online –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ** (–∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç)
- ‚è±Ô∏è Offline –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **—á–µ—Ä–µ–∑ 40-75 —Å–µ–∫—É–Ω–¥** (–∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É)

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è IoT —Å–∏—Å—Ç–µ–º! –¢–∞–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ó–∞—â–∏—Ç—É –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π (–∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏ —Å–µ—Ç–∏)
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã

**–î–ª—è –≥–∏–¥—Ä–æ–ø–æ–Ω–∏–∫–∏ —ç—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ!** üå±

---

**–ê–≤—Ç–æ—Ä:** AI Assistant (Claude Sonnet 4.5)  
**–î–∞—Ç–∞:** 20.10.2025 22:25  
**–í–µ—Ä—Å–∏—è:** Final Guide v1.0

