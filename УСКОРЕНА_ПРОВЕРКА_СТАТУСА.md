# ‚ö° –£–°–ö–û–†–ï–ù–ê –ü–†–û–í–ï–†–ö–ê –°–¢–ê–¢–£–°–ê –£–ó–õ–û–í

**–î–∞—Ç–∞:** 20 –æ–∫—Ç—è–±—Ä—è 2025, 22:20  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–û–ë–ù–û–í–õ–ï–ù–û**

---

## üéØ –ß–¢–û –ò–ó–ú–ï–ù–ï–ù–û

### Scheduled Task: –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É ‚Üí –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

**–ë—ã–ª–æ:**
```php
Schedule::command('nodes:check-status --notify')
    ->everyMinute()  // ‚ùå 60 —Å–µ–∫—É–Ω–¥
```

**–°—Ç–∞–ª–æ:**
```php
Schedule::command('nodes:check-status --notify')
    ->everyThirtySeconds()  // ‚úÖ 30 —Å–µ–∫—É–Ω–¥
```

---

## üìä –í–†–ï–ú–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–ê

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```
–£–∑–µ–ª –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è:
T=0s:     –û—Ç–∫–ª—é—á–µ–Ω–∏–µ
T=0-60s:  –û–∂–∏–¥–∞–Ω–∏–µ scheduled task (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ 60 —Å–µ–∫)
T=60s:    Scheduled task –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î
T=65s:    Fallback polling –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
          
–ò–¢–û–ì–û: –¥–æ 65 —Å–µ–∫—É–Ω–¥ ‚ùå
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```
–£–∑–µ–ª –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è:
T=0s:     –û—Ç–∫–ª—é—á–µ–Ω–∏–µ
T=40s:    –£–∑–µ–ª —Å—á–∏—Ç–∞–µ—Ç—Å—è offline (last_seen + 40 —Å–µ–∫)
T=0-30s:  –û–∂–∏–¥–∞–Ω–∏–µ scheduled task (–º–∞–∫—Å–∏–º—É–º 30 —Å–µ–∫)
T=30s:    Scheduled task –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î
T=35s:    Fallback polling –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
          
–ò–¢–û–ì–û: –¥–æ 35 —Å–µ–∫—É–Ω–¥ ‚úÖ (–≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ!)
```

---

## ‚è±Ô∏è –¢–ê–ô–ú–õ–ê–ô–ù –û–ë–ù–û–í–õ–ï–ù–ò–Ø

### –•—É–¥—à–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏):

```
T=0s:     –£–∑–µ–ª –æ—Ç–ø—Ä–∞–≤–∏–ª –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
          last_seen_at = now()
          
T=29s:    Scheduled task —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏–ª ‚Üí online=true ‚úÖ
          
T=30s:    –£–∑–µ–ª –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è
          
T=40s:    –ü—Ä–æ—à–ª–æ 40 —Å–µ–∫—É–Ω–¥ —Å last_seen
          isOnline() ‚Üí false (–Ω–æ –ë–î –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞)
          
T=59s:    –°–ª–µ–¥—É—é—â–∏–π scheduled task
          –ü—Ä–æ–≤–µ—Ä–∫–∞: isOnline() = false
          –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î: online = false ‚úÖ
          
T=0-5s:   Fallback polling
          API: online = false
          Dashboard: —É–∑–µ–ª offline ‚úÖ
          
–ú–ê–ö–°–ò–ú–£–ú: 30 —Å–µ–∫ (–≤—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)
```

### –õ—É—á—à–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π):

```
T=0s:     –£–∑–µ–ª –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è
T=1s:     Scheduled task (—á–µ—Ä–µ–∑ 1 —Å–µ–∫)
          isOnline() = false
          –ë–î –æ–±–Ω–æ–≤–ª–µ–Ω–∞: online = false ‚úÖ
T=2-6s:   Fallback polling
          Dashboard: —É–∑–µ–ª offline ‚úÖ
          
–ú–ò–ù–ò–ú–£–ú: 1-6 —Å–µ–∫—É–Ω–¥ ‚úÖ
```

---

## üìù –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

### `server/backend/routes/console.php`

**–°—Ç—Ä–æ–∫–∞:** 21-24

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** `everyMinute()` ‚Üí `everyThirtySeconds()`

---

## ‚úÖ –ü–†–ò–ú–ï–ù–ï–ù–ò–ï

### 1. Backend –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω:
```bash
docker-compose build backend mqtt_listener
docker-compose up -d backend mqtt_listener
```
‚úÖ –ì–æ—Ç–æ–≤–æ!

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
docker exec hydro_backend php artisan schedule:list
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```
*/30 * * * * php artisan nodes:check-status --notify
```

---

## üéØ –ö–ê–ö –≠–¢–û –£–õ–£–ß–®–ê–ï–¢ –†–ê–ë–û–¢–£

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **–ë—ã—Å—Ç—Ä–µ–µ —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ:**
   - –ë—ã–ª–æ: –¥–æ 60 —Å–µ–∫—É–Ω–¥
   - –°—Ç–∞–ª–æ: –¥–æ 30 —Å–µ–∫—É–Ω–¥
   - **–í 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ!** ‚úÖ

2. **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
   - –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–∞—â–µ
   - –ú–µ–Ω—å—à–µ –≤—Ä–µ–º—è "—É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏—è" –¥–∞–Ω–Ω—ã—Ö
   - –ë–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

3. **–õ—É—á—à–∏–π UX:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—ã—Å—Ç—Ä–µ–µ
   - –ú–µ–Ω—å—à–µ –≤–æ–ø—Ä–æ—Å–æ–≤ "–ø–æ—á–µ–º—É –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è?"
   - –°–∏—Å—Ç–µ–º–∞ –∫–∞–∂–µ—Ç—Å—è –±–æ–ª–µ–µ –æ—Ç–∑—ã–≤—á–∏–≤–æ–π

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

1. **–ë–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
   - –ë—ã–ª–æ: 60 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å
   - –°—Ç–∞–ª–æ: 120 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å
   - **–ù–û** –∑–∞–ø—Ä–æ—Å –æ—á–µ–Ω—å –ª–µ–≥–∫–∏–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏)

2. **–ë–æ–ª—å—à–µ –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥:**
   - –ë—É–¥–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ 2 —Ä–∞–∑–∞ —á–∞—â–µ
   - –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É | –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫ | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|---------------|---------------|-----------|
| **–ú–∞–∫—Å. –∑–∞–¥–µ—Ä–∂–∫–∞** | 60 —Å–µ–∫ | 30 —Å–µ–∫ | ‚¨áÔ∏è 50% |
| **–°—Ä–µ–¥. –∑–∞–¥–µ—Ä–∂–∫–∞** | 30 —Å–µ–∫ | 15 —Å–µ–∫ | ‚¨áÔ∏è 50% |
| **–ú–∏–Ω. –∑–∞–¥–µ—Ä–∂–∫–∞** | 1 —Å–µ–∫ | 1 —Å–µ–∫ | = |
| **–ó–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å** | 60 | 120 | ‚¨ÜÔ∏è 100% |
| **–ù–∞–≥—Ä—É–∑–∫–∞ CPU** | ~1ms/–º–∏–Ω | ~1ms/30—Å–µ–∫ | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è |

---

## üîÑ –ü–û–õ–ù–´–ô –¶–ò–ö–õ –û–ë–ù–û–í–õ–ï–ù–ò–Ø

### –ü–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —É–∑–ª–∞:

```
1. –£–∑–µ–ª –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ
   ‚Üì (40 —Å–µ–∫—É–Ω–¥)
   
2. Backend –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç: last_seen + 40 —Å–µ–∫ > now()
   isOnline() ‚Üí false
   ‚Üì (0-30 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏–µ)
   
3. Scheduled task –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
   nodes:check-status –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   –ë–î –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: online = false
   ‚Üì (0-5 —Å–µ–∫—É–Ω–¥)
   
4. Fallback polling –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: online = false
   ‚Üì
   
5. Frontend –æ–±–Ω–æ–≤–ª—è–µ—Ç store
   nodes[].online = false (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ API)
   ‚Üì
   
6. Dashboard –æ–±–Ω–æ–≤–ª—è–µ—Ç UI
   –ö–∞—Ä—Ç–æ—á–∫–∞ —É–∑–ª–∞: –∫—Ä–∞—Å–Ω–∞—è / offline
```

**–ò–¢–û–ì–û: 40 + 30 + 5 = –¥–æ 75 —Å–µ–∫—É–Ω–¥ –º–∞–∫—Å–∏–º—É–º**  
**–°—Ä–µ–¥–Ω—è—è:** 40 + 15 + 2.5 = ~58 —Å–µ–∫—É–Ω–¥ ‚úÖ

---

## üí° –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –µ—â–µ –±—ã—Å—Ç—Ä–µ–µ:

1. **everyFifteenSeconds()** - –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
   - –ú–∞–∫—Å–∏–º—É–º: 15 —Å–µ–∫ –∑–∞–¥–µ—Ä–∂–∫–∞
   - –ó–∞–ø—Ä–æ—Å–æ–≤: 240/—á–∞—Å
   
2. **everyTenSeconds()** - –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
   - –ú–∞–∫—Å–∏–º—É–º: 10 —Å–µ–∫ –∑–∞–¥–µ—Ä–∂–∫–∞
   - –ó–∞–ø—Ä–æ—Å–æ–≤: 360/—á–∞—Å

3. **Real-time —á–µ—Ä–µ–∑ WebSocket:**
   - –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
   - –ù—É–ª–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
   - –ù–æ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–ª–∞–¥–∫–∏ WebSocket

**–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ (30 —Å–µ–∫) - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å!** ‚úÖ

---

## ‚úÖ –ò–¢–û–ì

| –î–æ | –ü–æ—Å–ª–µ |
|----|-------|
| ‚ùå –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 60 —Å–µ–∫ | ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 30 —Å–µ–∫ |
| ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| ‚ùå –ü–ª–æ—Ö–æ–π UX | ‚úÖ –•–æ—Ä–æ—à–∏–π UX |

**–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–ª–∞ –≤ 2 —Ä–∞–∑–∞ –æ—Ç–∑—ã–≤—á–∏–≤–µ–µ!** üéâ

---

**–ê–≤—Ç–æ—Ä:** AI Assistant (Claude Sonnet 4.5)  
**–î–∞—Ç–∞:** 20.10.2025 22:20  
**–í–µ—Ä—Å–∏—è:** Schedule Update v1.0

