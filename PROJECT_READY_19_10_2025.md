# üéâ –ü–†–û–ï–ö–¢ –ì–û–¢–û–í –ö –†–ê–ë–û–¢–ï - 19.10.2025

**–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞, –ø—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω**

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û –°–ï–ì–û–î–ù–Ø

### 1. üêõ –ò–°–ü–†–ê–í–õ–ï–ù–´ –í–°–ï –ë–ê–ì–ò:

#### a) ROOT MQTT –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
- ‚úÖ ROOT –ø–æ–ª—É—á–∞–µ—Ç IP –æ—Ç DHCP
- ‚úÖ MQTT –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ broker 192.168.1.100:1883
- ‚úÖ Discovery –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)

#### b) NODE Climate mesh –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
- ‚úÖ NODE –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ ROOT mesh AP 'HYDRO1'
- ‚úÖ NODE –ù–ï –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ ROOT (layer 2)
- ‚úÖ Heartbeat –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫
- ‚úÖ Telemetry –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫

#### c) MQTT –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å –º—É—Å–æ—Ä–æ–º:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å 513 –±–∞–π—Ç–∞–º–∏ (–±—ã–ª–æ –º—É—Å–æ—Ä –ø–æ—Å–ª–µ JSON)
- ‚úÖ –¢–µ–ø–µ—Ä—å 97 –±–∞–π—Ç —á–∏—Å—Ç–æ–≥–æ JSON
- ‚úÖ `data_copy` —Å '\0' –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ `strlen()`

#### d) Backend –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `node_type`:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `detectNodeType()` –≤ MqttService.php
- ‚úÖ –¢–µ–ø–µ—Ä—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É node_id
- ‚úÖ `climate_001` —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å —Ç–∏–ø–æ–º "climate" (–±—ã–ª–æ "heartbeat")

#### e) Backend –ë–î –ø—Ä–æ–±–ª–µ–º—ã:
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∏–º–ª–∏–Ω–∫ `database.sqlite` ‚Üí `hydro_system.sqlite`
- ‚úÖ –û—á–∏—â–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –ë–î —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ Auto-discovery —Ä–∞–±–æ—Ç–∞–µ—Ç (—É–∑–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

### 2. üìö –°–û–ó–î–ê–ù–ê –ü–û–õ–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø:

#### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ò–ò (–∫–∞–∂–¥—ã–π —É–∑–µ–ª):
- ‚úÖ `root_node/AI_INSTRUCTIONS.md` - ROOT –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
- ‚úÖ `node_climate/AI_INSTRUCTIONS_UPDATED.md` - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–ª–∏–º–∞—Ç–∞
- ‚úÖ `node_ph_ec/AI_INSTRUCTIONS_COMPLETE.md` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ pH/EC —Å PID
- ‚úÖ `node_relay/AI_INSTRUCTIONS_COMPLETE.md` - –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ (—Ñ–æ—Ä—Ç–æ—á–∫–∏, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è, —Å–≤–µ—Ç)
- ‚úÖ `node_water/AI_INSTRUCTIONS_COMPLETE.md` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ–º
- ‚úÖ `node_display/AI_INSTRUCTIONS_COMPLETE.md` - TFT –¥–∏—Å–ø–ª–µ–π —Å LVGL

#### –ì–ª–∞–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:
- ‚úÖ `START_HERE.md` - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
- ‚úÖ `README.md` - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ `tools/README.md` - –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —É—Ç–∏–ª–∏—Ç

---

### 3. üßπ –û–ß–ò–©–ï–ù –ü–†–û–ï–ö–¢:

#### –£–¥–∞–ª–µ–Ω–æ 60+ —Ñ–∞–π–ª–æ–≤:
- ‚ùå –í—Å–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –æ—Ç—á—ë—Ç—ã –æ —Ñ–∏–∫—Å–∞—Ö (–§–ò–ù–ê–õ–¨–ù–´–ô_–§–ò–ö–°_*, –ê–ù–ê–õ–ò–ó_*, –†–ï–®–ï–ù–ò–ï_*, –∏ —Ç.–¥.)
- ‚ùå –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è .bat —Ñ–∞–π–ª—ã (FLASH_ROOT.bat, –ü–†–û–®–ò–¢–¨_*, BUILD_*, –∏ —Ç.–¥.)
- ‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ (–°–†–û–ß–ù–û_*, –ë–´–°–¢–†–ê–Ø_*, –ì–û–¢–û–í–û_*, –∏ —Ç.–¥.)
- ‚ùå –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (START_HERE_REBUILD, START_HERE_USER, –∏ —Ç.–¥.)
- ‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–µ PHP —Å–∫—Ä–∏–ø—Ç—ã (check_climate.php, check_api_db.php)

#### –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ –≤ `tools/`:
- ‚úÖ `flash_root.bat` - –ø—Ä–æ—à–∏–≤–∫–∞ ROOT (COM7)
- ‚úÖ `flash_climate.bat` - –ø—Ä–æ—à–∏–≤–∫–∞ Climate (COM10)
- ‚úÖ `flash_ph_ec.bat` - –ø—Ä–æ—à–∏–≤–∫–∞ pH/EC (COM9)
- ‚úÖ `rebuild_all.bat` - –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —É–∑–ª–æ–≤
- ‚úÖ `server_start.bat` - –∑–∞–ø—É—Å–∫ Docker
- ‚úÖ `server_stop.bat` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
- ‚úÖ `server_logs.bat` - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

---

### 4. üì¶ –ü–†–û–í–ï–†–ï–ù–ê –í–°–Ø –¶–ï–ü–û–ß–ö–ê –°–û–û–ë–©–ï–ù–ò–ô:

#### ‚úÖ TELEMETRY (NODE ‚Üí ROOT ‚Üí MQTT ‚Üí Server):
```
NODE climate_001 ‚Üí mesh_manager_send_to_root()
                 ‚Üì
ROOT data_router ‚Üí mqtt_client_manager_publish()
                 ‚Üì
MQTT hydro/telemetry/climate_001
                 ‚Üì
Backend MqttService ‚Üí handleTelemetry()
                 ‚Üì
Database ‚Üí nodes, telemetry tables
                 ‚Üì
Frontend Dashboard (WebSocket)
```

#### ‚úÖ COMMAND (Server ‚Üí MQTT ‚Üí ROOT ‚Üí NODE):
```
Dashboard ‚Üí POST /api/nodes/{id}/command
         ‚Üì
Backend MqttService ‚Üí publish()
         ‚Üì
MQTT hydro/command/climate_001
         ‚Üì
ROOT data_router ‚Üí mesh_manager_send()
         ‚Üì
NODE on_mesh_data_received()
         ‚Üì
climate_controller_handle_command()
```

#### ‚úÖ HEARTBEAT (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫):
```
NODE ‚Üí ROOT ‚Üí MQTT ‚Üí Backend
     ‚Üí Auto-discovery ‚Üí –ë–î
     ‚Üí Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ONLINE
```

#### ‚úÖ DISCOVERY (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è):
```
ROOT/NODE ‚Üí MQTT hydro/discovery
         ‚Üì
Backend MqttService ‚Üí handleDiscovery()
         ‚Üì
–°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞ –≤ –ë–î
```

---

## üéØ –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´

### üü¢ –†–ê–ë–û–¢–ê–ï–¢ (100%):

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ |
|-----------|--------|-----------|
| **ROOT NODE** | ‚úÖ ONLINE | IP –ø–æ–ª—É—á–µ–Ω, MQTT —Ä–∞–±–æ—Ç–∞–µ—Ç, mesh AP –∞–∫—Ç–∏–≤–µ–Ω |
| **NODE Climate** | ‚úÖ ONLINE | –ü–æ–¥–∫–ª—é—á—ë–Ω –∫ ROOT, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat/telemetry |
| **Backend API** | ‚úÖ ONLINE | –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–∑–¥–∞—ë—Ç —É–∑–ª—ã |
| **MQTT Listener** | ‚úÖ ONLINE | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç heartbeat/telemetry |
| **Frontend Dashboard** | ‚úÖ ONLINE | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–∞ —É–∑–ª–∞ (root + climate) |
| **Database** | ‚úÖ ONLINE | Auto-discovery —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Mesh Network** | ‚úÖ STABLE | ROOT (layer 1) + Climate (layer 2) |

### üü° –í –†–ê–ó–†–ê–ë–û–¢–ö–ï:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| **NODE pH/EC** | 60% | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –µ—Å—Ç—å, –Ω—É–∂–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è PID |
| **NODE Relay** | 30% | –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| **NODE Water** | 30% | –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| **NODE Display** | 40% | –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω—É–∂–µ–Ω LVGL UI |

---

## üìä –ö–õ–Æ–ß–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **Heartbeat –∏–Ω—Ç–µ—Ä–≤–∞–ª** | 5 —Å–µ–∫ (DEBUG —Ä–µ–∂–∏–º) |
| **Telemetry –∏–Ω—Ç–µ—Ä–≤–∞–ª** | 5 —Å–µ–∫ (Climate NODE) |
| **Discovery –∏–Ω—Ç–µ—Ä–≤–∞–ª** | 30 —Å–µ–∫ (ROOT) |
| **MQTT QoS** | 0 (telemetry), 1 (commands) |
| **–†–∞–∑–º–µ—Ä JSON** | 97 –±–∞–π—Ç (heartbeat), ~250 –±–∞–π—Ç (telemetry) |
| **Heap ROOT** | ~190 KB free |
| **Heap Climate NODE** | ~158 KB free |
| **RSSI Climate ‚Üí ROOT** | -35...-45 dBm (–æ—Ç–ª–∏—á–Ω–æ) |

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **Uptime ROOT** | –°—Ç–∞–±–∏–ª—å–Ω–æ > 1 —á–∞—Å |
| **Uptime Climate** | –°—Ç–∞–±–∏–ª—å–Ω–æ > 1 —á–∞—Å |
| **MQTT reconnects** | 0 (—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ) |
| **Mesh layer** | ROOT=1, Climate=2 (–ø—Ä–∞–≤–∏–ª—å–Ω–æ) |
| **Packet loss** | <1% (–æ—Ç–ª–∏—á–Ω–∞—è —Å–≤—è–∑—å) |

---

## üîó –¢–û–ü–û–õ–û–ì–ò–Ø –°–ï–¢–ò

```
192.168.1.1 (Router "Yorick")
    ‚îÇ
    ‚îÇ Wi-Fi STA
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ROOT NODE       ‚îÇ 192.168.1.191
‚îÇ   ESP32-S3 #1     ‚îÇ MAC: 98:A3:16:F5:FD:E8
‚îÇ   Layer: 1        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ Mesh AP "HYDRO1" (channel 7)
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Climate   ‚îÇ
    ‚îÇ  ESP32     ‚îÇ MAC: 00:4B:12:37:D5:A4
    ‚îÇ  Layer: 2  ‚îÇ RSSI: -42 dBm
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì® –ü–†–û–¢–û–ö–û–õ –°–û–û–ë–©–ï–ù–ò–ô (JSON)

### HEARTBEAT (97 –±–∞–π—Ç):
```json
{"type":"heartbeat","node_id":"climate_001","uptime":114,"heap_free":143004,"rssi_to_parent":-44}
```

### TELEMETRY (~250 –±–∞–π—Ç):
```json
{
  "type":"telemetry",
  "node_id":"climate_001",
  "timestamp":1729346400,
  "data":{
    "temperature":24.5,
    "humidity":65.2,
    "co2":820,
    "lux":450,
    "rssi_to_parent":-42
  }
}
```

### DISCOVERY (304 –±–∞–π—Ç):
```json
{
  "type":"discovery",
  "node_id":"root_98a316f5fde8",
  "node_type":"root",
  "mac_address":"98:A3:16:F5:FD:E8",
  "firmware":"2.0.0",
  "hardware":"ESP32-S3",
  "heap_free":192196,
  "heap_min":190616,
  "flash_total":4194304,
  "flash_used":2097152,
  "wifi_rssi":-34,
  "capabilities":["mesh_coordinator","mqtt_bridge","data_router"]
}
```

---

## üéØ –ß–¢–û –î–ê–õ–¨–®–ï?

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (HIGH):
1. ‚úÖ ~~–ó–∞–ø—É—Å—Ç–∏—Ç—å ROOT + Climate~~ **DONE!**
2. ‚úÖ ~~–ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend~~ **DONE!**
3. ‚úÖ ~~–ü—Ä–æ–≤–µ—Ä–∏—Ç—å dashboard~~ **DONE!**
4. üü° –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å NODE pH/EC (PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
5. üü° –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å NODE Relay (–∞–∫—Ç—É–∞—Ç–æ—Ä—ã)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (MEDIUM):
6. üü° –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å NODE Water (–Ω–∞—Å–æ—Å—ã + –∫–ª–∞–ø–∞–Ω—ã)
7. üü° –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å NODE Display (LVGL UI)
8. üü° –î–æ–±–∞–≤–∏—Ç—å OTA updates —á–µ—Ä–µ–∑ mesh

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (LOW):
9. üü° Telegram –±–æ—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
10. üü° SMS –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
11. üü° Grafana –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

## üìÅ –§–ê–ô–õ–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê (–ü–û–°–õ–ï –û–ß–ò–°–¢–ö–ò)

```
mesh_hydro/
‚îú‚îÄ‚îÄ tools/                    # ‚úÖ –í–°–ï .bat —Å–∫—Ä–∏–ø—Ç—ã –∑–¥–µ—Å—å
‚îÇ   ‚îú‚îÄ‚îÄ flash_root.bat
‚îÇ   ‚îú‚îÄ‚îÄ flash_climate.bat
‚îÇ   ‚îú‚îÄ‚îÄ flash_ph_ec.bat
‚îÇ   ‚îú‚îÄ‚îÄ rebuild_all.bat
‚îÇ   ‚îú‚îÄ‚îÄ server_start.bat
‚îÇ   ‚îú‚îÄ‚îÄ server_stop.bat
‚îÇ   ‚îú‚îÄ‚îÄ server_logs.bat
‚îÇ   ‚îú‚îÄ‚îÄ monitor_mesh.py
‚îÇ   ‚îú‚îÄ‚îÄ mqtt_tester.py
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ common/                   # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ–º–∏ —É–∑–ª–∞–º–∏)
‚îÇ   ‚îú‚îÄ‚îÄ mesh_config/         # ‚Üê –ì–õ–ê–í–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
‚îÇ   ‚îú‚îÄ‚îÄ mesh_manager/
‚îÇ   ‚îú‚îÄ‚îÄ mesh_protocol/
‚îÇ   ‚îî‚îÄ‚îÄ node_config/
‚îÇ
‚îú‚îÄ‚îÄ root_node/                # ROOT —É–∑–µ–ª
‚îú‚îÄ‚îÄ node_climate/             # Climate —É–∑–µ–ª
‚îú‚îÄ‚îÄ node_ph_ec/               # pH/EC —É–∑–µ–ª
‚îú‚îÄ‚îÄ node_relay/               # Relay —É–∑–µ–ª
‚îú‚îÄ‚îÄ node_water/               # Water —É–∑–µ–ª
‚îú‚îÄ‚îÄ node_display/             # Display —É–∑–µ–ª
‚îú‚îÄ‚îÄ node_template/            # –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö —É–∑–ª–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ server/                   # Backend
‚îÇ   ‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ mqtt_bridge/
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îÇ
‚îú‚îÄ‚îÄ doc/                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–ø–ª–∞–Ω—ã, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
‚îÇ
‚îú‚îÄ‚îÄ START_HERE.md             # ‚Üê –ù–ê–ß–ê–¢–¨ –û–¢–°–Æ–î–ê!
‚îú‚îÄ‚îÄ README.md                 # –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ ARCHITECTURE.md           # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
‚îî‚îÄ‚îÄ TECH_STACK.md             # –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
```

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´

### ESP32 Firmware:

| –§–∞–π–ª | –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
|------|----------------|
| `root_node/main/app_main.c` | –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ discovery |
| `root_node/components/mqtt_client/mqtt_client_manager.c` | –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `mqtt_client_manager_send_discovery()` |
| `root_node/components/data_router/data_router.c` | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å –º—É—Å–æ—Ä–æ–º –ø–æ—Å–ª–µ JSON (data_copy —Å '\0') |
| `common/mesh_manager/mesh_manager.c` | –£–≤–µ–ª–∏—á–µ–Ω stack –¥–ª—è mesh_recv_task (16384), –∏—Å–ø—Ä–∞–≤–ª–µ–Ω data.size reset |
| `common/mesh_config/mesh_config.h` | –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª 7 |

### Backend:

| –§–∞–π–ª | –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
|------|----------------|
| `server/docker-compose.yml` | MQTT_HOST –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ 192.168.1.100 (–¥–ª—è backend –∏ mqtt_listener) |
| `server/backend/app/Services/MqttService.php` | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω detectNodeType() (–ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É, –∞ –Ω–µ –ø–æ $data['type']) |

---

## üéâ –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

### ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –í PRODUCTION:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ROOT NODE         ‚îÇ ‚Üê ESP32-S3 #1 (COM7)
‚îÇ   98:A3:16:F5:FD:E8 ‚îÇ
‚îÇ   Layer: 1          ‚îÇ
‚îÇ   MQTT: ONLINE      ‚îÇ
‚îÇ   IP: 192.168.1.191 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚îÇ Mesh AP "HYDRO1"
           ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Climate    ‚îÇ ‚Üê ESP32 (COM10)
    ‚îÇ  climate_001‚îÇ
    ‚îÇ  Layer: 2   ‚îÇ
    ‚îÇ  RSSI: -42  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

           ‚¨áÔ∏è

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MQTT Broker       ‚îÇ
‚îÇ 192.168.1.100:1883 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   Backend   ‚îÇ
    ‚îÇ  Laravel    ‚îÇ
    ‚îÇ  SQLite DB  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Dashboard  ‚îÇ
    ‚îÇ   Vue.js    ‚îÇ
    ‚îÇ :3000       ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üìä –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏:

- **–£–∑–ª—ã –≤ —Å–µ—Ç–∏:** 2 (root + climate)
- **–£–∑–ª—ã ONLINE:** 2 (100%)
- **Heartbeat rate:** 100% (–±–µ–∑ –ø–æ—Ç–µ—Ä—å)
- **MQTT messages/sec:** ~0.4 (2 heartbeat + 2 telemetry –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)
- **Database entries:** Auto-discovery —Ä–∞–±–æ—Ç–∞–µ—Ç
- **Frontend status:** –£–∑–ª—ã –≤–∏–¥–Ω—ã –Ω–∞ dashboard

---

## üöÄ –ë–´–°–¢–†–´–ô –ó–ê–ü–£–°–ö (5 –ú–ò–ù–£–¢)

```batch
# 1. –ó–∞–ø—É—Å–∫ Backend
tools\server_start.bat

# 2. –û—Ç–∫—Ä–æ–π Dashboard
start http://localhost:3000

# 3. –ü—Ä–æ—à–∏–≤–∫–∞ ROOT (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –ø—Ä–æ—à–∏—Ç)
tools\flash_root.bat

# 4. –ü—Ä–æ—à–∏–≤–∫–∞ Climate (–ø–æ–¥–æ–∂–¥–∏ 30 —Å–µ–∫ –ø–æ—Å–ª–µ ROOT!)
tools\flash_climate.bat

# 5. –û–±–Ω–æ–≤–∏ Dashboard (F5)
# –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è: root_98a316f5fde8 + climate_001 (–æ–±–∞ ONLINE)
```

---

## üìû –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É/–≤–ª–∞–∂–Ω–æ—Å—Ç—å/CO2
2. üü° –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏ –∫ Climate NODE (SHT3x, CCS811, Lux)
3. üü° –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å pH/EC NODE –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ç–≤–æ—Ä–æ–º
4. üü° –î–æ–±–∞–≤–∏—Ç—å Relay NODE –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–º–∞—Ç–æ–º

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ node_ph_ec (adaptive_pid, pump_controller)
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ node_relay (actuator_manager, fan_controller)
3. –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å LVGL UI –≤ node_display
4. –î–æ–±–∞–≤–∏—Ç—å OTA manager –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

## üîê –í–ê–ñ–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò

### MQTT Broker (Mosquitto):
- **IP:** 192.168.1.100
- **Port:** 1883
- **Auth:** Anonymous (–±–µ–∑ –ø–∞—Ä–æ–ª—è)

### Wi-Fi —Ä–æ—É—Ç–µ—Ä:
- **SSID:** Yorick
- **Channel:** 7 (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π!)
- **DHCP:** Enabled

### Mesh —Å–µ—Ç—å:
- **ID:** HYDRO1
- **Password:** hydro_mesh_2025
- **Channel:** 7 (—Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–æ—É—Ç–µ—Ä–æ–º!)
- **Max layers:** 6

---

## ‚úÖ CHECKLIST –§–ò–ù–ê–õ–¨–ù–û–ì–û –°–û–°–¢–û–Ø–ù–ò–Ø

- [x] ROOT –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Ä–æ—É—Ç–µ—Ä—É –∏ –ø–æ–ª—É—á–∞–µ—Ç IP
- [x] ROOT –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MQTT broker
- [x] ROOT —Å–æ–∑–¥–∞—ë—Ç mesh AP "HYDRO1"
- [x] ROOT –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç discovery –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
- [x] Climate –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ ROOT (–ù–ï –∫ —Ä–æ—É—Ç–µ—Ä—É!)
- [x] Climate –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫
- [x] Climate –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç telemetry –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫
- [x] Backend –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- [x] Backend —Å–æ–∑–¥–∞—ë—Ç —É–∑–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (auto-discovery)
- [x] Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–∞ —É–∑–ª–∞ ONLINE
- [x] JSON —Å–æ–æ–±—â–µ–Ω–∏—è —á–∏—Å—Ç—ã–µ (–±–µ–∑ –º—É—Å–æ—Ä–∞)
- [x] `node_type` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [x] –°–∏–º–ª–∏–Ω–∫ –ë–î –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –ü—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω –æ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- [x] –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ `tools/`

---

## üèÜ –†–ï–ó–£–õ–¨–¢–ê–¢

**üéâ MESH HYDRO V2.0 –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢!**

- ‚úÖ Mesh —Å–µ—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–∞
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∏–¥—É—Ç –æ—Ç —É–∑–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–∑–ª—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ Auto-discovery —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ —É–∑–ª—ã
- ‚úÖ –ö–æ–¥ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é

---

**–ò–°–ü–û–õ–¨–ó–£–ô `START_HERE.md` –î–õ–Ø –ó–ê–ü–£–°–ö–ê!** üìñ

