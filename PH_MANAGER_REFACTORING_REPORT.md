# üîß –û—Ç—á–µ—Ç –æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ ph_manager.c

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞
–ö–æ–¥ –≤ `ph_manager.c` —Å—Ç–∞–ª –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–º –∏ —Ç—Ä—É–¥–Ω–æ—á–∏—Ç–∞–µ–º—ã–º:
- –§—É–Ω–∫—Ü–∏—è `ph_manager_handle_command` —Å–æ–¥–µ—Ä–∂–∞–ª–∞ ~400 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏

## üéØ –†–µ—à–µ–Ω–∏–µ
–†–∞–∑–±–∏–ª–∏ –¥–ª–∏–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### 1. **–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å—Ç–∞–ª–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π**
```c
void ph_manager_handle_command(const char *command, cJSON *params) {
    ESP_LOGI(TAG, "=== PH_MANAGER_HANDLE_COMMAND ===");
    ESP_LOGI(TAG, "Command received: %s", command ? command : "NULL");
    ESP_LOGI(TAG, "Params: %s", params ? "found" : "NULL");
    
    if (strcmp(command, "set_ph_target") == 0) {
        ph_manager_handle_ph_target_command(params);
    }
    else if (strcmp(command, "emergency_stop") == 0) {
        ph_manager_set_emergency(true);
    }
    else if (strcmp(command, "reset_emergency") == 0) {
        ph_manager_set_emergency(false);
    }
    else if (strcmp(command, "run_pump") == 0 || strcmp(command, "reset_stats") == 0) {
        ph_manager_handle_pump_command(params);
    }
    else if (strcmp(command, "set_safety_settings") == 0 || strcmp(command, "update_safety_config") == 0) {
        ph_manager_handle_safety_command(params);
    }
    else if (strcmp(command, "get_config") == 0) {
        ph_manager_send_config_response();
    }
    else {
        ESP_LOGW(TAG, "Unknown command: %s", command);
    }
}
```

### 2. **–í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**

#### `ph_manager_handle_ph_target_command()`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã `set_ph_target`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ pH (5.0-9.0)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PID setpoint
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ NVS

#### `ph_manager_handle_pump_command()`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ `run_pump` –∏ `reset_stats`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–∞—Å–æ—Å–∞
- –ó–∞–ø—É—Å–∫ –Ω–∞—Å–æ—Å–∞ –≤—Ä—É—á–Ω—É—é
- –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### `ph_manager_handle_safety_command()`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ `set_safety_settings` –∏ `update_safety_config`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ safety –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ emergency –ø–æ—Ä–æ–≥–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ NVS

#### `ph_manager_send_config_response()`
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ config response
- –í–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ NVS
- –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ mesh

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- ‚ùå –û–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è ~400 —Å—Ç—Ä–æ–∫
- ‚ùå –°–º–µ—à–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏
- ‚ùå –¢—Ä—É–¥–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ~25 —Å—Ç—Ä–æ–∫
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –õ–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å –∏ –ø–æ–Ω–∏–º–∞—Ç—å
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- ‚úÖ –£–¥–æ–±–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üîç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

```
ph_manager_handle_command()
‚îú‚îÄ‚îÄ ph_manager_handle_ph_target_command()     // pH target
‚îú‚îÄ‚îÄ ph_manager_handle_pump_command()         // –ù–∞—Å–æ—Å—ã
‚îú‚îÄ‚îÄ ph_manager_handle_safety_command()       // Safety –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
‚îî‚îÄ‚îÄ ph_manager_send_config_response()         // Config response
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - –∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
2. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏
3. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ø—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ
5. **–û—Ç–ª–∞–¥–∫–∞** - —á–µ—Ç–∫–∏–µ –ª–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ö–æ–¥ —Å—Ç–∞–ª –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º. –¢–µ–ø–µ—Ä—å –ª–µ–≥–∫–æ:
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –û—Ç–ª–∞–∂–∏–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ü–æ–Ω–∏–º–∞—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã
- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** - –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥ –∫ –¥—Ä—É–≥–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
2. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é** - –≤ –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥
3. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
4. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã** - –¥–ª—è –∫–∞–∂–¥–æ–π –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
