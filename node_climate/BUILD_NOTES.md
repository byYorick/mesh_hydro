# –ó–∞–º–µ—Ç–∫–∏ –ø–æ —Å–±–æ—Ä–∫–µ NODE Climate

## ‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞!

–ü—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω –¥–ª—è **ESP32** —Å ESP-IDF v5.5

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å ESP-IDF v5.5

### 1. –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `esp_task_wdt`
–í ESP-IDF v5.5 –∏–∑–º–µ–Ω–∏–ª—Å—è API watchdog:
- ‚ùå –£–¥–∞–ª–µ–Ω –∏–∑ `main/CMakeLists.txt`
- ‚ùå –£–¥–∞–ª–µ–Ω –∏–∑ `main/app_main.c`
- ‚ùå –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ `components/climate_controller/climate_controller.c`
- ‚ùå –£–¥–∞–ª–µ–Ω –∏–∑ `components/climate_controller/CMakeLists.txt`

### 2. –£–≤–µ–ª–∏—á–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–¥–µ–ª–æ–≤
–°–æ–∑–¥–∞–Ω `partitions.csv`:
- –†–∞–∑–¥–µ–ª factory app: **1.5 –ú–ë** (–≤–º–µ—Å—Ç–æ 1 –ú–ë)
- –°–≤–æ–±–æ–¥–Ω–æ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏: **502 –ö–ë (32%)**

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω target
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π target: **ESP32** (–Ω–µ S3)
- `build.bat` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `idf.py set-target esp32`

### 4. –ú—è–≥–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–∞—Ç—á–∏–∫–æ–≤
**–í `main/app_main.c`:**
- –ó–∞–º–µ–Ω–µ–Ω `ESP_ERROR_CHECK` –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —Å WARNING
- –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞—Ç—á–∏–∫–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã

**–í `components/climate_controller/climate_controller.c`:**
- –§—É–Ω–∫—Ü–∏—è `read_all_sensors()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å–ø–µ—Ö –µ—Å–ª–∏ **—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω** –¥–∞—Ç—á–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –î–ª—è –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –¥–∞—Ç—á–∏–∫–æ–≤ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
  - –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: -127.0¬∞C (–º–∞—Ä–∫–µ—Ä –æ—à–∏–±–∫–∏)
  - –í–ª–∞–∂–Ω–æ—Å—Ç—å, CO2, Lux: 0
- –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —á–∞—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Mesh –¥–ª—è NODE

**–í `common/mesh_manager/mesh_manager.c`:**
- Router credentials —Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –¥–ª—è **–í–°–ï–•** —É–∑–ª–æ–≤ (ROOT –∏ NODE)
- **`esp_mesh_set_type(MESH_NODE)` –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è NODE** - —ç—Ç–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ç–∏–ø!
- –¢–æ–ª—å–∫–æ ROOT —è–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `esp_mesh_set_type(MESH_ROOT)`
- **`max_connection` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è NODE = 6** (–¥–µ—Ñ–æ–ª—Ç –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —É–∑–ª–æ–≤)

**–í `main/app_main.c`:**
- –î–æ–±–∞–≤–ª–µ–Ω—ã `.router_ssid` –∏ `.router_password` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é NODE
- ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ù—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ WiFi credentials –ø–µ—Ä–µ–¥ –ø—Ä–æ—à–∏–≤–∫–æ–π!
- ‚úÖ –ü—Ä–∏–º–µ—Ä —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω —Å WiFi "Yorick"

## üì¶ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏

```
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:  ESP32
–†–∞–∑–º–µ—Ä bin: 0x105a20 –±–∞–π—Ç (~1.04 –ú–ë)
–†–∞–∑–¥–µ–ª:     0x180000 –±–∞–π—Ç (1.5 –ú–ë)
–°–≤–æ–±–æ–¥–Ω–æ:   502240 –±–∞–π—Ç (32%)
–°—Ç–∞—Ç—É—Å:     ‚úÖ –ì–û–¢–û–í –ö –ü–†–û–®–ò–í–ö–ï!
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–±–æ—Ä–∫–∞:
```bash
.\build.bat
```

### –ü—Ä–æ—à–∏–≤–∫–∞:
```bash
idf.py -p COM<–Ω–æ–º–µ—Ä> flash monitor
```

## ‚úÖ WiFi –Ω–∞—Å—Ç—Ä–æ–µ–Ω!

–í —Ñ–∞–π–ª–µ `main/app_main.c` (—Å—Ç—Ä–æ–∫–∏ 168-169):
```c
.router_ssid = "Yorick",           // ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ
.router_password = "pro100parol",  // ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ
```

‚ö†Ô∏è **–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ ROOT —É–∑–ª–∞!**

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã

1. **Degraded mode**: –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –≤—Å–µ –¥–∞—Ç—á–∏–∫–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
2. **–ß–∞—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¥–∞–∂–µ —Å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. **Retry –ª–æ–≥–∏–∫–∞**: 3 –ø–æ–ø—ã—Ç–∫–∏ —á—Ç–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç—á–∏–∫–∞
4. **Mesh —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –û–±—â–∏–µ router credentials –¥–ª—è –≤—Å–µ–π mesh —Å–µ—Ç–∏

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ—à–∏–≤–∫–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
**–î–∞—Ç–∞**: 18.10.2025
**ESP-IDF**: v5.5

