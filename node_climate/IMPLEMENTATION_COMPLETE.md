# ‚úÖ NODE CLIMATE - –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê

**–î–∞—Ç–∞:** 2025-10-18  
**–°—Ç–∞—Ç—É—Å:** –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 100%

---

## üéâ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (4/4):

#### 1. ‚úÖ sht3x_driver (SHT3x –¥–∞—Ç—á–∏–∫)
```
components/sht3x_driver/
‚îú‚îÄ‚îÄ sht3x_driver.h           (49 —Å—Ç—Ä–æ–∫) - API
‚îú‚îÄ‚îÄ sht3x_driver.c           (115 —Å—Ç—Ä–æ–∫) - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è I2C
‚îî‚îÄ‚îÄ CMakeLists.txt
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SHT3x —á–µ—Ä–µ–∑ I2C
- –ß—Ç–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Å–±—Ä–æ—Å
- CRC –ø—Ä–æ–≤–µ—Ä–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### 2. ‚úÖ ccs811_driver (CCS811 –¥–∞—Ç—á–∏–∫)
```
components/ccs811_driver/
‚îú‚îÄ‚îÄ ccs811_driver.h          (56 —Å—Ç—Ä–æ–∫) - API
‚îú‚îÄ‚îÄ ccs811_driver.c          (172 —Å—Ç—Ä–æ–∫–∏) - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è I2C
‚îî‚îÄ‚îÄ CMakeLists.txt
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CCS811 —á–µ—Ä–µ–∑ I2C
- –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞
- –ß—Ç–µ–Ω–∏–µ CO2 –∏ TVOC
- –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ/–≤–ª–∞–∂–Ω–æ—Å—Ç–∏

#### 3. ‚úÖ lux_sensor (–î–∞—Ç—á–∏–∫ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏)
```
components/lux_sensor/
‚îú‚îÄ‚îÄ lux_sensor.h             (38 —Å—Ç—Ä–æ–∫) - API
‚îú‚îÄ‚îÄ lux_sensor.c             (117 —Å—Ç—Ä–æ–∫) - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è I2C
‚îî‚îÄ‚îÄ CMakeLists.txt
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Trema Lux —á–µ—Ä–µ–∑ I2C
- –ß—Ç–µ–Ω–∏–µ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏ (lux)
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑–º–µ—Ä–µ–Ω–∏–π

#### 4. ‚úÖ climate_controller (–ì–ª–∞–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)
```
components/climate_controller/
‚îú‚îÄ‚îÄ climate_controller.h     (51 —Å—Ç—Ä–æ–∫–∞) - API
‚îú‚îÄ‚îÄ climate_controller.c     (186 —Å—Ç—Ä–æ–∫) - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îî‚îÄ‚îÄ CMakeLists.txt
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —á—Ç–µ–Ω–∏—è (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫)
- Retry –ª–æ–≥–∏–∫–∞ (3 –ø–æ–ø—ã—Ç–∫–∏)
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –Ω–∞ ROOT
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –æ—Ç ROOT
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- Watchdog timer

---

### üìù –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

#### 5. ‚úÖ main/app_main.c (130 —Å—Ç—Ä–æ–∫)
- 7-—à–∞–≥–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- I2C –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞—Ç—á–∏–∫–æ–≤
- Mesh NODE —Ä–µ–∂–∏–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å climate_controller

#### 6. ‚úÖ main/CMakeLists.txt
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (common + –ª–æ–∫–∞–ª—å–Ω—ã–µ)

#### 7. ‚úÖ CMakeLists.txt
- EXTRA_COMPONENT_DIRS –Ω–∞ ../common

#### 8. ‚úÖ sdkconfig.defaults
- ESP32 target (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
- I2C –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- Watchdog timer
- Logging

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------------|------------|
| sht3x_driver.c | 115 | SHT3x I2C –¥—Ä–∞–π–≤–µ—Ä |
| ccs811_driver.c | 172 | CCS811 I2C –¥—Ä–∞–π–≤–µ—Ä |
| lux_sensor.c | 117 | Lux I2C –¥—Ä–∞–π–≤–µ—Ä |
| climate_controller.c | 186 | –ì–ª–∞–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ |
| app_main.c | 130 | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ |
| **–ò–¢–û–ì–û** | **720** | **–†–∞–±–æ—á–∏–π –∫–æ–¥** |

**+ README –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è = –µ—â–µ ~500 —Å—Ç—Ä–æ–∫**

**–í–°–ï–ì–û: ~1220 —Å—Ç—Ä–æ–∫**

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ NODE Climate

```
NODE Climate (ESP32)
‚îÇ
‚îú‚îÄ‚îÄ I2C Master (GPIO 17/18)
‚îÇ   ‚îú‚îÄ‚îÄ SHT3x (0x44) ‚Üí —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ + –≤–ª–∞–∂–Ω–æ—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ CCS811 (0x5A) ‚Üí CO2 + TVOC
‚îÇ   ‚îî‚îÄ‚îÄ Trema Lux (0x12) ‚Üí –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å
‚îÇ
‚îú‚îÄ‚îÄ Climate Controller
‚îÇ   ‚îú‚îÄ‚îÄ –ß—Ç–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤ (retry √ó 3)
‚îÇ   ‚îú‚îÄ‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ ‚Üí ROOT
‚îÇ   ‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –æ—Ç ROOT
‚îÇ
‚îú‚îÄ‚îÄ Mesh Client (NODE —Ä–µ–∂–∏–º)
‚îÇ   ‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ telemetry
‚îÇ   ‚îú‚îÄ‚îÄ Heartbeat –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫
‚îÇ   ‚îî‚îÄ‚îÄ –ü—Ä–∏–µ–º –∫–æ–º–∞–Ω–¥ –æ—Ç ROOT
‚îÇ
‚îî‚îÄ‚îÄ Watchdog Timer
    ‚îî‚îÄ‚îÄ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–∏
```

---

## üîå –ü–æ–ª–Ω–∞—è —Ä–∞—Å–ø–∏–Ω–æ–≤–∫–∞

### I2C —à–∏–Ω–∞:
- **GPIO 17** - SCL (Clock)
- **GPIO 18** - SDA (Data)

### –î–∞—Ç—á–∏–∫–∏ –Ω–∞ —à–∏–Ω–µ:
- **0x44** - SHT3x (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ + –≤–ª–∞–∂–Ω–æ—Å—Ç—å)
- **0x5A** - CCS811 (CO2 + TVOC)
- **0x12** - Trema Lux (–æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å)

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
```c
temp_target = 24.0¬∞C
humidity_target = 65.0%
co2_max = 800 ppm
lux_min = 500 lux
read_interval_ms = 10000 (10 —Å–µ–∫—É–Ω–¥)
```

–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ NVS namespace: `"climate_ns"`

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–±–æ—Ä–∫–∏

### –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞:
```bash
cd node_climate
idf.py set-target esp32
idf.py build
```

### –ü—Ä–æ—à–∏–≤–∫–∞:
```bash
idf.py -p COM4 flash monitor
```

### –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
```bash
idf.py -p COM4 monitor
```

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—á–∏–∫–æ–≤

–í –º–æ–Ω–∏—Ç–æ—Ä–µ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è:
```
I sht3x: SHT3x: 24.50¬∞C, 65.2%
I ccs811: CCS811: CO2=445 ppm, TVOC=0 ppb
I lux_sensor: Lux: 1200
I climate_ctrl: Telemetry sent: 24.5¬∞C, 65%, 445ppm, 1200lux
```

### –¢–µ—Å—Ç 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ mesh

```
I mesh_manager: Parent connected
I climate_ctrl: Telemetry sent: ...
```

### –¢–µ—Å—Ç 3: –ö–æ–º–∞–Ω–¥–∞ –æ—Ç ROOT

–ß–µ—Ä–µ–∑ MQTT (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ):
```bash
mosquitto_pub -h 192.168.1.100 -t "hydro/command/climate_001" \
  -m '{"type":"command","node_id":"climate_001","command":"set_read_interval","interval_ms":5000}'
```

–í –ª–æ–≥–∞—Ö Climate:
```
I CLIMATE: Message from ROOT: type=1
I climate_ctrl: Command received: set_read_interval
I climate_ctrl: Read interval updated: 5000 ms
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [x] sht3x_driver —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] ccs811_driver —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] lux_sensor —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] climate_controller —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] app_main.c –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- [x] CMakeLists.txt –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] sdkconfig.defaults –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [x] I2C –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- [x] Mesh NODE —Ä–µ–∂–∏–º
- [x] Retry –ª–æ–≥–∏–∫–∞
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- [x] Watchdog timer

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 12/12 = 100%** ‚úÖ

---

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ Retry –ª–æ–≥–∏–∫–∞ (3 –ø–æ–ø—ã—Ç–∫–∏):
```c
for (int i = 0; i < 3; i++) {
    if (sht3x_read(&temp, &humidity) == ESP_OK) break;
    vTaskDelay(100ms);
}
```

### ‚úÖ –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è CO2:
```c
// CCS811 —É–ª—É—á—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–∏ –∑–Ω–∞–Ω–∏–∏ temp/humidity
sht3x_read(&temp, &humidity);
ccs811_set_environment(temp, humidity);
ccs811_read(&co2, NULL);
```

### ‚úÖ Watchdog –∑–∞—â–∏—Ç–∞:
```c
while (1) {
    esp_task_wdt_reset();  // –°–±—Ä–æ—Å watchdog
    read_sensors();
    vTaskDelay(10000);
}
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `AI_INSTRUCTIONS.md` - –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (370+ —Å—Ç—Ä–æ–∫)
- `components/*/` - –¥—Ä–∞–π–≤–µ—Ä—ã –¥–∞—Ç—á–∏–∫–æ–≤
- `../common/AI_INSTRUCTIONS.md` - –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

---

## üéâ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!

**NODE Climate –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω!**

- ‚úÖ –í—Å–µ –¥–∞—Ç—á–∏–∫–∏ (SHT3x, CCS811, Lux)
- ‚úÖ I2C –¥—Ä–∞–π–≤–µ—Ä—ã
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞
- ‚úÖ Mesh –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ Telemetry –æ—Ç–ø—Ä–∞–≤–∫–∞

**–ú–æ–∂–Ω–æ –ø—Ä–æ—à–∏–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å!** üöÄ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô (–§–∞–∑–∞ 7)

**–°–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª:** node_relay (—Ñ–æ—Ä—Ç–æ—á–∫–∏, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è, —Å–≤–µ—Ç)

---

**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-10-18

