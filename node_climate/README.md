# NODE Climate

ESP32 - –î–∞—Ç—á–∏–∫–∏ –∫–ª–∏–º–∞—Ç–∞ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –≤–ª–∞–∂–Ω–æ—Å—Ç—å, CO2, –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å)

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

**NODE Climate** - —É–∑–µ–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π –≤ —Ç–µ–ø–ª–∏—Ü–µ.

### üå°Ô∏è –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- üìä –ß—Ç–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
- üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –Ω–∞ ROOT
- üîÅ Retry –ª–æ–≥–∏–∫–∞ (3 –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)
- üîÑ –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è CO2 –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ/–≤–ª–∞–∂–Ω–æ—Å—Ç–∏

### ‚ö†Ô∏è –í–ê–ñ–ù–û:
- ‚ùå **–ù–ï–¢ –ò–°–ü–û–õ–ù–ò–¢–ï–õ–ï–ô!** - —Ç–æ–ª—å–∫–æ –¥–∞—Ç—á–∏–∫–∏
- ‚ùå **–ù–ï–¢ –õ–û–ì–ò–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø!** - —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ROOT
- ‚úÖ **–¢–û–õ–¨–ö–û –ú–û–ù–ò–¢–û–†–ò–ù–ì** - –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## üì¶ –î–∞—Ç—á–∏–∫–∏

| –î–∞—Ç—á–∏–∫ | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å | I2C –∞–¥—Ä–µ—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-----------|-----------|------------|
| **SHT3x** | I2C | 0x44 | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ + –≤–ª–∞–∂–Ω–æ—Å—Ç—å |
| **CCS811** | I2C | 0x5A | CO2 + TVOC |
| **Trema Lux** | I2C | 0x12 | –û—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å (lux) |

## üîå –†–∞—Å–ø–∏–Ω–æ–≤–∫–∞

| GPIO | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|------|------------|------------|
| **I2C —à–∏–Ω–∞:** | | |
| 17 | I2C SCL | Clock |
| 18 | I2C SDA | Data |
| **–ò–Ω–¥–∏–∫–∞—Ü–∏—è (–æ–ø—Ü.):** | | |
| 15 | LED —Å—Ç–∞—Ç—É—Å | –ó–µ–ª–µ–Ω—ã–π=OK, –∂–µ–ª—Ç—ã–π=degraded |

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ò–∑ common/:
- `mesh_manager` - Mesh NODE —Ä–µ–∂–∏–º
- `mesh_protocol` - JSON –ø—Ä–æ—Ç–æ–∫–æ–ª
- `node_config` - NVS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ (components/):
- ‚úÖ `sht3x_driver` - Sensirion SHT3x (temp + humidity)
- ‚úÖ `ccs811_driver` - AMS CCS811 (CO2 + TVOC)
- ‚úÖ `lux_sensor` - Trema Lux (–æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å)
- ‚úÖ `climate_controller` - –≥–ª–∞–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

## üöÄ –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞

### ‚úÖ WiFi –Ω–∞—Å—Ç—Ä–æ–µ–Ω
–í —Ñ–∞–π–ª–µ `main/app_main.c` (—Å—Ç—Ä–æ–∫–∏ 168-169) —É–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ WiFi —Ä–æ—É—Ç–µ—Ä–∞:
```c
.router_ssid = "Yorick",
.router_password = "pro100parol",
```
‚ö†Ô∏è **–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à WiFi!** –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å ROOT —É–∑–ª–æ–º.

### –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ (—Å –∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π):
```bash
.\build.bat
```

### –†—É—á–Ω–∞—è —Å–±–æ—Ä–∫–∞:
```bash
cd node_climate
idf.py set-target esp32
idf.py build
idf.py -p COM4 flash monitor
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥

```
I CLIMATE: ========================================
I CLIMATE: === NODE Climate Starting ===
I CLIMATE: ========================================
I CLIMATE: [Step 1/7] Initializing NVS...
I CLIMATE: [Step 2/7] Loading configuration...
I CLIMATE: Loaded: climate_001 (Greenhouse Zone 1)
I CLIMATE: Targets: Temp=24.0¬∞C, Hum=65%, CO2=800ppm, Lux=500
I CLIMATE: [Step 3/7] Initializing I2C...
I CLIMATE: I2C initialized (SDA=18, SCL=17)
I CLIMATE: [Step 4/7] Initializing Sensors...
I sht3x: SHT3x initialized successfully
I ccs811: CCS811 initialized successfully
I lux_sensor: Lux sensor initialized successfully
I CLIMATE: [Step 5/7] Initializing Mesh (NODE mode)...
I mesh_manager: NODE mode
I mesh_manager: Parent connected
I CLIMATE: [Step 6/7] Initializing Climate Controller...
I climate_ctrl: Climate Controller initialized
I CLIMATE: [Step 7/7] Starting Climate Controller...
I climate_ctrl: Main task running (interval: 10000 ms)
I CLIMATE: ========================================
I CLIMATE: === NODE Climate Running ===
I CLIMATE: Node ID: climate_001
I CLIMATE: Read interval: 10000 ms
I CLIMATE: ========================================
I climate_ctrl: Telemetry sent: 24.5¬∞C, 65%, 450ppm, 1200lux
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ß—Ç–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤

–ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏ –¥–∞—Ç—á–∏–∫–∏ –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥:
```
I climate_ctrl: Telemetry sent: 24.3¬∞C, 67%, 445ppm, 1180lux
I climate_ctrl: Telemetry sent: 24.4¬∞C, 66%, 448ppm, 1190lux
```

### –¢–µ—Å—Ç 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ROOT

–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ ROOT –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
I mesh_manager: Parent connected
```

–í –ª–æ–≥–∞—Ö ROOT:
```
I node_registry: New node added: climate_001
I data_router: Telemetry from climate_001 ‚Üí MQTT
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ MQTT

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
mosquitto_sub -h 192.168.1.100 -t "hydro/telemetry" -v
```

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
```json
{
  "type": "telemetry",
  "node_id": "climate_001",
  "data": {
    "temp": 24.5,
    "humidity": 65.0,
    "co2": 450,
    "lux": 1200
  }
}
```

## ‚úÖ –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| sht3x_driver | ‚úÖ –ì–û–¢–û–í | –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è I2C –¥—Ä–∞–π–≤–µ—Ä–∞ |
| ccs811_driver | ‚úÖ –ì–û–¢–û–í | –° –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–µ–π temp/humidity |
| lux_sensor | ‚úÖ –ì–û–¢–û–í | Trema Lux –¥–∞—Ç—á–∏–∫ |
| climate_controller | ‚úÖ –ì–û–¢–û–í | Retry –ª–æ–≥–∏–∫–∞, —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è |
| app_main.c | ‚úÖ –ì–û–¢–û–í | 7-—à–∞–≥–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è |
| CMakeLists.txt | ‚úÖ –ì–û–¢–û–í | –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| sdkconfig | ‚úÖ –ì–û–¢–û–í | ESP32, I2C, watchdog |

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 100%** ‚úÖ

**–ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í –ö –ü–†–û–®–ò–í–ö–ï –ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ!**

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `AI_INSTRUCTIONS.md` - –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (370+ —Å—Ç—Ä–æ–∫)
- `../common/AI_INSTRUCTIONS.md` - –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `../doc/MESH_HYDRO_V2_FINAL_PLAN.md` - –æ–±—â–∏–π –ø–ª–∞–Ω

## üîß –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –î–∞—Ç—á–∏–∫–∏ –Ω–∞ –æ–¥–Ω–æ–π I2C —à–∏–Ω–µ (–∞–¥—Ä–µ—Å–∞ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è)
- CCS811 —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≥—Ä–µ–≤–∞ (–ø–µ—Ä–≤—ã–µ 20 –º–∏–Ω—É—Ç –¥–∞–Ω–Ω—ã–µ –Ω–µ—Ç–æ—á–Ω—ã–µ)
- Retry –ª–æ–≥–∏–∫–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- Watchdog –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô (–§–∞–∑–∞ 7)

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** –ó–ê–í–ï–†–®–ï–ù–û! (2 –¥–Ω—è)
