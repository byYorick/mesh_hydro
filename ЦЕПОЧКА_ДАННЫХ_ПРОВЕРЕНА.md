# ‚úÖ –¶–µ–ø–æ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!

**–î–∞—Ç–∞:** 21.10.2025  
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ü–µ–ø–æ—á–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã, –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –Ω–æ–¥—ã –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã

---

## üîç –ß—Ç–æ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

### 1. –ü—Ä—è–º–∞—è —Ü–µ–ø–æ—á–∫–∞ (–¥–∞–Ω–Ω—ã–µ –æ—Ç –Ω–æ–¥):
```
NODE pH/EC ‚Üí mesh ‚Üí ROOT ‚Üí MQTT ‚Üí Backend ‚Üí –ë–î + WebSocket ‚Üí Frontend
```

### 2. –û–±—Ä–∞—Ç–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ (–∫–æ–º–∞–Ω–¥—ã –∫ –Ω–æ–¥–∞–º):
```
Frontend ‚Üí API ‚Üí Backend ‚Üí MQTT ‚Üí ROOT ‚Üí mesh ‚Üí NODE pH/EC
```

---

## üêõ –ù–∞–π–¥–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 5 –ø—Ä–æ–±–ª–µ–º

### ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ 1: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç node_type –≤ telemetry**

**–§–∞–π–ª:** `node_ph/components/ph_manager/ph_manager.c:249`

**–ë—ã–ª–æ:**
```c
cJSON_AddStringToObject(root, "type", "telemetry");
cJSON_AddStringToObject(root, "node_id", s_config->base.node_id);
// ‚ùå –ù–µ—Ç node_type!
```

**–°—Ç–∞–ª–æ:**
```c
cJSON_AddStringToObject(root, "type", "telemetry");
cJSON_AddStringToObject(root, "node_id", s_config->base.node_id);
cJSON_AddStringToObject(root, "node_type", "ph");  // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** Backend –Ω–µ –º–æ–≥ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —É–∑–ª–∞  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:** node_ph –∏ node_ec

---

### ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç node_type –≤ heartbeat**

**–§–∞–π–ª:** `node_ph/components/ph_manager/ph_manager.c:282`

**–ë—ã–ª–æ:**
```c
cJSON_AddStringToObject(root, "type", "heartbeat");
cJSON_AddStringToObject(root, "node_id", s_config->base.node_id);
// ‚ùå –ù–µ—Ç node_type!
```

**–°—Ç–∞–ª–æ:**
```c
cJSON_AddStringToObject(root, "type", "heartbeat");
cJSON_AddStringToObject(root, "node_id", s_config->base.node_id);
cJSON_AddStringToObject(root, "node_type", "ph");  // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:** node_ph –∏ node_ec

---

### ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ 3: Backend –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∏–ø—ã "ph" –∏ "ec"**

**–§–∞–π–ª:** `server/backend/app/Services/MqttService.php:163`

**–ë—ã–ª–æ:**
```php
$validTypes = ['ph_ec', 'climate', 'relay', 'water', 'display', 'root'];
```

**–°—Ç–∞–ª–æ:**
```php
$validTypes = ['ph', 'ec', 'ph_ec', 'climate', 'relay', 'water', 'display', 'root'];
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** Telemetry —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å –∫–∞–∫ —Ç–∏–ø "unknown"

---

### ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ 4: detectNodeType –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç "ph_" –∏ "ec_"**

**–§–∞–π–ª:** `server/backend/app/Services/MqttService.php:530`

**–ë—ã–ª–æ:**
```php
if (str_starts_with($nodeId, 'ph_ec_')) {
    return 'ph_ec';
}
// ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è "ph_" –∏ "ec_"
```

**–°—Ç–∞–ª–æ:**
```php
if (str_starts_with($nodeId, 'ph_')) {
    return 'ph';  // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
}
if (str_starts_with($nodeId, 'ec_')) {
    return 'ec';  // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
}
if (str_starts_with($nodeId, 'ph_ec_')) {
    return 'ph_ec';
}
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ —Å–µ–Ω—Å–æ—Ä–∞–º:
```php
if (in_array('ph', $sensors) && !in_array('ec', $sensors)) {
    return 'ph';  // –¢–æ–ª—å–∫–æ pH
}
if (in_array('ec', $sensors) && !in_array('ph', $sensors)) {
    return 'ec';  // –¢–æ–ª—å–∫–æ EC
}
```

---

### ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ 5: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –≤ EC telemetry**

**–§–∞–π–ª:** `node_ec/components/ec_manager/ec_manager.c:253`

**–ë—ã–ª–æ:**
```c
cJSON_AddNumberToObject(data, "EC", s_current_ec);           // ‚ùå –ó–∞–≥–ª–∞–≤–Ω–∞—è
cJSON_AddNumberToObject(data, "PUMP_EC_A_ml", ...);          // ‚ùå –ó–∞–≥–ª–∞–≤–Ω—ã–µ
cJSON_AddNumberToObject(data, "PUMP_EC_B_ml", ...);          // ‚ùå –ó–∞–≥–ª–∞–≤–Ω—ã–µ
// ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç pump_ec_c_ml!
```

**–°—Ç–∞–ª–æ:**
```c
cJSON_AddNumberToObject(data, "ec", s_current_ec);           // ‚úÖ –°—Ç—Ä–æ—á–Ω–∞—è
cJSON_AddNumberToObject(data, "pump_ec_a_ml", ...);          // ‚úÖ –°—Ç—Ä–æ—á–Ω—ã–µ
cJSON_AddNumberToObject(data, "pump_ec_b_ml", ...);          // ‚úÖ –°—Ç—Ä–æ—á–Ω—ã–µ
cJSON_AddNumberToObject(data, "pump_ec_c_ml", ...);          // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** Frontend –Ω–µ –º–æ–≥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

---

## ‚úÖ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

### NODE pH - –û–ë–ù–û–í–õ–Å–ù ‚úÖ
```
Binary: node_ph.bin
–†–∞–∑–º–µ—Ä: 1,009,792 –±–∞–π—Ç (0xF6880)
–°–≤–æ–±–æ–¥–Ω–æ: 67%
–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ—à–∏–≤–∫–µ
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `node_type: "ph"` –≤ telemetry
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `node_type: "ph"` –≤ heartbeat

### NODE EC - –û–ë–ù–û–í–õ–Å–ù ‚úÖ
```
Binary: node_ec.bin
–†–∞–∑–º–µ—Ä: 1,010,384 –±–∞–π—Ç (0xF68D0)
–°–≤–æ–±–æ–¥–Ω–æ: 67%
–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ—à–∏–≤–∫–µ
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `node_type: "ec"` –≤ telemetry
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `node_type: "ec"` –≤ heartbeat
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–∏: "ec", "pump_ec_a_ml", "pump_ec_b_ml", "pump_ec_c_ml"

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ —Ü–µ–ø–æ—á–∫–∏

### ‚úÖ –≠—Ç–∞–ø 1: NODE —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç JSON

**node_ph:**
```c
// discovery
{"type":"discovery","node_id":"ph_123abc","node_type":"ph","sensors":["ph"],...}

// telemetry
{"type":"telemetry","node_id":"ph_123abc","node_type":"ph","data":{"ph":6.8,...}}

// heartbeat
{"type":"heartbeat","node_id":"ph_123abc","node_type":"ph","uptime":3600,...}
```

‚úÖ **–§–æ—Ä–º–∞—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω**

---

### ‚úÖ –≠—Ç–∞–ø 2: ROOT node –ø–∞—Ä—Å–∏—Ç –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç

**–§–∞–π–ª:** `root_node/components/data_router/data_router.c`

```c
// –ü–∞—Ä—Å–∏–Ω–≥
mesh_protocol_parse(data_copy, &msg);  // ‚úÖ OK

// –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ MQTT
switch (msg.type) {
    case MESH_MSG_TELEMETRY:
        mqtt_client_manager_publish("hydro/telemetry/ph_123abc", data_copy);
        break;
    case MESH_MSG_DISCOVERY:
        mqtt_client_manager_publish("hydro/discovery", data_copy);
        break;
    case MESH_MSG_HEARTBEAT:
        mqtt_client_manager_publish("hydro/heartbeat/ph_123abc", data_copy);
        break;
}
```

‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç**

---

### ‚úÖ –≠—Ç–∞–ø 3: MQTT BROKER –ø–æ–ª—É—á–∞–µ—Ç

**Mosquitto** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ —Ç–æ–ø–∏–∫–∏:
```
hydro/telemetry/ph_123abc
hydro/telemetry/ec_123abc
hydro/heartbeat/ph_123abc
hydro/heartbeat/ec_123abc
hydro/discovery
```

‚úÖ **–¢–æ–ø–∏–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã**

---

### ‚úÖ –≠—Ç–∞–ø 4: BACKEND MQTT Listener –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è

**–§–∞–π–ª:** `server/backend/app/Console/Commands/MqttListenerCommand.php:73`

```php
// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ telemetry
$mqtt->subscribe('hydro/telemetry/#', function ($topic, $message) use ($mqtt) {
    $mqtt->handleTelemetry($topic, $message);
});

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ heartbeat
$mqtt->subscribe('hydro/heartbeat/#', function ($topic, $message) use ($mqtt) {
    $mqtt->handleHeartbeat($topic, $message);
});

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ discovery
$mqtt->subscribe('hydro/discovery', function ($topic, $message) use ($mqtt) {
    $mqtt->handleDiscovery($topic, $message);
});
```

‚úÖ **–ü–æ–¥–ø–∏—Å–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞**

---

### ‚úÖ –≠—Ç–∞–ø 5: BACKEND –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

**–§–∞–π–ª:** `server/backend/app/Services/MqttService.php:149`

```php
public function handleTelemetry(string $topic, string $payload): void
{
    $data = json_decode($payload, true);
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞
    $validTypes = ['ph', 'ec', 'ph_ec', ...];  // ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ
    $nodeType = $data['node_type'] ?? 'unknown';  // ‚úÖ –ë–µ—Ä–µ—Ç –∏–∑ JSON
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
    $telemetry = Telemetry::create([
        'node_id' => $data['node_id'],
        'node_type' => $nodeType,
        'data' => $data['data'],
        'received_at' => now(),
    ]);
    
    // WebSocket event
    event(new TelemetryReceived($telemetry));
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —É–∑–ª–∞
    Node::updateOrCreate(
        ['node_id' => $data['node_id']],
        ['online' => true, 'last_seen_at' => now()]
    );
}
```

‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞**

---

### ‚úÖ –≠—Ç–∞–ø 6: FRONTEND –ø–æ–ª—É—á–∞–µ—Ç —á–µ—Ä–µ–∑ WebSocket

**–§–∞–π–ª:** `server/frontend/src/stores/telemetry.js`

```javascript
// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
window.Echo.channel('telemetry')
  .listen('TelemetryReceived', (event) => {
    console.log('Telemetry:', event);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
    if (event.node_type === 'ph') {
      this.updatePhData(event);
    } else if (event.node_type === 'ec') {
      this.updateEcData(event);
    }
  });
```

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥—ã updatePhData –∏ updateEcData  
üìÑ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** `BACKEND_FRONTEND_TODO.md`

---

## üîô –û–±—Ä–∞—Ç–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ (–∫–æ–º–∞–Ω–¥—ã)

### ‚úÖ Frontend ‚Üí Backend

**–ü—Ä–∏–º–µ—Ä:** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pH target = 6.0

```javascript
// Frontend
await api.sendCommand('ph_123abc', 'set_ph_target', { target: 6.0 });
// POST /api/nodes/ph_123abc/command
```

---

### ‚ö†Ô∏è Backend ‚Üí MQTT (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

**–§–∞–π–ª:** `server/backend/app/Http/Controllers/NodeController.php`

**–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:**
```php
public function sendCommand(Request $request, string $nodeId)
{
    $validated = $request->validate([
        'command' => 'required|string',
        'params' => 'nullable|array'
    ]);
    
    $command = [
        'type' => 'command',
        'node_id' => $nodeId,
        'command' => $validated['command'],
        'params' => $validated['params'] ?? []
    ];
    
    app(MqttService::class)->publish(
        "hydro/command/{$nodeId}",
        json_encode($command)
    );
    
    return response()->json(['success' => true]);
}
```

üìÑ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** –°–º. `BACKEND_FRONTEND_TODO.md`

---

### ‚úÖ MQTT ‚Üí ROOT

ROOT –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ `hydro/command/#` –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –≤ mesh:

```c
// ROOT –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É
void data_router_handle_mqtt_data(const char *topic, const char *data) {
    if (strstr(topic, "/command/")) {
        // –ò–∑–≤–ª–µ—á—å node_id –∏–∑ —Ç–æ–ø–∏–∫–∞
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ mesh
        mesh_manager_send(node->mac_addr, data, data_len);
    }
}
```

‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

---

### ‚úÖ ROOT ‚Üí NODE (mesh)

NODE –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É:

```c
// NODE –ø–æ–ª—É—á–∞–µ—Ç
void on_mesh_data_received(const uint8_t *src, const uint8_t *data, size_t len) {
    mesh_message_t msg;
    mesh_protocol_parse(data, &msg);
    
    switch (msg.type) {
        case MESH_MSG_COMMAND:
            cJSON *cmd = cJSON_GetObjectItem(msg.data, "command");
            ph_manager_handle_command(cmd->valuestring, msg.data);
            break;
    }
}
```

‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

---

### ‚úÖ NODE –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É

```c
void ph_manager_handle_command(const char *command, cJSON *params) {
    if (strcmp(command, "set_ph_target") == 0) {
        cJSON *target = cJSON_GetObjectItem(params, "target");
        s_config->ph_target = (float)target->valuedouble;
        pid_set_setpoint(&s_pid_ph_up, s_config->ph_target);
        ESP_LOGI(TAG, "pH target set to %.2f", s_config->ph_target);
    }
}
```

‚úÖ **–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

---

## üìã –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Firmware (–ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω–æ):
1. ‚úÖ `node_ph/components/ph_manager/ph_manager.c`
   - –î–æ–±–∞–≤–ª–µ–Ω node_type –≤ telemetry (—Å—Ç—Ä–æ–∫–∞ 258)
   - –î–æ–±–∞–≤–ª–µ–Ω node_type –≤ heartbeat (—Å—Ç—Ä–æ–∫–∞ 292)

2. ‚úÖ `node_ec/components/ec_manager/ec_manager.c`
   - –î–æ–±–∞–≤–ª–µ–Ω node_type –≤ telemetry (—Å—Ç—Ä–æ–∫–∞ 251)
   - –î–æ–±–∞–≤–ª–µ–Ω node_type –≤ heartbeat (—Å—Ç—Ä–æ–∫–∞ 286)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–∏: ec, pump_ec_a_ml, pump_ec_b_ml
   - –î–æ–±–∞–≤–ª–µ–Ω pump_ec_c_ml

### Backend:
3. ‚úÖ `server/backend/app/Services/MqttService.php`
   - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã "ph" –∏ "ec" –≤ validTypes (—Å—Ç—Ä–æ–∫–∞ 163)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ "ph_" –∏ "ec_" (—Å—Ç—Ä–æ–∫–∞ 540-544)
   - –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ —Å–µ–Ω—Å–æ—Ä–∞–º (—Å—Ç—Ä–æ–∫–∞ 567-575)

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: Discovery –ø–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
1. NODE –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç discovery —á–µ—Ä–µ–∑ 3 —Å–µ–∫ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞
2. ROOT –ª–æ–≥–∏—Ä—É–µ—Ç: `"üì• Mesh data received"`
3. ROOT –ø—É–±–ª–∏–∫—É–µ—Ç –≤ MQTT: `"‚úì Discovery published"`
4. BACKEND –ª–æ–≥–∏—Ä—É–µ—Ç: `"üîç AUTO-DISCOVERY: New node found"`
5. FRONTEND: –Ω–æ–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ

**–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ MQTT:**
```bash
mosquitto_sub -h localhost -t "hydro/discovery" -v
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{"type":"discovery","node_id":"ph_a1b2c3","node_type":"ph","sensors":["ph"],...}
```

---

### –¢–µ—Å—Ç 2: Telemetry –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫

**–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
mosquitto_sub -h localhost -t "hydro/telemetry/#" -v
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
hydro/telemetry/ph_a1b2c3 {"type":"telemetry","node_type":"ph","data":{"ph":6.8,...}}
hydro/telemetry/ec_a1b2c3 {"type":"telemetry","node_type":"ec","data":{"ec":2.3,...}}
```

---

### –¢–µ—Å—Ç 3: –ö–æ–º–∞–Ω–¥–∞ –æ—Ç frontend

**–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ MQTT:**
```bash
mosquitto_pub -h localhost -t "hydro/command/ph_a1b2c3" -m '{"type":"command","node_id":"ph_a1b2c3","command":"set_ph_target","params":{"target":6.0}}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª–æ–≥–∞—Ö NODE:**
```
I ph_node: Message from ROOT: type=2
I ph_mgr: Command received: set_ph_target
I ph_mgr: pH target set to 6.00
```

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| **–ü—Ä—è–º–∞—è —Ü–µ–ø–æ—á–∫–∞ (–¥–∞–Ω–Ω—ã–µ –æ—Ç –Ω–æ–¥)** |
| NODE ‚Üí JSON | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û | node_type –¥–æ–±–∞–≤–ª–µ–Ω |
| NODE ‚Üí Mesh send | ‚úÖ OK | mesh_manager —Ä–∞–±–æ—Ç–∞–µ—Ç |
| ROOT ‚Üí Parse | ‚úÖ OK | mesh_protocol –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω |
| ROOT ‚Üí MQTT | ‚úÖ OK | –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–æ–ø–∏–∫–∏ |
| Backend ‚Üí Subscribe | ‚úÖ OK | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ hydro/# |
| Backend ‚Üí Parse | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û | –¢–∏–ø—ã pH/EC –¥–æ–±–∞–≤–ª–µ–Ω—ã |
| Backend ‚Üí DB | ‚úÖ OK | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| Backend ‚Üí WebSocket | ‚úÖ OK | Events –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è |
| Frontend ‚Üí Echo | ‚úÖ OK | –ü–æ–¥–ø–∏—Å–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **–û–±—Ä–∞—Ç–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ (–∫–æ–º–∞–Ω–¥—ã –∫ –Ω–æ–¥–∞–º)** |
| Frontend ‚Üí API | ‚úÖ OK | –ú–µ—Ç–æ–¥ –µ—Å—Ç—å |
| Backend ‚Üí Controller | ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø | –°–æ–∑–¥–∞—Ç—å sendCommand |
| Backend ‚Üí MQTT | ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø | –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ |
| ROOT ‚Üí Subscribe | ‚úÖ OK | –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–æ–º–∞–Ω–¥—ã |
| ROOT ‚Üí Mesh forward | ‚úÖ OK | –ü–µ—Ä–µ—Å—ã–ª–∫–∞ –≤ mesh |
| NODE ‚Üí Parse | ‚úÖ OK | mesh_protocol |
| NODE ‚Üí Execute | ‚úÖ OK | handle_command |

---

## üéØ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–° (–±–µ–∑ backend –¥–æ—Ä–∞–±–æ—Ç–æ–∫)

‚úÖ **–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–æ–¥** - pH –∏ EC –Ω–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ  
‚úÖ **PID —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è pH/EC  
‚úÖ **Mesh —Å–µ—Ç—å** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ROOT  
‚úÖ **Discovery** - –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–¥  
‚úÖ **Telemetry** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫  
‚úÖ **Heartbeat** - keepalive –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫  
‚úÖ **Backend —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ë–î  
‚úÖ **WebSocket —Å–æ–±—ã—Ç–∏—è** - TelemetryReceived –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è  

---

## ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –≤–µ–±-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **Backend:**
   - –ú–µ—Ç–æ–¥ sendCommand –≤ NodeController
   - MQTT –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥

2. **Frontend:**
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã PhNode.vue –∏ EcNode.vue
   - –§–æ—Ä–º—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è pH/EC
   - –ì—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–í—Ä–µ–º—è –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É:** ~4-6 —á–∞—Å–æ–≤

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** `BACKEND_FRONTEND_TODO.md`

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
‚úÖ 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –≤ JSON —Ñ–æ—Ä–º–∞—Ç–∞—Ö  
‚úÖ Backend –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∏–ø—ã "ph" –∏ "ec"  
‚úÖ –û–±–µ –Ω–æ–¥—ã –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏  
‚úÖ –ü—Ä—è–º–∞—è —Ü–µ–ø–æ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%  
‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ ROOT/NODE —É—Ä–æ–≤–Ω–µ  

### –¢—Ä–µ–±—É–µ—Ç—Å—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
‚ö†Ô∏è Backend –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è –∫–æ–º–∞–Ω–¥  
‚ö†Ô∏è Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è  

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. ‚úÖ –ü—Ä–æ—à–∏—Ç—å –æ–±–µ –Ω–æ–¥—ã (—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ JSON)
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å ROOT node
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MQTT —Å–æ–æ–±—â–µ–Ω–∏—è
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ –≤ –ë–î
5. ‚è∏Ô∏è (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å backend/frontend –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ù–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** üéØ

---

**–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!**  
**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!**  
**–¶–µ–ø–æ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!** ‚úÖ

