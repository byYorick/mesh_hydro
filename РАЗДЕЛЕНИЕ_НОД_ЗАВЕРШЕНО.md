# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ node_ph_ec –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –Ω–æ–¥—ã - –ó–ê–í–ï–†–®–ï–ù–û ‚úÖ

**–î–∞—Ç–∞:** 21 –æ–∫—Ç—è–±—Ä—è 2025  
**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:** –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–µ–∏—Ö –Ω–æ–¥  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Å–±–æ—Ä–∫–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üéØ –ó–∞–¥–∞—á–∞

–†–∞–∑–¥–µ–ª–∏—Ç—å `node_ph_ec` –Ω–∞ –¥–≤–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –Ω–æ–¥—ã –Ω–∞ ESP32-C3:
- **node_ph**: pH –¥–∞—Ç—á–∏–∫ + 2 –Ω–∞—Å–æ—Å–∞ (UP/DOWN) + PID
- **node_ec**: EC –¥–∞—Ç—á–∏–∫ + 3 –Ω–∞—Å–æ—Å–∞ (A/B/C) + PID

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. NODE pH - –ì–û–¢–û–í
```
node_ph/
‚îú‚îÄ‚îÄ components/         # 8 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ph_sensor/     # Trema pH (I2C 0x4D)
‚îÇ   ‚îú‚îÄ‚îÄ pump_controller/  # 2 –Ω–∞—Å–æ—Å–∞ (GPIO 2,3)
‚îÇ   ‚îú‚îÄ‚îÄ pid_controller/
‚îÇ   ‚îú‚îÄ‚îÄ ph_manager/    # –ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä pH
‚îÇ   ‚îú‚îÄ‚îÄ oled_display/
‚îÇ   ‚îú‚îÄ‚îÄ connection_monitor/
‚îÇ   ‚îú‚îÄ‚îÄ local_storage/
‚îÇ   ‚îî‚îÄ‚îÄ buzzer_led/
‚îú‚îÄ‚îÄ main/app_main.c    # –ü–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ CMakeLists.txt     # ESP32-C3
‚îú‚îÄ‚îÄ sdkconfig.defaults
‚îú‚îÄ‚îÄ partitions.csv
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ AI_INSTRUCTIONS.md
‚îî‚îÄ‚îÄ READY_TO_BUILD.md
```

**–ö–æ–º–∞–Ω–¥–∞ —Å–±–æ—Ä–∫–∏:**
```bash
cd node_ph
idf.py set-target esp32c3
idf.py build
idf.py -p COMX flash monitor
```

### 2. NODE EC - –ì–û–¢–û–í
```
node_ec/
‚îú‚îÄ‚îÄ components/         # 8 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ec_sensor/     # Trema EC (I2C 0x64)
‚îÇ   ‚îú‚îÄ‚îÄ pump_controller/  # 3 –Ω–∞—Å–æ—Å–∞ (GPIO 2,3,4)
‚îÇ   ‚îú‚îÄ‚îÄ pid_controller/
‚îÇ   ‚îú‚îÄ‚îÄ ec_manager/    # –ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä EC
‚îÇ   ‚îú‚îÄ‚îÄ oled_display/
‚îÇ   ‚îú‚îÄ‚îÄ connection_monitor/
‚îÇ   ‚îú‚îÄ‚îÄ local_storage/
‚îÇ   ‚îî‚îÄ‚îÄ buzzer_led/
‚îú‚îÄ‚îÄ main/app_main.c    # –ü–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ CMakeLists.txt     # ESP32-C3
‚îú‚îÄ‚îÄ sdkconfig.defaults
‚îú‚îÄ‚îÄ partitions.csv
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ AI_INSTRUCTIONS.md
‚îî‚îÄ‚îÄ READY_TO_BUILD.md
```

**–ö–æ–º–∞–Ω–¥–∞ —Å–±–æ—Ä–∫–∏:**
```bash
cd node_ec
idf.py set-target esp32c3
idf.py build
idf.py -p COMX flash monitor
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ node_config
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π:
- `ph_node_config_t` - –¥–ª—è node_ph (2 –Ω–∞—Å–æ—Å–∞)
- `ec_node_config_t` - –¥–ª—è node_ec (3 –Ω–∞—Å–æ—Å–∞)

**–§–∞–π–ª:** `common/node_config/node_config.h`

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- README.md –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã
- AI_INSTRUCTIONS.md –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã
- READY_TO_BUILD.md - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–±–æ—Ä–∫–µ
- SPLIT_NODES_SUMMARY.md - –æ–±—â–∞—è —Å–≤–æ–¥–∫–∞
- BACKEND_FRONTEND_TODO.md - –ø–ª–∞–Ω –¥–ª—è backend/frontend

---

## üìã –†–∞—Å–ø–∏–Ω–æ–≤–∫–∞

### NODE pH (ESP32-C3)
| GPIO | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| 8 | I2C SDA (pH + OLED) |
| 9 | I2C SCL (pH + OLED) |
| 2 | Pump pH UP |
| 3 | Pump pH DOWN |
| 4 | LED Status |
| 5 | Buzzer |

**I2C —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
- pH Sensor: 0x4D
- OLED SSD1306: 0x3C

### NODE EC (ESP32-C3)
| GPIO | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| 8 | I2C SDA (EC + OLED) |
| 9 | I2C SCL (EC + OLED) |
| 2 | Pump EC A |
| 3 | Pump EC B |
| 4 | Pump EC C |
| 5 | LED Status |
| 6 | Buzzer |

**I2C —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
- EC Sensor: 0x64
- OLED SSD1306: 0x3C

---

## üîß –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –û–±–µ –Ω–æ–¥—ã:
‚úÖ **–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ ROOT  
‚úÖ **Emergency Protection** - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö  
‚úÖ **Mock —Ä–µ–∂–∏–º** - —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –¥–∞—Ç—á–∏–∫–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è  
‚úÖ **PID —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - —Ç–æ—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è pH/EC  
‚úÖ **Mesh –ø—Ä–æ—Ç–æ–∫–æ–ª** - Discovery, Telemetry, Heartbeat  
‚úÖ **NVS —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫  
‚úÖ **Safety** - –ª–∏–º–∏—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã –Ω–∞—Å–æ—Å–æ–≤  

### node_ph:
- pH target: 6.5 (–¥–∏–∞–ø–∞–∑–æ–Ω 5.5-7.5)
- 2 –Ω–∞—Å–æ—Å–∞: UP/DOWN
- PID (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π): Kp=1.0, Ki=0.05, Kd=0.3
- Emergency –ø—Ä–∏ pH < 5.5 –∏–ª–∏ > 7.5

### node_ec:
- EC target: 2.5 mS/cm (–¥–∏–∞–ø–∞–∑–æ–Ω 1.5-4.0)
- 3 –Ω–∞—Å–æ—Å–∞: A (50%), B (40%), C (10%)
- PID (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π): Kp=0.8, Ki=0.02, Kd=0.2
- Emergency –ø—Ä–∏ EC > 4.0

---

## üì° Mesh –ø—Ä–æ—Ç–æ–∫–æ–ª

### Discovery (node_ph):
```json
{
  "type": "discovery",
  "node_id": "ph_XXXXXX",
  "node_type": "ph",
  "actuators": ["pump_ph_up", "pump_ph_down"],
  "sensors": ["ph"],
  "mac": "XX:XX:XX:XX:XX:XX"
}
```

### Discovery (node_ec):
```json
{
  "type": "discovery",
  "node_id": "ec_XXXXXX",
  "node_type": "ec",
  "actuators": ["pump_ec_a", "pump_ec_b", "pump_ec_c"],
  "sensors": ["ec"],
  "mac": "XX:XX:XX:XX:XX:XX"
}
```

### Telemetry:
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ —Å —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –Ω–∞—Å–æ—Å–æ–≤.

### Heartbeat:
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ —Å uptime –∏ heap info.

---

## ‚è≠Ô∏è –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### Backend (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–∏–ø–æ–≤ "ph" –∏ "ec" –≤ MQTT listeners
- –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã PhNodeController –∏ EcNodeController
- –î–æ–±–∞–≤–∏—Ç—å routes –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

üìÑ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** `BACKEND_FRONTEND_TODO.md`

### Frontend (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã PhNode.vue –∏ EcNode.vue
- –û–±–Ω–æ–≤–∏—Ç—å Dashboard –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –Ω–æ–¥
- –î–æ–±–∞–≤–∏—Ç—å WebSocket —Å–ª—É—à–∞—Ç–µ–ª–∏

üìÑ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** `BACKEND_FRONTEND_TODO.md`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ. Backend/Frontend –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞
```bash
# NODE pH
cd node_ph
idf.py set-target esp32c3
idf.py build
idf.py -p COM3 flash monitor

# NODE EC
cd node_ec
idf.py set-target esp32c3
idf.py build
idf.py -p COM4 flash monitor
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –º–æ–Ω–∏—Ç–æ—Ä–µ
–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
```
I ph_node: [Step 1/8] NVS init...
I ph_node: [Step 2/8] Loading config...
I ph_node: [Step 3/8] I2C init...
I ph_node: [Step 4/8] pH Sensor init...
I ph_node: [Step 5/8] Pumps init (2x PWM)...
I ph_node: [Step 6/8] Mesh NODE mode init...
I ph_node: [Step 7/8] pH Manager init...
I ph_node: [Step 8/8] Starting...
I ph_node: ‚ïë  NODE pH Running! ‚úì  ‚ïë
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ mesh –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```
I mesh_mgr: Mesh connected
I ph_mgr: Discovery sent
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ telemetry
```
I ph_mgr: Telemetry sent
```

---

## üìö –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
```
node_ph/                    # –ü–æ–ª–Ω–∞—è –Ω–æ–¥–∞ pH
node_ec/                    # –ü–æ–ª–Ω–∞—è –Ω–æ–¥–∞ EC
common/node_config/         # –û–±–Ω–æ–≤–ª–µ–Ω
SPLIT_NODES_SUMMARY.md      # –û–±—â–∞—è —Å–≤–æ–¥–∫–∞
BACKEND_FRONTEND_TODO.md    # –ü–ª–∞–Ω backend/frontend
–†–ê–ó–î–ï–õ–ï–ù–ò–ï_–ù–û–î_–ó–ê–í–ï–†–®–ï–ù–û.md # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–î–≤–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –Ω–æ–¥—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**  
‚úÖ **ESP32-C3** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞—Å–ø–∏–Ω–æ–≤–∫–∞  
‚úÖ **–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç ROOT  
‚úÖ **PID —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - —Ç–æ—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è pH –∏ EC  
‚úÖ **Safety** - emergency protection  
‚úÖ **Mesh –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - discovery, telemetry, heartbeat  
‚úÖ **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - README, AI instructions, build guides  

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ—à–∏—Ç—å –æ–±–µ –Ω–æ–¥—ã** –Ω–∞ ESP32-C3 –ø–ª–∞—Ç—ã
2. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å –¥–∞—Ç—á–∏–∫–∏** (–∏–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ mock —Ä–µ–∂–∏–º–µ)
3. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫ mesh —Å–µ—Ç–∏** (—É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ ROOT –∑–∞–ø—É—â–µ–Ω)
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å discovery** –≤ –ª–æ–≥–∞—Ö ROOT –Ω–æ–¥—ã
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å telemetry** (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
6. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å PID** - –∏–∑–º–µ–Ω–∏—Ç—å pH/EC –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞—Å–æ—Å–æ–≤
7. **(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û–±–Ω–æ–≤–∏—Ç—å backend/frontend** –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

---

**–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!** üéâ  
**–û–±–µ –Ω–æ–¥—ã –≥–æ—Ç–æ–≤—ã –∫ —Å–±–æ—Ä–∫–µ, –ø—Ä–æ—à–∏–≤–∫–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!**

