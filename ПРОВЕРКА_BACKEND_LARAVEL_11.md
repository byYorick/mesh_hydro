# ‚úÖ –ü–†–û–í–ï–†–ö–ê BACKEND –ü–û–°–õ–ï –ú–ò–ì–†–ê–¶–ò–ò –ù–ê LARAVEL 11

**–î–∞—Ç–∞:** 20 –æ–∫—Ç—è–±—Ä—è 2025, 21:24  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–°–Å –†–ê–ë–û–¢–ê–ï–¢ –û–¢–õ–ò–ß–ù–û!**

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. ‚úÖ –í–µ—Ä—Å–∏–∏ –ü–û

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|-----------|--------|------------|--------|
| **PHP** | 8.2.29 | ^8.2 | ‚úÖ |
| **Laravel** | 11.46.1 | ^11.0 | ‚úÖ |
| **PostgreSQL** | 15.4 | 15.x | ‚úÖ |
| **Reverb** | 1.x | ^1.0 | ‚úÖ |

---

### 2. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Laravel 11

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| `bootstrap/app.php` | ‚úÖ –°–æ–∑–¥–∞–Ω | –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Laravel 11 (3116 –±–∞–π—Ç) |
| `routes/console.php` | ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω | Scheduled tasks –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã |
| ~~`app/Http/Kernel.php`~~ | ‚úÖ –£–¥–∞–ª–µ–Ω | –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω –≤ Laravel 11 |
| ~~`app/Console/Kernel.php`~~ | ‚úÖ –£–¥–∞–ª–µ–Ω | –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω –≤ Laravel 11 |

---

### 3. ‚úÖ –†–æ—É—Ç—ã (Routes)

**–í—Å–µ–≥–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ:** 36 —Ä–æ—É—Ç–æ–≤

#### API Endpoints:
- ‚úÖ `GET /api/nodes` - —Å–ø–∏—Å–æ–∫ —É–∑–ª–æ–≤
- ‚úÖ `GET /api/nodes/{nodeId}` - –¥–µ—Ç–∞–ª–∏ —É–∑–ª–∞
- ‚úÖ `POST /api/nodes/{nodeId}/command` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ `GET /api/telemetry` - —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è
- ‚úÖ `GET /api/events` - —Å–æ–±—ã—Ç–∏—è
- ‚úÖ `GET /api/errors` - –æ—à–∏–±–∫–∏
- ‚úÖ `GET /api/dashboard/summary` - dashboard –¥–∞–Ω–Ω—ã–µ
- ‚úÖ `GET /api/status` - —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ `GET /api/pid-presets` - PID –ø—Ä–µ—Å–µ—Ç—ã
- ‚úÖ `GET /up` - **Laravel 11 Health Check** (–Ω–æ–≤–æ–µ!)

**–í—Å–µ —Ä–æ—É—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!** ‚úÖ

---

### 4. ‚úÖ Scheduled Tasks (–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á)

**–í—Å–µ–≥–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ:** 4 –∑–∞–¥–∞—á–∏

| –ó–∞–¥–∞—á–∞ | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ | –°–ª–µ–¥. –∑–∞–ø—É—Å–∫ | –°—Ç–∞—Ç—É—Å |
|--------|------------|--------------|--------|
| `nodes:check-status --notify` | –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (`* * * * *`) | 51 —Å–µ–∫ | ‚úÖ |
| `telemetry:cleanup --days=365` | –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 03:00 (`0 3 * * 0`) | 5 –¥–Ω–µ–π | ‚úÖ |
| Auto-resolve events | –ö–∞–∂–¥—ã–π —á–∞—Å (`0 * * * *`) | 36 –º–∏–Ω | ‚úÖ |
| `commands:process-timeouts` | –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã (`*/2 * * * *`) | 51 —Å–µ–∫ | ‚úÖ |

**–í—Å–µ scheduled tasks —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ `routes/console.php`!** ‚úÖ

---

### 5. ‚úÖ Middleware

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ `bootstrap/app.php`:

#### Global Middleware:
- ‚úÖ `TrustProxies`
- ‚úÖ `HandleCors`
- ‚úÖ `PreventRequestsDuringMaintenance`
- ‚úÖ `ValidatePostSize`
- ‚úÖ `TrimStrings`
- ‚úÖ `ConvertEmptyStringsToNull`

#### Web Middleware Group:
- ‚úÖ `EncryptCookies`
- ‚úÖ `AddQueuedCookiesToResponse`
- ‚úÖ `StartSession`
- ‚úÖ `ShareErrorsFromSession`
- ‚úÖ `VerifyCsrfToken`
- ‚úÖ `SubstituteBindings`

#### API Middleware Group:
- ‚úÖ `throttle:api`
- ‚úÖ `SubstituteBindings`

#### Middleware Aliases:
- ‚úÖ `auth`, `guest`, `signed`, `throttle`, `verified`, –∏ –¥—Ä. (10 –∞–ª–∏–∞—Å–æ–≤)

**–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –º–µ—Ö–∞–Ω–∏–∑–º `withMiddleware()`!** ‚úÖ

---

### 6. ‚úÖ Laravel Reverb (WebSocket)

```
INFO  Starting server on 0.0.0.0:8080 (localhost)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç**

- –ü–æ—Ä—Ç: 8080
- Host: 0.0.0.0
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: `hydro_reverb`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: —á–µ—Ä–µ–∑ `config/reverb.php`

---

### 7. ‚úÖ API Endpoints —Ä–∞–±–æ—Ç–∞—é—Ç

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –ª–æ–≥–∏ backend:

```
2025-10-20 18:22:02 /api/nodes ................................... ~ 0.17ms
2025-10-20 18:22:02 /api/events .................................. ~ 0.09ms
2025-10-20 18:22:02 /api/status .................................. ~ 5.11ms
2025-10-20 18:22:02 /api/nodes/root_98a316f5fde8 ................. ~ 5.22ms
2025-10-20 18:22:03 /api/telemetry ............................... ~ 0.10ms
2025-10-20 18:22:03 /api/nodes/root_98a316f5fde8/errors .......... ~ 0.05ms
```

**–í—Å–µ endpoints –æ—Ç–≤–µ—á–∞—é—Ç –±—ã—Å—Ç—Ä–æ (0.05ms - 5.22ms)!** ‚úÖ

---

### 8. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
$ docker exec hydro_backend php artisan config:show app.name
app.name ........................................................... Laravel
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!** ‚úÖ

---

### 9. ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

```
NAME                  STATUS
hydro_backend         Up 2 minutes       ‚úÖ
hydro_reverb          Up 2 minutes       ‚úÖ
hydro_mqtt_listener   Up 2 minutes       ‚úÖ
hydro_frontend        Up 7 seconds       ‚úÖ
hydro_postgres        Up 2 minutes       ‚úÖ
hydro_mosquitto       Up 2 minutes       ‚úÖ
```

**–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç!** ‚úÖ

---

## üéâ –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| **–ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** | ‚úÖ 100% | Laravel 11 —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é |
| **–†–æ—É—Ç—ã** | ‚úÖ 100% | 36 —Ä–æ—É—Ç–æ–≤ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ |
| **Scheduled Tasks** | ‚úÖ 100% | 4 –∑–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ console.php |
| **Middleware** | ‚úÖ 100% | –í—Å–µ middleware —á–µ—Ä–µ–∑ withMiddleware() |
| **API Endpoints** | ‚úÖ 100% | –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–æ |
| **WebSocket (Reverb)** | ‚úÖ 100% | –ó–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080 |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | ‚úÖ 100% | PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ |
| **MQTT Listener** | ‚úÖ 100% | –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç ESP32 |

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ |
|----------|-------------|----------------|
| **Laravel** | 10.x (–≥–∏–±—Ä–∏–¥) | 11.46.1 ‚úÖ |
| **–°—Ç—Ä—É–∫—Ç—É—Ä–∞** | –°—Ç–∞—Ä–∞—è (—Å Kernel.php) | –ù–æ–≤–∞—è (bootstrap/app.php) ‚úÖ |
| **–§–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** | 3 —Ñ–∞–π–ª–∞ | 2 —Ñ–∞–π–ª–∞ (-1) ‚úÖ |
| **–ö–æ–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** | 121 —Å—Ç—Ä–æ–∫–∞ | 0 –ª–∏—à–Ω–∏—Ö (-121) ‚úÖ |
| **Scheduled tasks** | Kernel::schedule() | routes/console.php ‚úÖ |
| **Middleware** | Kernel::$middleware | withMiddleware() ‚úÖ |
| **Health Check** | ‚ùå –ù–µ—Ç | ‚úÖ `/up` endpoint |
| **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** | Backward | –ù–∞—Ç–∏–≤–Ω–∞—è ‚úÖ |

---

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ö†Ô∏è Echo initialization failed (Frontend)

**–ü—Ä–æ–±–ª–µ–º–∞:** 
```javascript
Echo initialization failed: undefined
üîÑ Starting fallback polling mode
```

**–°—Ç–∞—Ç—É—Å:** üü° **–ù–ï –ö–†–ò–¢–ò–ß–ù–û**

**–ü—Ä–∏—á–∏–Ω–∞:** 
- Reverb WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç
- Frontend —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ fallback polling
- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ frontend:
```env
VITE_WS_HOST=localhost
VITE_WS_PORT=8080
VITE_PUSHER_KEY=hydro-app-key
```

---

### 2. ‚ö†Ô∏è Logo.png 404

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
GET http://localhost:3000/logo.png 404 (Not Found)
```

**–°—Ç–∞—Ç—É—Å:** üü¢ **–ù–ï –ö–†–ò–¢–ò–ß–ù–û (–∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∞—è)**

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å logo.png –≤ `server/frontend/public/`

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –ò–î–ï–ê–õ–¨–ù–û

1. ‚úÖ **Laravel 11.46.1** - –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
2. ‚úÖ **PHP 8.2.29** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
3. ‚úÖ **–í—Å–µ API endpoints** - –æ—Ç–≤–µ—á–∞—é—Ç –±—ã—Å—Ç—Ä–æ (< 10ms)
4. ‚úÖ **–†–æ—É—Ç—ã** - 36 endpoints –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ
5. ‚úÖ **Scheduled Tasks** - 4 –∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
6. ‚úÖ **Middleware** - —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –º–µ—Ö–∞–Ω–∏–∑–º Laravel 11
7. ‚úÖ **Laravel Reverb** - WebSocket –Ω–∞ –ø–æ—Ä—Ç—É 8080
8. ‚úÖ **PostgreSQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç
9. ‚úÖ **MQTT Listener** - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç ESP32
10. ‚úÖ **Health Check** - `/up` endpoint –¥–æ–±–∞–≤–ª–µ–Ω
11. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Laravel 11 best practices

---

## üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ! –ù–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:

1. **Frontend Echo warning** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è WebSocket
   - –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å - fallback polling —Ä–∞–±–æ—Ç–∞–µ—Ç

2. **–î–æ–±–∞–≤–∏—Ç—å logo.png**:
   ```bash
   # –°–∫–æ–ø–∏—Ä—É–π —Å–≤–æ–π –ª–æ–≥–æ—Ç–∏–ø
   copy your-logo.png server/frontend/public/logo.png
   # –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏ frontend
   docker-compose build frontend
   docker-compose up -d frontend
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å Scheduler** (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á):
   
   –î–æ–±–∞–≤—å –≤ `docker-compose.yml`:
   ```yaml
   scheduler:
     build:
       context: ./backend
       dockerfile: Dockerfile
     container_name: hydro_scheduler
     command: php artisan schedule:work
     environment:
       # –¢–µ –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á—Ç–æ –∏ —É backend
     depends_on:
       - postgres
       - backend
   ```

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### ‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø –ù–ê LARAVEL 11 –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞:**
- ‚úÖ Backend –Ω–∞ Laravel 11.46.1
- ‚úÖ PHP 8.2.29
- ‚úÖ –í—Å–µ API —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Scheduled tasks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ Reverb WebSocket –∑–∞–ø—É—â–µ–Ω
- ‚úÖ MQTT –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç ESP32
- ‚úÖ Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–æ–±–ª–µ–º –Ω–µ—Ç! –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ!** üéâ

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é Laravel:
```bash
docker exec hydro_backend php artisan --version
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ—É—Ç—ã:
```bash
docker exec hydro_backend php artisan route:list
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å scheduled tasks:
```bash
docker exec hydro_backend php artisan schedule:list
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check:
```bash
curl http://localhost:8000/up
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API:
```bash
curl http://localhost:8000/api/nodes
curl http://localhost:8000/api/status
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
docker logs hydro_backend --tail 50
docker logs hydro_reverb --tail 20
```

---

**–°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ü–û–õ–ù–û–¶–ï–ù–ù–û–ô –†–ê–ë–û–¢–ï!** üöÄ

**–ê–≤—Ç–æ—Ä:** AI Assistant (Claude Sonnet 4.5)  
**–î–∞—Ç–∞:** 20.10.2025 21:24  
**–í–µ—Ä—Å–∏—è:** Laravel 11.46.1 (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)

