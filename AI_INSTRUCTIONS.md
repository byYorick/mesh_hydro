# ü§ñ AI INSTRUCTIONS –¥–ª—è Mesh Hydro System V2

## –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### –ü—Ä–∞–≤–∏–ª–æ #1: NODE pH/EC - –°–í–Ø–¢–û–ï!
- ‚úÖ –í–°–ï–ì–î–ê –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏
- ‚úÖ –í–°–ï–ì–î–ê —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ NVS
- ‚úÖ –í–°–ï–ì–î–ê –ª–æ–∫–∞–ª—å–Ω—ã–π ring buffer (1000 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ –í–°–ï–ì–î–ê watchdog reset
- ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏ —Å ROOT

### –ü—Ä–∞–≤–∏–ª–æ #2: JSON —Ä–∞–∑–º–µ—Ä < 1 KB
- Mesh –ø–∞–∫–µ—Ç: –º–∞–∫—Å–∏–º—É–º 1456 –±–∞–π—Ç
- –ò—Å–ø–æ–ª—å–∑—É–π –∫—Ä–∞—Ç–∫–∏–µ –∫–ª—é—á–∏ –≤ JSON
- –ë–∞—Ç—á–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (10 –∑–∞–ø–∏—Å–µ–π –∑–∞ —Ä–∞–∑)

### –ü—Ä–∞–≤–∏–ª–æ #3: –ò—Å–ø–æ–ª—å–∑—É–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
- –ü–æ—Ä—Ç–∏—Ä—É–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ `hydro1.0`, –Ω–µ –ø–∏—à–∏ —Å –Ω—É–ª—è:
  - `sensor_manager` (pH, EC)
  - `pump_manager` (5 –Ω–∞—Å–æ—Å–æ–≤)
  - `adaptive_pid` (AI PID)
  - `lvgl_ui` (LVGL —ç–∫—Ä–∞–Ω—ã)
  - `lcd_ili9341` (TFT –¥–∏—Å–ø–ª–µ–π)
  - `encoder` (—Ä–æ—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —ç–Ω–∫–æ–¥–µ—Ä)

### –ü—Ä–∞–≤–∏–ª–æ #4: NVS –¥–ª—è –í–°–ï–• —É–∑–ª–æ–≤
- –ö–∞–∂–¥—ã–π —É–∑–µ–ª —Ö—Ä–∞–Ω–∏—Ç —Å–≤–æ—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ NVS
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `config` –æ—Ç ROOT
- Fallback –Ω–∞ NVS –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏ —Å ROOT
- –°—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: —Å–º. `common/node_config/node_config.h`

### –ü—Ä–∞–≤–∏–ª–æ #5: PWM –¥–ª—è —Å–≤–µ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ledc_timer` ESP-IDF
- –ß–∞—Å—Ç–æ—Ç–∞: 5000 Hz
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: 8 –±–∏—Ç (0-255)
- –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã (fade)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (common/)
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –í–°–ï–ú–ò —É–∑–ª–∞–º–∏ —á–µ—Ä–µ–∑ —Å–∏–º–ª–∏–Ω–∫–∏ –∏–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:
- `mesh_manager/` - ESP-WIFI-MESH —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- `mesh_protocol/` - JSON –ø—Ä–æ—Ç–æ–∫–æ–ª
- `node_config/` - NVS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `ota_manager/` - OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `sensor_base/` - –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–∞—Ç—á–∏–∫–æ–≤
- `actuator_base/` - –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π

### ROOT NODE (root_node/)
–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä mesh + MQTT:
- `node_registry/` - —Ä–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö —É–∑–ª–æ–≤
- `mqtt_client/` - MQTT –∫–ª–∏–µ–Ω—Ç
- `data_router/` - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `climate_logic/` - —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–ª–∏–º–∞—Ç–∞
- `ota_coordinator/` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è OTA

### NODE —É–∑–ª—ã
–ö–∞–∂–¥—ã–π NODE –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞–ø–∫–µ:
- `node_display/` - TFT –¥–∏—Å–ø–ª–µ–π
- `node_ph_ec/` - pH/EC –∫–æ–Ω—Ç—Ä–æ–ª—å (–∫—Ä–∏—Ç–∏—á–Ω—ã–π!)
- `node_climate/` - –¥–∞—Ç—á–∏–∫–∏ –∫–ª–∏–º–∞—Ç–∞
- `node_relay/` - —Ñ–æ—Ä—Ç–æ—á–∫–∏ + –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è + —Å–≤–µ—Ç
- `node_water/` - –Ω–∞—Å–æ—Å—ã + –∫–ª–∞–ø–∞–Ω—ã

### –°–µ—Ä–≤–µ—Ä (server/)
- `backend/` - Laravel 10 API
- `frontend/` - Vue.js 3 + Vuetify 3
- `mqtt_bridge/` - MQTT –¥–µ–º–æ–Ω—ã

## –ü—Ä–æ—Ç–æ–∫–æ–ª mesh –æ–±–º–µ–Ω–∞

–§–æ—Ä–º–∞—Ç: JSON (cJSON –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π:

**1. –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è (NODE ‚Üí ROOT):**
```json
{
  "type": "telemetry",
  "node_id": "ph_ec_001",
  "timestamp": 1697548800,
  "data": {"ph": 6.5, "ec": 1.8}
}
```

**2. –ö–æ–º–∞–Ω–¥–∞ (ROOT ‚Üí NODE):**
```json
{
  "type": "command",
  "node_id": "ph_ec_001",
  "command": "run_pump",
  "params": {"pump": "ph_up", "duration_ms": 5000}
}
```

**3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (ROOT ‚Üí NODE):**
```json
{
  "type": "config",
  "node_id": "ph_ec_001",
  "config": {"ph_target": 6.8, "ec_target": 2.0}
}
```

**4. –°–æ–±—ã—Ç–∏–µ (NODE ‚Üí ROOT):**
```json
{
  "type": "event",
  "node_id": "ph_ec_001",
  "level": "critical",
  "message": "pH –∫—Ä–∏—Ç–∏—á–Ω–æ –Ω–∏–∑–∫–∏–π: 4.8"
}
```

**5. Heartbeat (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫):**
```json
{
  "type": "heartbeat",
  "node_id": "ph_ec_001",
  "uptime": 36000
}
```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –°–±–æ—Ä–∫–∞ —É–∑–ª–∞
```bash
cd node_ph_ec
idf.py build
idf.py -p COM3 flash monitor
```

### –û—á–∏—Å—Ç–∫–∞
```bash
idf.py fullclean
```

### Menuconfig
```bash
idf.py menuconfig
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
idf.py monitor
```

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–°–º. —Ñ–∞–∑—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `doc/MESH_HYDRO_V2_FINAL_PLAN.md`:
1. –ë–∞–∑–æ–≤–∞—è mesh-—Å–µ—Ç—å (3-4 –¥–Ω—è)
2. ROOT —É–∑–µ–ª (3-4 –¥–Ω—è)
3. –°–µ—Ä–≤–µ—Ä –±–∞–∑–æ–≤—ã–π (3-4 –¥–Ω—è)
4. **NODE pH/EC (4-5 –¥–Ω–µ–π) ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û!**
5. Vue Dashboard (3-4 –¥–Ω—è)
6. NODE Display (3-4 –¥–Ω—è)
7. Climate + Relay (3-4 –¥–Ω—è)
8. Water (2-3 –¥–Ω—è)
9. Telegram + SMS (2-3 –¥–Ω—è)
10. OTA —Å–∏—Å—Ç–µ–º–∞ (3-4 –¥–Ω—è)
11. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (1-2 –¥–Ω—è)
12. Backup + Export/Import (1-2 –¥–Ω—è)
13. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (2-3 –¥–Ω—è)
14. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (3-5 –¥–Ω–µ–π)

**–ò–¢–û–ì–û:** 36-51 –¥–µ–Ω—å

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- ESP-IDF: https://docs.espressif.com/projects/esp-idf/en/latest/
- ESP-WIFI-MESH: https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/mesh.html
- LVGL: https://docs.lvgl.io/
- Laravel: https://laravel.com/docs/10.x
- Vue.js 3: https://vuejs.org/guide/

---

**–°–ª–µ–¥—É–π —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!**

