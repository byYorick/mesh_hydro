# 🌿 MESH HYDRO V2.0

**Распределённая гидропонная система на основе ESP-WIFI-MESH**

---

## 🎯 О ПРОЕКТЕ

Mesh Hydro V2.0 - автоматизированная система управления гидропонной теплицей с использованием mesh-сети ESP32 устройств. Система обеспечивает:

- 🌡️ **Мониторинг климата** - температура, влажность, CO2, освещенность
- 💧 **Управление pH/EC** - автоматическая коррекция питательного раствора
- ⚙️ **Управление климатом** - форточки, вентиляция, LED свет
- 🚰 **Управление водой** - насосы, клапаны, мониторинг уровня
- 📊 **Dashboard в реальном времени** - веб-интерфейс + локальный TFT дисплей

---

## 🏗️ АРХИТЕКТУРА

```
┌─────────────────────────────────────────────────────────┐
│                    SERVER (Backend)                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   Laravel    │  │     MQTT     │  │   Vue.js     │  │
│  │   API        │◄─┤   Listener   │  │  Dashboard   │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└──────────────┬──────────────────────────────────────────┘
               │
               │ MQTT (192.168.1.100:1883)
               │
        ┌──────▼──────┐
        │   ROOT      │ ESP32-S3 #1 (Координатор)
        │   NODE      │ • Wi-Fi STA → Роутер
        └──────┬──────┘ • Mesh AP → NODE узлы
               │        • MQTT → Server
               │
        ┌──────┴─────────────────────────┐
        │   ESP-WIFI-MESH Network        │
        │                                 │
    ┌───▼────┐  ┌────────┐  ┌──────────┐│
    │Climate │  │ pH/EC  │  │  Relay   ││
    │ ESP32  │  │ESP32-S3│  │  ESP32   ││
    └────────┘  └────────┘  └──────────┘│
                                         │
    ┌────────┐  ┌─────────────────────┐ │
    │ Water  │  │      Display        │ │
    │ESP32-C3│  │    ESP32-S3 #2      │ │
    └────────┘  └─────────────────────┘ │
                                         │
                  (TFT 320x240)          │
                                         │
└────────────────────────────────────────┘
```

---

## 🚀 БЫСТРЫЙ СТАРТ

### 1️⃣ Запуск Backend:
```batch
tools\server_start.bat
```

### 2️⃣ Прошивка ROOT:
```batch
tools\flash_root.bat
```

### 3️⃣ Прошивка Climate NODE:
```batch
tools\flash_climate.bat
```

### 4️⃣ Открой Dashboard:
http://localhost:3000

---

**📖 ПОЛНАЯ ИНСТРУКЦИЯ:** [START_HERE.md](START_HERE.md)

---

## 📦 КОМПОНЕНТЫ СИСТЕМЫ

### ROOT NODE (ESP32-S3 #1):
- Координатор mesh-сети
- MQTT мост (связь с сервером)
- Реестр всех узлов
- Маршрутизатор данных
- Резервная логика климата

### NODE Climate (ESP32):
- **Датчики:** SHT3x (temp+hum), CCS811 (CO2), Lux sensor
- **Функции:** Мониторинг климата
- **Режим:** NODE (layer 2)

### NODE pH (ESP32-C3):
- **Датчики:** Trema pH, DS18B20 (температурная компенсация)
- **Исполнители:** 2 перистальтических насоса (pH UP/DOWN)
- **Функции:** Автоматическая коррекция pH с **адаптивным PID**
- **Режим:** NODE с автономной работой

### NODE EC (ESP32-C3):
- **Датчики:** Trema EC, DS18B20
- **Исполнители:** 3 перистальтических насоса (EC A/B/C)
- **Функции:** Автоматическая коррекция EC с **адаптивным PID**
- **Режим:** NODE с автономной работой

### NODE Relay (ESP32):
- **Исполнители:** 2 актуатора форточек, вентилятор, LED свет
- **Функции:** Управление климатом
- **Режим:** NODE (только команды от ROOT)

### NODE Water (ESP32-C3):
- **Датчики:** HC-SR04 (уровень), Float switches
- **Исполнители:** Насос, дренажный клапан, заливной клапан
- **Функции:** Управление водоснабжением
- **Режим:** NODE (только команды от ROOT)

### NODE Display (ESP32-S3 #2):
- **Дисплей:** TFT 320x240 (ILI9341)
- **UI:** LVGL
- **Управление:** Ротационный энкодер
- **Функции:** Локальный мониторинг и управление
- **Режим:** NODE (запрос данных у ROOT)

---

## 🌐 ТЕХНОЛОГИИ

### Firmware (ESP32):
- **ESP-IDF v5.5**
- **ESP-WIFI-MESH** - самоорганизующаяся mesh-сеть
- **FreeRTOS** - многозадачность
- **cJSON** - JSON протокол обмена

### Backend:
- **Laravel 11** - PHP framework
- **MQTT (Mosquitto)** - message broker
- **SQLite** - database
- **Docker** - контейнеризация

### Frontend:
- **Vue.js 3** - reactive framework
- **Nginx** - web server
- **WebSocket** - real-time updates

---

## 📊 СТАТУС РЕАЛИЗАЦИИ

| Узел | Статус | Примечание |
|------|--------|------------|
| **ROOT NODE** | ✅ 100% | Полностью рабочий |
| **NODE Climate** | ✅ 100% | Полностью рабочий |
| **NODE pH** | ✅ 95% | Адаптивный PID реализован |
| **NODE EC** | ✅ 95% | Адаптивный PID реализован |
| **NODE Relay** | 🟡 30% | Базовая структура |
| **NODE Water** | 🟡 30% | Базовая структура |
| **NODE Display** | 🟡 40% | Базовая структура |
| **Backend** | ✅ 100% | API + MQTT Listener работают |
| **Frontend** | ✅ 90% | Dashboard работает |

---

## 🛠️ РАЗРАБОТКА

### Добавление нового узла:

1. Скопируй `node_template/` → `node_new/`
2. Измени конфигурацию в `main/app_main.c`
3. Реализуй компоненты в `components/`
4. Собери: `idf.py build`
5. Прошей: `idf.py -p COMx flash monitor`

### Изменение общей конфигурации:

1. Отредактируй `common/mesh_config/mesh_config.h`
2. Пересобери ВСЕ узлы: `tools\rebuild_all.bat`
3. Прошей все узлы (ROOT → NODE по порядку!)

---

## 📝 ЛИЦЕНЗИЯ

MIT License - см. LICENSE

---

## 👨‍💻 АВТОР

Hydro Mesh System v2.0

---

## 🔗 ССЫЛКИ

- **ESP-IDF:** https://docs.espressif.com/projects/esp-idf/
- **ESP-WIFI-MESH:** https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/esp-wifi-mesh.html
- **Laravel:** https://laravel.com/docs
- **Vue.js:** https://vuejs.org/guide/
- **LVGL:** https://lvgl.io/

---

**🚀 НАЧНИ С:** [START_HERE.md](START_HERE.md)
