# ğŸ¤– Ğ˜ĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¦Ğ˜Ğ¯ Ğ”Ğ›Ğ¯ Ğ˜Ğ˜: SERVER

**Ğ’ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Mesh Hydro System**

---

## ğŸ¯ ĞĞĞ—ĞĞĞ§Ğ•ĞĞ˜Ğ• Ğ¡Ğ•Ğ Ğ’Ğ•Ğ Ğ

**Server (Linux/Windows ĞŸĞš)** - Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²ÑĞµĞ¹ mesh-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹.

### ğŸŒ ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:

1. **MQTT Broker** - Mosquitto Ğ´Ğ»Ñ ÑĞ²ÑĞ·Ğ¸ Ñ ROOT ÑƒĞ·Ğ»Ğ¾Ğ¼
2. **Backend API** - Laravel 10 REST API
3. **Frontend Dashboard** - Vue.js 3 + Vuetify 3 Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
4. **Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** - PostgreSQL Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ²ÑĞµĞ¹ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
5. **MQTT Listener** - PHP Ğ´ĞµĞ¼Ğ¾Ğ½ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸
6. **Telegram Bot** - ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ñ‡ĞµÑ€ĞµĞ· Telegram
7. **SMS Gateway** - ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹ Ğ½Ğ° Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½

### âš ï¸ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ«Ğ• Ğ¢Ğ Ğ•Ğ‘ĞĞ’ĞĞĞ˜Ğ¯:

1. âœ… **24/7 Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°** - ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾
2. âœ… **PostgreSQL** - Ğ½Ğµ MySQL! ĞÑƒĞ¶Ğ½Ñ‹ JSONB Ğ¸ timestamp with timezone
3. âœ… **Real-time Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ** - WebSocket Ğ´Ğ»Ñ live Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
4. âœ… **Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸** - Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 1 Ğ³Ğ¾Ğ´ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸
5. âœ… **Backup** - ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ backup Ğ‘Ğ”

---

## ğŸ—ï¸ ĞĞ Ğ¥Ğ˜Ğ¢Ğ•ĞšĞ¢Ğ£Ğ Ğ

```
SERVER (Linux/Windows ĞŸĞš)
â”‚
â”œâ”€â”€ Mosquitto MQTT Broker (port 1883)
â”‚   â”œâ”€â”€ Topic: hydro/telemetry/#
â”‚   â”œâ”€â”€ Topic: hydro/event/#
â”‚   â”œâ”€â”€ Topic: hydro/heartbeat/#
â”‚   â”œâ”€â”€ Topic: hydro/command/#
â”‚   â””â”€â”€ Topic: hydro/config/#
â”‚
â”œâ”€â”€ Backend (Laravel 10)
â”‚   â”œâ”€â”€ REST API (port 8000)
â”‚   â”œâ”€â”€ Models (Node, Telemetry, Event, Command)
â”‚   â”œâ”€â”€ Controllers (NodeController, TelemetryController)
â”‚   â”œâ”€â”€ Services (MqttService, TelegramService, SmsService)
â”‚   â”œâ”€â”€ Commands (mqtt:listen, telegram:bot)
â”‚   â””â”€â”€ Broadcasting (WebSocket Ğ´Ğ»Ñ real-time)
â”‚
â”œâ”€â”€ Frontend (Vue.js 3)
â”‚   â”œâ”€â”€ Dashboard (port 3000 dev / 80 prod)
â”‚   â”œâ”€â”€ Material Design (Vuetify 3)
â”‚   â”œâ”€â”€ Real-time charts (Chart.js)
â”‚   â”œâ”€â”€ Node management
â”‚   â””â”€â”€ Settings
â”‚
â”œâ”€â”€ PostgreSQL 15
â”‚   â”œâ”€â”€ Table: nodes
â”‚   â”œâ”€â”€ Table: telemetry (Ğ¿Ğ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğµ)
â”‚   â”œâ”€â”€ Table: events
â”‚   â”œâ”€â”€ Table: commands
â”‚   â””â”€â”€ Table: ota_updates
â”‚
â”œâ”€â”€ Supervisor (ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°Ğ¼Ğ¸)
â”‚   â”œâ”€â”€ mqtt-listener (php artisan mqtt:listen)
â”‚   â”œâ”€â”€ telegram-bot (php artisan telegram:bot)
â”‚   â””â”€â”€ laravel-queue (php artisan queue:work)
â”‚
â””â”€â”€ Nginx (reverse proxy)
    â”œâ”€â”€ Frontend â†’ localhost:3000
    â”œâ”€â”€ API â†’ localhost:8000
    â””â”€â”€ WebSocket â†’ localhost:6001
```

---

## ğŸ“¦ Ğ¢Ğ•Ğ¥ĞĞĞ›ĞĞ“Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ Ğ¡Ğ¢Ğ•Ğš

### Backend:
- **PHP 8.2+** - ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ PHP Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹
- **Laravel 10** - Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº Ñ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ¹ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸ĞµĞ¹
- **PostgreSQL 15** - Ğ¼Ğ¾Ñ‰Ğ½Ğ°Ñ Ğ‘Ğ” Ñ JSONB
- **phpMQTT** - Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ´Ğ»Ñ MQTT
- **Supervisor** - ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ğ¾Ğ½Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°Ğ¼Ğ¸

### Frontend:
- **Vue.js 3** - Composition API
- **Vuetify 3** - Material Design ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
- **Chart.js** - Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸
- **Axios** - HTTP ĞºĞ»Ğ¸ĞµĞ½Ñ‚
- **Socket.io** - WebSocket Ğ´Ğ»Ñ real-time

### Infrastructure:
- **Mosquitto** - MQTT broker
- **Nginx** - reverse proxy
- **Redis** (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) - ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸
- **Certbot** (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) - SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ñ‹

---

## ğŸ“ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ ĞŸĞ ĞĞ•ĞšĞ¢Ğ

```
server/
â”œâ”€â”€ backend/                      # Laravel API
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ Console/
â”‚   â”‚   â”‚   â””â”€â”€ Commands/
â”‚   â”‚   â”‚       â”œâ”€â”€ MqttListenerCommand.php
â”‚   â”‚   â”‚       â””â”€â”€ TelegramBotCommand.php
â”‚   â”‚   â”œâ”€â”€ Http/
â”‚   â”‚   â”‚   â””â”€â”€ Controllers/
â”‚   â”‚   â”‚       â”œâ”€â”€ NodeController.php
â”‚   â”‚   â”‚       â”œâ”€â”€ TelemetryController.php
â”‚   â”‚   â”‚       â”œâ”€â”€ EventController.php
â”‚   â”‚   â”‚       â””â”€â”€ DashboardController.php
â”‚   â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”‚   â”œâ”€â”€ Node.php
â”‚   â”‚   â”‚   â”œâ”€â”€ Telemetry.php
â”‚   â”‚   â”‚   â”œâ”€â”€ Event.php
â”‚   â”‚   â”‚   â””â”€â”€ Command.php
â”‚   â”‚   â””â”€â”€ Services/
â”‚   â”‚       â”œâ”€â”€ MqttService.php
â”‚   â”‚       â”œâ”€â”€ TelegramService.php
â”‚   â”‚       â””â”€â”€ SmsService.php
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â””â”€â”€ seeders/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ api.php
â”‚   â”‚   â””â”€â”€ web.php
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ composer.json
â”‚   â””â”€â”€ artisan
â”‚
â”œâ”€â”€ frontend/                     # Vue.js Dashboard
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ NodeCard.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ TelemetryChart.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ EventLog.vue
â”‚   â”‚   â”‚   â””â”€â”€ ControlPanel.vue
â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ NodeDetail.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ History.vue
â”‚   â”‚   â”‚   â””â”€â”€ Settings.vue
â”‚   â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”œâ”€â”€ App.vue
â”‚   â”‚   â””â”€â”€ main.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”‚
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ hydro-system.conf         # Nginx ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚
â”œâ”€â”€ supervisor/
â”‚   â”œâ”€â”€ mqtt-listener.conf
â”‚   â”œâ”€â”€ telegram-bot.conf
â”‚   â””â”€â”€ laravel-queue.conf
â”‚
â””â”€â”€ README.md
```

---

## ğŸ’» Ğ Ğ•ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ BACKEND (Laravel)

### 1. Models

#### app/Models/Node.php

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Node extends Model
{
    protected $fillable = [
        'node_id',        // "ph_ec_001"
        'node_type',      // "ph_ec", "climate", "relay", "water"
        'zone',           // "Zone 1"
        'mac_address',    // "AA:BB:CC:DD:EE:FF"
        'online',         // true/false
        'last_seen_at',   // timestamp
        'config',         // jsonb - Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ÑƒĞ·Ğ»Ğ°
        'metadata',       // jsonb - Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
    ];

    protected $casts = [
        'online' => 'boolean',
        'last_seen_at' => 'datetime',
        'config' => 'array',
        'metadata' => 'array',
    ];

    // ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ
    public function telemetry()
    {
        return $this->hasMany(Telemetry::class, 'node_id', 'node_id');
    }

    public function events()
    {
        return $this->hasMany(Event::class, 'node_id', 'node_id');
    }

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ğ° (offline > 30 ÑĞµĞº)
    public function isOnline(): bool
    {
        if (!$this->last_seen_at) {
            return false;
        }
        
        $timeout = 30; // ÑĞµĞºÑƒĞ½Ğ´
        return $this->last_seen_at->diffInSeconds(now()) < $timeout;
    }
}
```

#### app/Models/Telemetry.php

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Telemetry extends Model
{
    protected $table = 'telemetry';
    
    protected $fillable = [
        'node_id',
        'node_type',
        'data',           // jsonb - Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸
        'received_at',    // timestamp
    ];

    protected $casts = [
        'data' => 'array',
        'received_at' => 'datetime',
    ];

    // Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
    // created_at - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€ÑƒĞµÑ‚ÑÑ
    // node_id + created_at - ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ

    public function node()
    {
        return $this->belongsTo(Node::class, 'node_id', 'node_id');
    }

    // ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ pH/EC:
    // {
    //   "ph": 6.5,
    //   "ec": 1.8,
    //   "temp": 24.3,
    //   "timestamp": 1697548805
    // }
}
```

#### app/Models/Event.php

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Event extends Model
{
    protected $fillable = [
        'node_id',
        'level',          // "info", "warning", "critical", "emergency"
        'message',        // "pH critically low"
        'data',           // jsonb - Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        'resolved_at',    // timestamp ĞºĞ¾Ğ³Ğ´Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¾
    ];

    protected $casts = [
        'data' => 'array',
        'resolved_at' => 'datetime',
    ];

    // ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ?
    public function isCritical(): bool
    {
        return in_array($this->level, ['critical', 'emergency']);
    }

    // ĞĞµ Ñ€ĞµÑˆĞµĞ½Ğ¾?
    public function isActive(): bool
    {
        return $this->resolved_at === null;
    }
}
```

### 2. Services

#### app/Services/MqttService.php

```php
<?php

namespace App\Services;

use PhpMqtt\Client\MqttClient;
use PhpMqtt\Client\ConnectionSettings;
use App\Models\Node;
use App\Models\Telemetry;
use App\Models\Event;
use Illuminate\Support\Facades\Log;

class MqttService
{
    private MqttClient $mqtt;
    
    public function __construct()
    {
        $host = config('mqtt.host', 'localhost');
        $port = config('mqtt.port', 1883);
        
        $this->mqtt = new MqttClient($host, $port, 'hydro-server-' . uniqid());
    }

    public function connect(): void
    {
        $settings = (new ConnectionSettings())
            ->setUsername(config('mqtt.username'))
            ->setPassword(config('mqtt.password'))
            ->setKeepAliveInterval(60)
            ->setLastWillTopic('hydro/server/status')
            ->setLastWillMessage('offline')
            ->setLastWillQualityOfService(1);

        $this->mqtt->connect($settings, true);
        Log::info('MQTT connected');
    }

    public function subscribe(string $topic, callable $callback): void
    {
        $this->mqtt->subscribe($topic, function ($topic, $message) use ($callback) {
            $callback($topic, $message);
        }, 0);
        
        Log::info("MQTT subscribed to: {$topic}");
    }

    public function publish(string $topic, string $message, int $qos = 0): void
    {
        $this->mqtt->publish($topic, $message, $qos);
        Log::debug("MQTT published: {$topic}");
    }

    public function loop(): void
    {
        $this->mqtt->loop(true);
    }

    public function disconnect(): void
    {
        $this->mqtt->disconnect();
    }

    // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸
    public function handleTelemetry(string $topic, string $payload): void
    {
        $data = json_decode($payload, true);
        
        if (!$data || !isset($data['node_id'])) {
            Log::warning("Invalid telemetry data: {$payload}");
            return;
        }

        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”
        Telemetry::create([
            'node_id' => $data['node_id'],
            'node_type' => $data['type'] ?? 'unknown',
            'data' => $data['data'] ?? [],
            'received_at' => now(),
        ]);

        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° ÑƒĞ·Ğ»Ğ°
        Node::updateOrCreate(
            ['node_id' => $data['node_id']],
            [
                'online' => true,
                'last_seen_at' => now(),
            ]
        );

        Log::debug("Telemetry saved: {$data['node_id']}");
    }

    // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
    public function handleEvent(string $topic, string $payload): void
    {
        $data = json_decode($payload, true);
        
        if (!$data || !isset($data['node_id'])) {
            return;
        }

        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
        $event = Event::create([
            'node_id' => $data['node_id'],
            'level' => $data['level'] ?? 'info',
            'message' => $data['message'] ?? '',
            'data' => $data['data'] ?? [],
        ]);

        // Ğ•ÑĞ»Ğ¸ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ - Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ
        if ($event->isCritical()) {
            app(TelegramService::class)->sendAlert($event);
            app(SmsService::class)->sendAlert($event);
        }

        Log::info("Event saved: {$event->message}");
    }

    // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ÑƒĞ·Ğ»Ñƒ
    public function sendCommand(string $nodeId, string $command, array $params = []): void
    {
        $payload = json_encode([
            'type' => 'command',
            'node_id' => $nodeId,
            'command' => $command,
            'params' => $params,
            'timestamp' => time(),
        ]);

        $this->publish("hydro/command/{$nodeId}", $payload, 1);
        
        Log::info("Command sent to {$nodeId}: {$command}");
    }

    // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑƒĞ·Ğ»Ñƒ
    public function sendConfig(string $nodeId, array $config): void
    {
        $payload = json_encode([
            'type' => 'config',
            'node_id' => $nodeId,
            'config' => $config,
            'timestamp' => time(),
        ]);

        $this->publish("hydro/config/{$nodeId}", $payload, 1);
        
        Log::info("Config sent to {$nodeId}");
    }
}
```

### 3. Console Commands

#### app/Console/Commands/MqttListenerCommand.php

```php
<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Services\MqttService;

class MqttListenerCommand extends Command
{
    protected $signature = 'mqtt:listen';
    protected $description = 'Listen for MQTT messages from ROOT node';

    public function handle(MqttService $mqtt)
    {
        $this->info('Starting MQTT Listener...');
        
        try {
            $mqtt->connect();
            
            // ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ñ
            $mqtt->subscribe('hydro/telemetry/#', function ($topic, $message) use ($mqtt) {
                $mqtt->handleTelemetry($topic, $message);
            });
            
            // ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
            $mqtt->subscribe('hydro/event/#', function ($topic, $message) use ($mqtt) {
                $mqtt->handleEvent($topic, $message);
            });
            
            // ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° heartbeat
            $mqtt->subscribe('hydro/heartbeat/#', function ($topic, $message) {
                // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ last_seen_at
                $data = json_decode($message, true);
                if ($data && isset($data['node_id'])) {
                    \App\Models\Node::where('node_id', $data['node_id'])
                        ->update(['last_seen_at' => now()]);
                }
            });
            
            $this->info('MQTT Listener running... Press Ctrl+C to stop');
            
            // Ğ‘ĞµÑĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ»
            $mqtt->loop();
            
        } catch (\Exception $e) {
            $this->error("MQTT Error: {$e->getMessage()}");
            return 1;
        }
    }
}
```

### 4. Controllers

#### app/Http/Controllers/NodeController.php

```php
<?php

namespace App\Http\Controllers;

use App\Models\Node;
use App\Services\MqttService;
use Illuminate\Http\Request;

class NodeController extends Controller
{
    // Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… ÑƒĞ·Ğ»Ğ¾Ğ²
    public function index()
    {
        $nodes = Node::with(['telemetry' => function ($query) {
            $query->latest()->limit(1);
        }])->get();

        return response()->json($nodes);
    }

    // Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ ÑƒĞ·Ğ»Ğ°
    public function show(string $nodeId)
    {
        $node = Node::with(['telemetry', 'events'])
            ->where('node_id', $nodeId)
            ->firstOrFail();

        return response()->json($node);
    }

    // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ÑƒĞ·Ğ»Ñƒ
    public function sendCommand(Request $request, string $nodeId, MqttService $mqtt)
    {
        $validated = $request->validate([
            'command' => 'required|string',
            'params' => 'array',
        ]);

        $node = Node::where('node_id', $nodeId)->firstOrFail();

        if (!$node->isOnline()) {
            return response()->json([
                'error' => 'Node is offline'
            ], 400);
        }

        $mqtt->sendCommand($nodeId, $validated['command'], $validated['params'] ?? []);

        return response()->json([
            'success' => true,
            'message' => 'Command sent to node'
        ]);
    }

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑƒĞ·Ğ»Ğ°
    public function updateConfig(Request $request, string $nodeId, MqttService $mqtt)
    {
        $node = Node::where('node_id', $nodeId)->firstOrFail();

        $config = $request->all();
        
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”
        $node->update(['config' => $config]);

        // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ½Ğ° ÑƒĞ·ĞµĞ» Ñ‡ĞµÑ€ĞµĞ· MQTT
        if ($node->isOnline()) {
            $mqtt->sendConfig($nodeId, $config);
        }

        return response()->json([
            'success' => true,
            'message' => 'Config updated'
        ]);
    }
}
```

---

## ğŸ’» Ğ Ğ•ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ FRONTEND (Vue.js)

### src/views/Dashboard.vue

```vue
<template>
  <v-container>
    <v-row>
      <v-col cols="12">
        <h1 class="text-h3">Hydro System Dashboard</h1>
      </v-col>
    </v-row>

    <v-row>
      <!-- ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ ÑƒĞ·Ğ»Ğ¾Ğ² -->
      <v-col
        v-for="node in nodes"
        :key="node.node_id"
        cols="12"
        md="6"
        lg="4"
      >
        <node-card :node="node" @command="sendCommand" />
      </v-col>
    </v-row>

    <!-- Ğ“Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸ -->
    <v-row>
      <v-col cols="12">
        <telemetry-chart :data="chartData" />
      </v-col>
    </v-row>

    <!-- Ğ›Ğ¾Ğ³ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ -->
    <v-row>
      <v-col cols="12">
        <event-log :events="events" />
      </v-col>
    </v-row>
  </v-container>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import { io } from 'socket.io-client'
import axios from 'axios'
import NodeCard from '@/components/NodeCard.vue'
import TelemetryChart from '@/components/TelemetryChart.vue'
import EventLog from '@/components/EventLog.vue'

const nodes = ref([])
const events = ref([])
const chartData = ref([])
const socket = ref(null)

// Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
const loadNodes = async () => {
  try {
    const response = await axios.get('/api/nodes')
    nodes.value = response.data
  } catch (error) {
    console.error('Error loading nodes:', error)
  }
}

const loadEvents = async () => {
  try {
    const response = await axios.get('/api/events?limit=50')
    events.value = response.data
  } catch (error) {
    console.error('Error loading events:', error)
  }
}

// WebSocket Ğ´Ğ»Ñ real-time Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹
const connectWebSocket = () => {
  socket.value = io('http://localhost:6001')

  socket.value.on('telemetry', (data) => {
    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒĞ·Ğ»Ğ° Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
    const node = nodes.value.find(n => n.node_id === data.node_id)
    if (node) {
      node.last_data = data.data
      node.last_seen_at = new Date()
    }

    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ğ³Ñ€Ğ°Ñ„Ğ¸Ğº
    chartData.value.push(data)
    if (chartData.value.length > 100) {
      chartData.value.shift()
    }
  })

  socket.value.on('event', (event) => {
    events.value.unshift(event)
    if (events.value.length > 50) {
      events.value.pop()
    }
  })
}

// ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ÑƒĞ·Ğ»Ñƒ
const sendCommand = async (nodeId, command, params) => {
  try {
    await axios.post(`/api/nodes/${nodeId}/command`, {
      command,
      params
    })

    // Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    console.log(`Command "${command}" sent to ${nodeId}`)
  } catch (error) {
    console.error('Error sending command:', error)
  }
}

onMounted(() => {
  loadNodes()
  loadEvents()
  connectWebSocket()

  // ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
  setInterval(loadNodes, 30000) // ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 30 ÑĞµĞº
})

onUnmounted(() => {
  if (socket.value) {
    socket.value.disconnect()
  }
})
</script>
```

### src/components/NodeCard.vue

```vue
<template>
  <v-card>
    <v-card-title>
      <v-icon :color="statusColor" class="mr-2">
        {{ statusIcon }}
      </v-icon>
      {{ node.node_id }}
    </v-card-title>

    <v-card-subtitle>
      {{ node.node_type }} â€¢ {{ node.zone }}
    </v-card-subtitle>

    <v-card-text>
      <!-- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸ -->
      <div v-if="node.node_type === 'ph_ec'">
        <div class="text-h4">pH: {{ lastData.ph?.toFixed(1) }}</div>
        <div class="text-h4">EC: {{ lastData.ec?.toFixed(1) }}</div>
      </div>

      <div v-else-if="node.node_type === 'climate'">
        <div>Temp: {{ lastData.temp?.toFixed(1) }}Â°C</div>
        <div>Humidity: {{ lastData.humidity?.toFixed(0) }}%</div>
        <div>CO2: {{ lastData.co2 }} ppm</div>
      </div>

      <div class="text-caption mt-2">
        Last seen: {{ formatTime(node.last_seen_at) }}
      </div>
    </v-card-text>

    <v-card-actions>
      <v-btn
        size="small"
        :to="`/nodes/${node.node_id}`"
      >
        Details
      </v-btn>

      <v-spacer />

      <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² ÑƒĞ·Ğ»Ğ¾Ğ² -->
      <v-btn
        v-if="node.node_type === 'relay'"
        size="small"
        color="primary"
        @click="$emit('command', node.node_id, 'open_windows', {})"
      >
        Open Windows
      </v-btn>
    </v-card-actions>
  </v-card>
</template>

<script setup>
import { computed } from 'vue'

const props = defineProps({
  node: {
    type: Object,
    required: true
  }
})

const statusColor = computed(() => {
  if (!props.node.last_seen_at) return 'grey'
  
  const seconds = (Date.now() - new Date(props.node.last_seen_at)) / 1000
  
  if (seconds < 30) return 'green'
  if (seconds < 60) return 'orange'
  return 'red'
})

const statusIcon = computed(() => {
  return statusColor.value === 'green' ? 'mdi-check-circle' : 'mdi-alert-circle'
})

const lastData = computed(() => {
  return props.node.last_data || {}
})

const formatTime = (timestamp) => {
  if (!timestamp) return 'Never'
  
  const date = new Date(timestamp)
  const now = new Date()
  const seconds = Math.floor((now - date) / 1000)
  
  if (seconds < 60) return `${seconds}s ago`
  if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`
  return date.toLocaleTimeString()
}
</script>
```

---

## ğŸ—„ï¸ DATABASE (PostgreSQL)

### Migrations

#### create_nodes_table.php

```php
Schema::create('nodes', function (Blueprint $table) {
    $table->id();
    $table->string('node_id')->unique();  // "ph_ec_001"
    $table->string('node_type');          // "ph_ec", "climate", etc
    $table->string('zone')->nullable();
    $table->string('mac_address')->nullable();
    $table->boolean('online')->default(false);
    $table->timestamp('last_seen_at')->nullable();
    $table->jsonb('config')->nullable();   // ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ÑƒĞ·Ğ»Ğ°
    $table->jsonb('metadata')->nullable(); // Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
    $table->timestamps();

    $table->index('node_id');
    $table->index('node_type');
    $table->index('online');
    $table->index('last_seen_at');
});
```

#### create_telemetry_table.php

```php
Schema::create('telemetry', function (Blueprint $table) {
    $table->id();
    $table->string('node_id');
    $table->string('node_type');
    $table->jsonb('data');            // Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸
    $table->timestamp('received_at'); // Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
    $table->timestamps();

    $table->index('node_id');
    $table->index(['node_id', 'received_at']); // Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ
    $table->index('received_at');
});

// ĞŸĞ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğµ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ¾Ğ±ÑŠĞµĞ¼Ğ¾Ğ²
// CREATE TABLE telemetry_2025_01 PARTITION OF telemetry
// FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');
```

#### create_events_table.php

```php
Schema::create('events', function (Blueprint $table) {
    $table->id();
    $table->string('node_id');
    $table->enum('level', ['info', 'warning', 'critical', 'emergency']);
    $table->text('message');
    $table->jsonb('data')->nullable();
    $table->timestamp('resolved_at')->nullable();
    $table->timestamps();

    $table->index('node_id');
    $table->index('level');
    $table->index('resolved_at');
    $table->index('created_at');
});
```

---

## âš™ï¸ ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ¯

### .env (Backend)

```env
APP_NAME="Hydro System"
APP_ENV=production
APP_DEBUG=false
APP_URL=http://localhost

# PostgreSQL
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=hydro_system
DB_USERNAME=hydro
DB_PASSWORD=secure_password

# MQTT
MQTT_HOST=127.0.0.1
MQTT_PORT=1883
MQTT_USERNAME=hydro_server
MQTT_PASSWORD=mqtt_secure_pass

# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id

# SMS Gateway (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
SMS_GATEWAY_URL=https://sms.ru/api/send
SMS_API_KEY=your_api_key
SMS_PHONE=+79991234567
```

### supervisor/mqtt-listener.conf

```ini
[program:hydro-mqtt-listener]
process_name=%(program_name)s
command=php /path/to/server/backend/artisan mqtt:listen
autostart=true
autorestart=true
startsecs=5
startretries=10
user=www-data
redirect_stderr=true
stdout_logfile=/var/log/supervisor/hydro-mqtt.log
stopwaitsecs=30
```

### nginx/hydro-system.conf

```nginx
server {
    listen 80;
    server_name hydro.local;

    # Frontend (Vue.js)
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Backend API (Laravel)
    location /api {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # WebSocket
    location /socket.io {
        proxy_pass http://localhost:6001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
    }
}
```

---

## ğŸš« Ğ§Ğ¢Ğ ĞĞ•Ğ›Ğ¬Ğ—Ğ¯ Ğ”Ğ•Ğ›ĞĞ¢Ğ¬

### 1. âŒ ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ MySQL

```php
// ĞŸĞ›ĞĞ¥Ğ âŒ
// MySQL Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ JSONB ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾
DB_CONNECTION=mysql

// Ğ¥ĞĞ ĞĞ¨Ğ âœ…
// PostgreSQL Ñ Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ JSONB
DB_CONNECTION=pgsql
```

### 2. âŒ ĞĞ• Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞ¹ HTTP Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹

```php
// ĞŸĞ›ĞĞ¥Ğ âŒ
public function sendCommand(Request $request) {
    $mqtt->sendCommand(...);
    sleep(5); // ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° âŒ
    return response()->json(['status' => 'done']);
}

// Ğ¥ĞĞ ĞĞ¨Ğ âœ…
public function sendCommand(Request $request) {
    $mqtt->sendCommand(...);
    // ĞÑ‚Ğ²ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ´ĞµÑ‚ Ñ‡ĞµÑ€ĞµĞ· WebSocket
    return response()->json(['status' => 'sent']);
}
```

### 3. âŒ ĞĞ• Ñ…Ñ€Ğ°Ğ½Ğ¸ Ğ²ÑĞµ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ

```sql
-- ĞŸĞ›ĞĞ¥Ğ âŒ
-- 1 Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ½Ğ° 10M+ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ = Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
CREATE TABLE all_data (...)

-- Ğ¥ĞĞ ĞĞ¨Ğ âœ…
-- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ + Ğ¿Ğ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
CREATE TABLE telemetry (...) PARTITION BY RANGE (received_at);
CREATE TABLE events (...);
CREATE TABLE commands (...);
```

---

## âœ… Ğ§Ğ¢Ğ ĞĞ£Ğ–ĞĞ Ğ”Ğ•Ğ›ĞĞ¢Ğ¬

### 1. âœ… ĞŸĞ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸

```sql
-- ĞŸĞ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¼ĞµÑÑÑ†Ğ°Ğ¼
CREATE TABLE telemetry_2025_01 PARTITION OF telemetry
FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');

CREATE TABLE telemetry_2025_02 PARTITION OF telemetry
FOR VALUES FROM ('2025-02-01') TO ('2025-03-01');

-- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¹ (cron)
```

### 2. âœ… Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

```sql
-- Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_telemetry_node_time 
ON telemetry (node_id, received_at DESC);

-- JSONB Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ (GIN)
CREATE INDEX idx_telemetry_data ON telemetry USING GIN (data);

-- ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ JSONB
SELECT * FROM telemetry 
WHERE data->>'ph' < '6.0';  -- Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾ Ñ GIN Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ¼!
```

### 3. âœ… ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```php
// Artisan ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ´Ğ»Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸
php artisan telemetry:cleanup --days=365

// Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸ ÑÑ‚Ğ°Ñ€ÑˆĞµ 1 Ğ³Ğ¾Ğ´Ğ°
Telemetry::where('received_at', '<', now()->subYear())->delete();
```

### 4. âœ… Backup Ğ‘Ğ”

```bash
#!/bin/bash
# backup.sh

DATE=$(date +%Y-%m-%d)
pg_dump -U hydro hydro_system > /backup/hydro_$DATE.sql
gzip /backup/hydro_$DATE.sql

# Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ² ÑÑ‚Ğ°Ñ€ÑˆĞµ 30 Ğ´Ğ½ĞµĞ¹
find /backup -name "hydro_*.sql.gz" -mtime +30 -delete
```

---

## ğŸ§ª Ğ¢Ğ•Ğ¡Ğ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ•

### Ğ¢ĞµÑÑ‚ 1: Backend ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

```bash
cd server/backend

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
composer install

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° .env
cp .env.example .env
# ĞÑ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ .env

# Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°
php artisan key:generate

# ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
php artisan migrate

# Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
php artisan db:seed

# Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞµÑ€Ğ²ĞµÑ€Ğ°
php artisan serve
```

**ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
```
Laravel development server started on http://127.0.0.1:8000
```

### Ğ¢ĞµÑÑ‚ 2: MQTT Listener

```bash
# Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ» 1: MQTT Listener
php artisan mqtt:listen

# Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ» 2: Ğ¢ĞµÑÑ‚ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
mosquitto_pub -h localhost -t "hydro/telemetry" \
  -m '{"node_id":"test_001","data":{"ph":6.5}}'
```

**Ğ’ Ğ‘Ğ” Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑŒÑÑ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ:**
```sql
SELECT * FROM telemetry ORDER BY created_at DESC LIMIT 1;
```

### Ğ¢ĞµÑÑ‚ 3: Frontend

```bash
cd server/frontend

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
npm install

# Ğ—Ğ°Ğ¿ÑƒÑĞº dev ÑĞµÑ€Ğ²ĞµÑ€Ğ°
npm run dev
```

**ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€:** http://localhost:3000

---

## ğŸ“Š Ğ§Ğ•ĞšĞ›Ğ˜Ğ¡Ğ¢ Ğ ĞĞ—Ğ ĞĞ‘ĞĞ¢ĞšĞ˜

### Backend:
- [ ] Laravel ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°
- [ ] PostgreSQL Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- [ ] ĞœĞ¾Ğ´ĞµĞ»Ğ¸ (Node, Telemetry, Event, Command)
- [ ] ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹
- [ ] MQTT Service
- [ ] MQTT Listener Command
- [ ] API Controllers (Node, Telemetry, Event)
- [ ] Telegram Service
- [ ] SMS Service (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
- [ ] Broadcasting (WebSocket)

### Frontend:
- [ ] Vue.js + Vuetify ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
- [ ] Axios HTTP ĞºĞ»Ğ¸ĞµĞ½Ñ‚
- [ ] Socket.io WebSocket
- [ ] Dashboard view
- [ ] NodeCard component
- [ ] TelemetryChart component (Chart.js)
- [ ] EventLog component
- [ ] NodeDetail view
- [ ] Settings view

### Infrastructure:
- [ ] Mosquitto MQTT Broker
- [ ] Supervisor ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
- [ ] Nginx reverse proxy
- [ ] SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ñ‹ (Certbot)
- [ ] Backup ÑĞºÑ€Ğ¸Ğ¿Ñ‚ (cron)
- [ ] ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ (Grafana Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

### Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
- [ ] MQTT Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ â†’ Ğ‘Ğ”
- [ ] REST API ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ñ‹
- [ ] WebSocket real-time
- [ ] Telegram ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ
- [ ] Frontend UI/UX
- [ ] Load testing (1000+ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹/Ğ¼Ğ¸Ğ½)

---

## ğŸ“š Ğ”ĞĞŸĞĞ›ĞĞ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞ«Ğ• Ğ Ğ•Ğ¡Ğ£Ğ Ğ¡Ğ«

### Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:
- [Laravel 10](https://laravel.com/docs/10.x)
- [Vue.js 3](https://vuejs.org/guide/introduction.html)
- [Vuetify 3](https://vuetifyjs.com/en/)
- [PostgreSQL](https://www.postgresql.org/docs/)
- [Mosquitto](https://mosquitto.org/documentation/)

### ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹:
- `php-mqtt/client` - MQTT ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ»Ñ PHP
- `predis/predis` - Redis Ğ´Ğ»Ñ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- `laravel/horizon` - Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ĞµĞ¹
- `spatie/laravel-backup` - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ backup

---

**Server - Ğ¼Ğ¾Ğ·Ğ³ Ğ²ÑĞµĞ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹! Ğ¥Ñ€Ğ°Ğ½Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ, Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹, ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞ¹!** ğŸ§ 

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** ğŸ”´ Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ (Ğ¤Ğ°Ğ·Ğ° 5)

**Ğ’Ñ€ĞµĞ¼Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:** 5-7 Ğ´Ğ½ĞµĞ¹

