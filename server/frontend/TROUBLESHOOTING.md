# üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫ Frontend

## –ü—Ä–æ–±–ª–µ–º–∞: "MQTT: offline" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** (F5 –∏–ª–∏ Ctrl+R)
2. –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–û–±–Ω–æ–≤–∏—Ç—å"** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Backend API:
```cmd
cd C:\esp\hydro\mesh\mesh_hydro\server\backend
test-api.bat
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```json
{
  "status": "running",
  "database": "ok",
  "mqtt": "connected",
  ...
}
```

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MQTT Listener:
- –û–∫–Ω–æ "MQTT Listener" –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
```
‚úÖ Connected successfully!
üéß MQTT Listener is running...
```

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MQTT Broker:
```cmd
netstat -an | findstr :1883
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```
TCP    0.0.0.0:1883           0.0.0.0:0              LISTENING
TCP    192.168.1.100:1883     192.168.1.191:xxxx     ESTABLISHED
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ MQTT:

1. **Frontend** –∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `/api/status`
2. **Backend** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   - –ï—Å—Ç—å –ª–∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –º–∏–Ω—É—Ç—ã?
   - –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç socket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å MQTT –±—Ä–æ–∫–µ—Ä–æ–º
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç** –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤–æ frontend:
   ```javascript
   this.mqttConnected = this.systemStatus.mqtt === 'connected'
   ```

### –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ Settings).

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å:
1. –û—Ç–∫—Ä–æ–π—Ç–µ **Settings** (‚öôÔ∏è)
2. –í–∫–ª–∞–¥–∫–∞ **"UI Preferences"**
3. –ò–∑–º–µ–Ω–∏—Ç–µ **"Refresh Interval"**

### –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"üîÑ –û–±–Ω–æ–≤–∏—Ç—å"** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É Dashboard.

–≠—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç:
```javascript
await appStore.fetchSystemStatus()
```

–ò –æ–±–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ç—É—Å MQTT.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
console.log('MQTT Status:', window.appStore.mqttConnected)

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
console.log('System Status:', window.appStore.systemStatus)

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
await window.appStore.fetchSystemStatus()
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ç—É—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–†–µ—à–µ–Ω–∏–µ 1:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- Settings ‚Üí UI Preferences
- "Enable Auto-refresh" –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–æ
- "Refresh Interval" > 0

**–†–µ—à–µ–Ω–∏–µ 2:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ frontend
```cmd
# Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ frontend
cd C:\esp\hydro\mesh\mesh_hydro\server\frontend
npm run dev
```

### –ü—Ä–æ–±–ª–µ–º–∞: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500 –∏–ª–∏ 404

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1:** Backend –∑–∞–ø—É—â–µ–Ω?
```cmd
curl http://localhost:8000/api/health
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```json
{"status":"ok","timestamp":"..."}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Laravel
```cmd
cd C:\esp\hydro\mesh\mesh_hydro\server\backend
type storage\logs\laravel.log
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 3:** –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à
```cmd
cd C:\esp\hydro\mesh\mesh_hydro\server\backend
C:\PHP\php.exe artisan cache:clear
C:\PHP\php.exe artisan config:clear
```

### –ü—Ä–æ–±–ª–µ–º–∞: CORS –æ—à–∏–±–∫–∏

–ï—Å–ª–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ CORS:

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `backend/config/cors.php`

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```php
'paths' => ['api/*', 'sanctum/csrf-cookie'],
'allowed_origins' => ['http://localhost:5173'],
```

### –û—Ç–ª–∞–¥–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

#### –í App.vue –¥–æ–±–∞–≤—å—Ç–µ:
```javascript
watch(() => appStore.mqttConnected, (newVal, oldVal) => {
  console.log('MQTT status changed:', oldVal, '‚Üí', newVal)
})
```

#### –í –±—Ä–∞—É–∑–µ—Ä–µ:
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
2. –í–∫–ª–∞–¥–∫–∞ Network
3. –§–∏–ª—å—Ç—Ä: `/api/status`
4. –°–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

| –°–∏–º–ø—Ç–æ–º | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|---------|---------|---------|
| "MQTT: offline" —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å | –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ |
| "MQTT: offline" –ø–æ—Å—Ç–æ—è–Ω–Ω–æ | MQTT Listener –Ω–µ –∑–∞–ø—É—â–µ–Ω | –ó–∞–ø—É—Å—Ç–∏—Ç–µ start-mqtt.bat |
| "–ù–µ—Ç —Å–≤—è–∑–∏" | Backend –Ω–µ –∑–∞–ø—É—â–µ–Ω | –ó–∞–ø—É—Å—Ç–∏—Ç–µ start-dev.bat |
| API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "disconnected" | Mosquitto –Ω–µ –∑–∞–ø—É—â–µ–Ω | net start mosquitto |
| API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "error" | –ü–æ—Ä—Ç 1883 –∑–∞–∫—Ä—ã—Ç | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall |

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏:

```cmd
# 1. MQTT Broker
netstat -an | findstr :1883

# 2. Backend Laravel
curl http://localhost:8000/api/health

# 3. MQTT Listener
# –°–º–æ—Ç—Ä–∏–º –æ–∫–Ω–æ "MQTT Listener"

# 4. API Status
curl http://localhost:8000/api/status

# 5. Frontend
# –û—Ç–∫—Ä—ã–≤–∞–µ–º http://localhost:5173 –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º
```

### –õ–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

#### Backend Laravel:
```cmd
cd backend
type storage\logs\laravel.log | findstr MQTT
```

#### MQTT Listener:
–°–º–æ—Ç—Ä–∏—Ç–µ –æ–∫–Ω–æ "MQTT Listener" - —Ç–∞–º –≤—ã–≤–æ–¥—è—Ç—Å—è –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

#### Frontend (Browser Console):
```javascript
// –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
localStorage.setItem('debug', 'true')
location.reload()
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–º–æ—â–∏:

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:
1. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥ test-api.bat
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –∏–∑ Laravel
4. –û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 18.10.2025

