# âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾: Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ

**Ğ”Ğ°Ñ‚Ğ°:** 2025-10-18  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹

---

## ğŸ¯ Ğ§Ğ¢Ğ Ğ˜Ğ—ĞœĞ•ĞĞ˜Ğ›ĞĞ¡Ğ¬

### âŒ Ğ‘Ğ«Ğ›Ğ (Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ):
```yaml
# docker-compose.yml
command: >
  sh -c "...
         php artisan migrate --force &&
         php artisan db:seed --force &&  â† Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ» Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
         php artisan serve ..."
```

**ĞŸÑ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ»Ğ¸ÑÑŒ:**
- 6 Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… ÑƒĞ·Ğ»Ğ¾Ğ² (ROOT, Climate, pH/EC, Relay, Display, Water)
- 576 Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸ (24 Ñ‡Ğ°ÑĞ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸)
- 5 Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹

### âœ… Ğ¡Ğ¢ĞĞ›Ğ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ):
```yaml
# docker-compose.yml
command: >
  sh -c "...
         php artisan migrate --force &&
         php artisan serve ..."
```

**Ğ¢ĞµĞ¿ĞµÑ€ÑŒ:**
- Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿ÑƒÑÑ‚Ğ°Ñ
- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… ESP32
- Ğ£Ğ·Ğ»Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸ (auto-discovery)

---

## ğŸ“Š ĞšĞĞš Ğ­Ğ¢Ğ Ğ ĞĞ‘ĞĞ¢ĞĞ•Ğ¢

### 1. ESP32 Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğº MQTT
```
ROOT Node â†’ WiFi â†’ MQTT (localhost:1883)
```

### 2. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ discovery ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
```json
{
  "type": "discovery",
  "node_id": "esp32_aabbccddee",
  "node_type": "climate",
  "mac_address": "AA:BB:CC:DD:EE:FF",
  "capabilities": ["temperature", "humidity", "co2"]
}
```

### 3. Backend Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ ÑƒĞ·ĞµĞ»
```
MQTT Listener â†’ Auto-Discovery â†’ Database
```

### 4. Ğ£Ğ·ĞµĞ» Ğ¿Ğ¾ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ½Ğ° Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğµ
```
Frontend â†’ API â†’ Database â†’ Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑƒĞ·ĞµĞ» âœ…
```

---

## ğŸ§ª ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ

### ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´:
```
http://localhost:3000
```

**Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Total Nodes: 0              â”‚
â”‚  ğŸŸ¢ Online: 0                   â”‚
â”‚  ğŸ”´ Offline: 0                  â”‚
â”‚  âš ï¸  Events: 0                  â”‚
â”‚                                 â”‚
â”‚  No nodes yet                   â”‚
â”‚  Connect ESP32 to start...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾:** âœ…
```json
{
  "nodes": {"total": 0, "online": 0, "offline": 0},
  "events": {"active": 0, "critical": 0},
  "telemetry": {"last_hour": 0}
}
```

---

## ğŸ”Œ ĞŸĞĞ”ĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ• ESP32

### 1. ĞŸÑ€Ğ¾ÑˆĞµĞ¹Ñ‚Ğµ ROOT Node:
```bash
cd root_node
idf.py build flash monitor
```

### 2. ROOT Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑÑ Ğº MQTT:
```
I mqtt_manager: MQTT connected to broker
I mqtt_manager: Published discovery message
```

### 3. Ğ£Ğ·ĞµĞ» Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ Ğ½Ğ° Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğµ:
```
Dashboard â†’ ROOT Node (online) âœ…
```

### 4. ĞŸÑ€Ğ¾ÑˆĞµĞ¹Ñ‚Ğµ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ÑƒĞ·Ğ»Ñ‹:
```bash
cd node_climate
idf.py build flash

cd node_ph_ec
idf.py build flash
```

### 5. ĞĞ½Ğ¸ Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:
```
Dashboard:
  âœ… ROOT Node
  âœ… NODE Climate
  âœ… NODE pH/EC
```

---

## ğŸ“ AUTO-DISCOVERY

### ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:

**1. ESP32 Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚:**
```
Topic: hydro/discovery
Payload: { node_id, type, mac, capabilities }
```

**2. Backend Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚:**
```
MQTT Listener â†’ Parse â†’ Check DB
```

**3. Ğ•ÑĞ»Ğ¸ ÑƒĞ·Ğ»Ğ° Ğ½ĞµÑ‚ - ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚:**
```sql
INSERT INTO nodes (
  node_id,
  name,
  type,
  mac_address,
  status
) VALUES (
  'esp32_aabbccddee',
  'NODE Climate',
  'climate',
  'AA:BB:CC:DD:EE:FF',
  'online'
);
```

**4. Frontend Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ:**
```
WebSocket/Polling â†’ New node â†’ Dashboard âœ…
```

---

## ğŸ¯ Ğ§Ğ¢Ğ Ğ”ĞĞ›Ğ¬Ğ¨Ğ•

### ĞŸĞ¾ÑĞ»Ğµ Ğ¿Ñ€Ğ¾ÑˆĞ¸Ğ²ĞºĞ¸ ESP32:

**1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ backend:**
```bash
docker compose logs -f backend
```

**Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ:**
```
[info] New node discovered: esp32_aabbccddee
[info] Node type: climate
[info] Created in database
```

**2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´:**
```
http://localhost:3000
```

**Ğ£Ğ·ĞµĞ» Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑŒÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸!**

**3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ñ:**
```bash
docker compose logs -f mqtt_listener
```

**Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ:**
```
ğŸ“¡ Received telemetry from: esp32_aabbccddee
ğŸ’¾ Saved to database
```

---

## ğŸ”§ Ğ•Ğ¡Ğ›Ğ˜ Ğ£Ğ—Ğ›Ğ« ĞĞ• ĞŸĞĞ¯Ğ’Ğ›Ğ¯Ğ®Ğ¢Ğ¡Ğ¯

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ MQTT Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ:

**1. ESP32 Ğ»Ğ¾Ğ³Ğ¸:**
```
I mqtt_manager: Connected to broker
I mqtt_manager: Published discovery
```

**2. MQTT Listener Ğ»Ğ¾Ğ³Ğ¸:**
```bash
docker compose logs mqtt_listener --tail=50
```

**Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ:**
```
ğŸ§ MQTT Listener is running...
ğŸ“¡ Subscribed to: hydro/discovery/#
```

**3. Ğ¢ĞµÑÑ‚ MQTT:**
```bash
# Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ Ğ² mosquitto ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€
docker compose exec mosquitto sh

# ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ Ğ½Ğ° Ñ‚Ğ¾Ğ¿Ğ¸ĞºĞ¸
mosquitto_sub -t "hydro/#" -v
```

**Ğ”Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑŒÑÑ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚ ESP32!**

---

## ğŸ“Š Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ£Ğ—Ğ›ĞĞœĞ˜

### Ğ’Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ·ĞµĞ»:

**Ğ§ĞµÑ€ĞµĞ· Frontend:**
```
Dashboard â†’ Add Node (+)
â†’ Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ñƒ
â†’ Save
```

**Ğ§ĞµÑ€ĞµĞ· API:**
```bash
curl -X POST http://localhost:3000/api/nodes \
  -H "Content-Type: application/json" \
  -d '{
    "node_id": "manual_node_001",
    "name": "Manual Node",
    "type": "climate",
    "mac_address": "00:00:00:00:00:00"
  }'
```

### Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑƒĞ·ĞµĞ»:

**Ğ§ĞµÑ€ĞµĞ· Frontend:**
```
Nodes â†’ Node Card â†’ Delete (ğŸ—‘ï¸)
```

**Ğ§ĞµÑ€ĞµĞ· API:**
```bash
curl -X DELETE http://localhost:3000/api/nodes/1
```

---

## âœ… ĞŸĞ Ğ•Ğ˜ĞœĞ£Ğ©Ğ•Ğ¡Ğ¢Ğ’Ğ

**1. Ğ§Ğ¸ÑÑ‚Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°:**
- ĞĞµÑ‚ Ğ¼ÑƒÑĞ¾Ñ€Ğ½Ñ‹Ñ… Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑƒĞ·Ğ»Ñ‹
- Ğ§ĞµÑÑ‚Ğ½Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°

**2. Auto-Discovery:**
- ESP32 Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ â†’ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾ÑĞ²Ğ»ÑĞµÑ‚ÑÑ
- ĞĞµ Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
- Plug & Play

**3. ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ:**
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ»Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ESP32 â†’ Ğ¿Ğ¾ÑĞ²Ğ¸Ğ»ÑÑ Ğ½Ğ° Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğµ
- Ğ£Ğ±Ñ€Ğ°Ğ»Ğ¸ ESP32 â†’ ÑÑ‚Ğ°Ñ‚ÑƒÑ offline
- ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

---

## ğŸ‰ Ğ˜Ğ¢ĞĞ“Ğ

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ĞĞĞ¡Ğ¢Ğ ĞĞ•ĞĞ: Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ Ğ•ĞĞ›Ğ¬ĞĞ«Ğ• Ğ”ĞĞĞĞ«Ğ• â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                    â•‘
â•‘  âœ… Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹        â•‘
â•‘  âœ… Seeding Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½               â•‘
â•‘  âœ… Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿ÑƒÑÑ‚Ğ°Ñ             â•‘
â•‘  âœ… Auto-discovery Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚        â•‘
â•‘                                    â•‘
â•‘  ĞŸÑ€Ğ¾ÑˆĞµĞ¹Ñ‚Ğµ ESP32 Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ           â•‘
â•‘  Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸!           â•‘
â•‘                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾:** 2025-10-18  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾

