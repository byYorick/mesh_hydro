# ‚úÖ –ü–ï–†–ï–°–ë–û–†–ö–ê –ò –ü–†–û–í–ï–†–ö–ê –£–°–ü–ï–®–ù–ê!

## üìä –í–´–ü–û–õ–ù–ï–ù–û

### 1. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** ‚úÖ
```bash
docker-compose down
```
–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ —É–¥–∞–ª–µ–Ω—ã.

### 2. **–ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ backend** ‚úÖ
```bash
docker-compose build --no-cache backend
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –û–±—Ä–∞–∑ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω —Å –Ω—É–ª—è (365KB –ª–æ–≥–æ–≤)
- ‚úÖ PHP —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (bcmath, opcache)
- ‚úÖ Composer –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã (92 –ø–∞–∫–µ—Ç–∞)
- ‚úÖ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ –æ–±—Ä–∞–∑
- ‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ~4 –º–∏–Ω—É—Ç—ã

### 3. **–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** ‚úÖ
```bash
docker-compose up -d
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í—Å–µ 7 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω—ã
- ‚úÖ Postgres healthy
- ‚úÖ Backend started
- ‚úÖ MQTT Listener connected
- ‚úÖ Scheduler running

### 4. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π** ‚úÖ
```bash
docker-compose exec backend php artisan migrate
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç - 4 –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã:**

| –ú–∏–≥—Ä–∞—Ü–∏—è | Batch | –°—Ç–∞—Ç—É—Å |
|----------|-------|--------|
| 2025_10_21_000001_create_pump_calibrations_table | [3] | ‚úÖ Ran |
| 2025_10_21_000002_create_config_history_table | [3] | ‚úÖ Ran |
| 2025_10_21_000003_create_schedules_table | [3] | ‚úÖ Ran |
| 2025_10_21_000004_create_settings_table | [3] | ‚úÖ Ran |

---

## üîç –ü–†–û–í–ï–†–ö–ê API

### ‚úÖ API –Ω–∞—Å—Ç—Ä–æ–µ–∫ Telegram
**URL:** `GET /api/settings/telegram`

**–°—Ç–∞—Ç—É—Å:** `200 OK`

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "telegram": {
    "enabled": false,
    "chat_id": "",
    "notify_critical": true,
    "notify_warnings": true,
    "notify_info": false,
    "bot_token_masked": "",
    "has_token": false
  }
}
```

‚úÖ **API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!**

---

### ‚úÖ API Docker —Å—Ç–∞—Ç—É—Å–∞
**URL:** `GET /api/docker/status`

**–°—Ç–∞—Ç—É—Å:** `200 OK`

‚úÖ **API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!**

---

## üì¶ –°–¢–ê–¢–£–° –ö–û–ù–¢–ï–ô–ù–ï–†–û–í

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | –°–µ—Ä–≤–∏—Å | –°—Ç–∞—Ç—É—Å | –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã | –ü–æ—Ä—Ç—ã |
|-----------|--------|--------|--------------|-------|
| hydro_backend | backend | ‚úÖ Up | ~5 min | 8000, 6001 |
| hydro_frontend | frontend | ‚úÖ Up | ~5 min | 3000 |
| hydro_mosquitto | mosquitto | ‚úÖ Up | ~5 min | 1883, 9001 |
| hydro_mqtt_listener | mqtt_listener | ‚úÖ Up | ~5 min | - |
| hydro_postgres | postgres | ‚úÖ Up (healthy) | ~5 min | 5432 |
| hydro_reverb | reverb | ‚úÖ Up | ~5 min | 8080 |
| hydro_scheduler | scheduler | ‚úÖ Up | ~5 min | - |

---

## üéØ –õ–û–ì–ò –°–ï–†–í–ò–°–û–í

### ‚úÖ Backend
```
INFO  Server running on [http://0.0.0.0:8000].
Press Ctrl+C to stop the server
```

### ‚úÖ MQTT Listener
```
‚úÖ Connected successfully!

üì° Subscribing to: hydro/telemetry/#
üì° Subscribing to: hydro/event/#
üì° Subscribing to: hydro/heartbeat/#
üì° Subscribing to: hydro/response/#
üì° Subscribing to: hydro/discovery
üì° Subscribing to: hydro/error/#

üéß MQTT Listener is running (AUTO-DISCOVERY enabled)...
```

### ‚úÖ Scheduler
```
2025-10-21 11:52:00 Running ['artisan' nodes:check-status --notify] 570.63ms DONE
2025-10-21 11:52:01 Running ['artisan' commands:process-timeouts] 303.98ms DONE
```

---

## üìã –ù–û–í–´–ï –§–ê–ô–õ–´ –í –ö–û–ù–¢–ï–ô–ù–ï–†–ï

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
```
‚úÖ 2025_10_21_000001_create_pump_calibrations_table.php
‚úÖ 2025_10_21_000002_create_config_history_table.php
‚úÖ 2025_10_21_000003_create_schedules_table.php
‚úÖ 2025_10_21_000004_create_settings_table.php
```

**Models:**
```
‚úÖ app/Models/PumpCalibration.php
‚úÖ app/Models/ConfigHistory.php
‚úÖ app/Models/Schedule.php
‚úÖ app/Models/Setting.php
```

**Controllers:**
```
‚úÖ app/Http/Controllers/SettingsController.php
‚úÖ app/Http/Controllers/DockerController.php
‚úÖ app/Http/Controllers/ScheduleController.php
```

**Services:**
```
‚úÖ app/Services/TelegramService.php (–æ–±–Ω–æ–≤–ª–µ–Ω)
‚úÖ app/Services/DockerService.php
```

**Routes:**
```
‚úÖ routes/api.php (–æ–±–Ω–æ–≤–ª–µ–Ω, +30 –º–∞—Ä—à—Ä—É—Ç–æ–≤)
```

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
1. ‚úÖ `GET /api/settings/telegram` - –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram
2. ‚úÖ `POST /api/settings/telegram` - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram
3. ‚úÖ `POST /api/settings/telegram/test` - –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
4. ‚úÖ `GET /api/settings/telegram/chat-id` - –ü–æ–ª—É—á–∏—Ç—å Chat ID
5. ‚úÖ `GET /api/docker/status` - –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
6. ‚úÖ `POST /api/docker/restart/all` - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö
7. ‚úÖ `POST /api/docker/restart/container` - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ
8. ‚úÖ `GET /api/docker/logs` - –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
9. ‚úÖ `GET /api/schedules/node/{nodeId}` - –†–∞—Å–ø–∏—Å–∞–Ω–∏—è
10. ‚úÖ `POST /api/schedules/node/{nodeId}` - –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

### –¢–∞–±–ª–∏—Ü—ã –ë–î:
1. ‚úÖ `settings` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
2. ‚úÖ `pump_calibrations` - –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –Ω–∞—Å–æ—Å–æ–≤
3. ‚úÖ `config_history` - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. ‚úÖ `schedules` - –†–∞—Å–ø–∏—Å–∞–Ω–∏—è

### –°–µ—Ä–≤–∏—Å—ã:
1. ‚úÖ Backend (Laravel)
2. ‚úÖ Frontend (Nginx)
3. ‚úÖ MQTT Broker (Mosquitto)
4. ‚úÖ MQTT Listener (PHP)
5. ‚úÖ Scheduler (PHP)
6. ‚úÖ Reverb (WebSocket)
7. ‚úÖ PostgreSQL (–ë–î)

---

## üéâ –ò–¢–û–ì

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:** ‚úÖ –ü–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã  
**–ú–∏–≥—Ä–∞—Ü–∏–∏:** ‚úÖ 4/4 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ  
**API:** ‚úÖ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Ç–≤–µ—á–∞—é—Ç  
**–°–µ—Ä–≤–∏—Å—ã:** ‚úÖ –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç  
**–õ–æ–≥–∏:** ‚úÖ –ë–µ–∑ –æ—à–∏–±–æ–∫  

---

## üöÄ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

**–î–æ—Å—Ç—É–ø:**
- Frontend: http://localhost:3000
- Backend API: http://localhost:8000/api
- MQTT: localhost:1883
- WebSocket: localhost:8080
- PostgreSQL: localhost:5432

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã:**
1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram —á–µ—Ä–µ–∑ –≤–µ–±
2. ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker —á–µ—Ä–µ–∑ –≤–µ–±
3. ‚úÖ Scheduler —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
4. ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
5. ‚úÖ –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –Ω–∞—Å–æ—Å–æ–≤

**–í—Å–µ –≥–æ—Ç–æ–≤–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!** üéâ

---

**–î–∞—Ç–∞:** 21 –æ–∫—Ç—è–±—Ä—è 2025  
**–í—Ä–µ–º—è:** 22:30  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–°–ï –†–ê–ë–û–¢–ê–ï–¢**

