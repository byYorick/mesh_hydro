# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ node_ph_ec –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –Ω–æ–¥—ã - –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞:** 21.10.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. NODE pH (ESP32-C3)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
node_ph/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ph_sensor/           # –î—Ä–∞–π–≤–µ—Ä Trema pH (I2C 0x4D)
‚îÇ   ‚îú‚îÄ‚îÄ pump_controller/     # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2 –Ω–∞—Å–æ—Å–∞–º–∏ (GPIO 2, 3)
‚îÇ   ‚îú‚îÄ‚îÄ pid_controller/      # PID –∞–ª–≥–æ—Ä–∏—Ç–º
‚îÇ   ‚îú‚îÄ‚îÄ ph_manager/          # –ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä pH
‚îÇ   ‚îú‚îÄ‚îÄ oled_display/        # OLED SSD1306
‚îÇ   ‚îú‚îÄ‚îÄ connection_monitor/  # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–≤—è–∑–∏
‚îÇ   ‚îú‚îÄ‚îÄ local_storage/       # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îÇ   ‚îî‚îÄ‚îÄ buzzer_led/          # –ò–Ω–¥–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îî‚îÄ‚îÄ app_main.c          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ CMakeLists.txt
‚îú‚îÄ‚îÄ sdkconfig.defaults
‚îú‚îÄ‚îÄ partitions.csv
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ AI_INSTRUCTIONS.md
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- 2 –Ω–∞—Å–æ—Å–∞: pH UP (GPIO 2), pH DOWN (GPIO 3)
- I2C: GPIO 8 (SDA), GPIO 9 (SCL)
- PID —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ pH (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π: Kp=1.0, Ki=0.05, Kd=0.3)
- –ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ offline
- Emergency stop –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö

### 2. NODE EC (ESP32-C3)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
node_ec/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ec_sensor/           # –î—Ä–∞–π–≤–µ—Ä Trema EC (I2C 0x64)
‚îÇ   ‚îú‚îÄ‚îÄ pump_controller/     # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3 –Ω–∞—Å–æ—Å–∞–º–∏ (GPIO 2, 3, 4)
‚îÇ   ‚îú‚îÄ‚îÄ pid_controller/      # PID –∞–ª–≥–æ—Ä–∏—Ç–º
‚îÇ   ‚îú‚îÄ‚îÄ ec_manager/          # –ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä EC
‚îÇ   ‚îú‚îÄ‚îÄ oled_display/        # OLED SSD1306
‚îÇ   ‚îú‚îÄ‚îÄ connection_monitor/  # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–≤—è–∑–∏
‚îÇ   ‚îú‚îÄ‚îÄ local_storage/       # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îÇ   ‚îî‚îÄ‚îÄ buzzer_led/          # –ò–Ω–¥–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îî‚îÄ‚îÄ app_main.c          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ CMakeLists.txt
‚îú‚îÄ‚îÄ sdkconfig.defaults
‚îú‚îÄ‚îÄ partitions.csv
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ AI_INSTRUCTIONS.md
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- 3 –Ω–∞—Å–æ—Å–∞: EC A (GPIO 2), EC B (GPIO 3), EC C (GPIO 4)
- I2C: GPIO 8 (SDA), GPIO 9 (SCL)
- PID —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ EC (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π: Kp=0.8, Ki=0.02, Kd=0.2)
- –ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ offline
- Emergency stop –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ node_config

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –≤ `common/node_config/node_config.h`:

```c
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pH —É–∑–ª–∞ (2 –Ω–∞—Å–æ—Å–∞)
typedef struct {
    base_config_t base;
    float ph_target;
    float ph_min, ph_max;
    pump_pid_t pump_pid[2];  // UP, DOWN
    uint32_t max_pump_time_ms;
    uint32_t cooldown_ms;
    float ph_cal_offset;
} ph_node_config_t;

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è EC —É–∑–ª–∞ (3 –Ω–∞—Å–æ—Å–∞)
typedef struct {
    base_config_t base;
    float ec_target;
    float ec_min, ec_max;
    pump_pid_t pump_pid[3];  // A, B, C
    uint32_t max_pump_time_ms;
    uint32_t cooldown_ms;
    float ec_cal_offset;
} ec_node_config_t;
```

---

## üìã –†–∞—Å–ø–∏–Ω–æ–≤–∫–∞

### NODE pH (ESP32-C3):
| GPIO | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ |
|------|------------|------------|
| 8 | I2C SDA | pH –¥–∞—Ç—á–∏–∫ + OLED |
| 9 | I2C SCL | pH –¥–∞—Ç—á–∏–∫ + OLED |
| 2 | Pump pH UP | PWM –Ω–∞—Å–æ—Å |
| 3 | Pump pH DOWN | PWM –Ω–∞—Å–æ—Å |
| 4 | LED Status | –ò–Ω–¥–∏–∫–∞—Ü–∏—è |
| 5 | Buzzer | –ó–≤—É–∫ |

**I2C —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
- pH Sensor (0x4D)
- OLED SSD1306 (0x3C)

### NODE EC (ESP32-C3):
| GPIO | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ |
|------|------------|------------|
| 8 | I2C SDA | EC –¥–∞—Ç—á–∏–∫ + OLED |
| 9 | I2C SCL | EC –¥–∞—Ç—á–∏–∫ + OLED |
| 2 | Pump EC A | PWM –Ω–∞—Å–æ—Å |
| 3 | Pump EC B | PWM –Ω–∞—Å–æ—Å |
| 4 | Pump EC C | PWM –Ω–∞—Å–æ—Å |
| 5 | LED Status | –ò–Ω–¥–∏–∫–∞—Ü–∏—è |
| 6 | Buzzer | –ó–≤—É–∫ |

**I2C —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
- EC Sensor (0x64)
- OLED SSD1306 (0x3C)

---

## üì° Mesh –ø—Ä–æ—Ç–æ–∫–æ–ª

### NODE pH Discovery:
```json
{
  "type": "discovery",
  "node_id": "ph_XXXXXX",
  "node_type": "ph",
  "actuators": ["pump_ph_up", "pump_ph_down"],
  "sensors": ["ph"]
}
```

### NODE EC Discovery:
```json
{
  "type": "discovery",
  "node_id": "ec_XXXXXX",
  "node_type": "ec",
  "actuators": ["pump_ec_a", "pump_ec_b", "pump_ec_c"],
  "sensors": ["ec"]
}
```

---

## üöÄ –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞

### NODE pH:
```bash
cd node_ph
idf.py set-target esp32c3
idf.py build
idf.py -p COMX flash monitor
```

### NODE EC:
```bash
cd node_ec
idf.py set-target esp32c3
idf.py build
idf.py -p COMX flash monitor
```

---

## ‚è≠Ô∏è –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

### 1. Backend –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (server/backend)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø—ã –Ω–æ–¥ "ph" –∏ "ec" –≤ models
- [ ] –û–±–Ω–æ–≤–∏—Ç—å MQTT listeners –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å endpoints –¥–ª—è pH –∏ EC –Ω–æ–¥

### 2. Frontend –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (server/frontend)
- [ ] –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è pH –∏ EC –Ω–æ–¥
- [ ] –û—Ç–¥–µ–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PID –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã –æ—Ç–¥–µ–ª—å–Ω–æ

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –°–±–æ—Ä–∫–∞ –æ–±–µ–∏—Ö –Ω–æ–¥
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ mesh
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ discovery
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ telemetry
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ PID —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ emergency stop

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

1. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: –ö–∞–∂–¥–∞—è –Ω–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ
2. **–£–ø—Ä–æ—â–µ–Ω–∏–µ**: –ú–µ–Ω—å—à–µ –∫–æ–¥–∞, –º–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: –ö–∞–∂–¥–∞—è –Ω–æ–¥–∞ –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∑–∞–¥–∞—á—É
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–¥ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞
5. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: –ü—Ä–æ–±–ª–µ–º—ã –æ–¥–Ω–æ–π –Ω–æ–¥—ã –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥—É—é

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –û–±–µ –Ω–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç ESP32-C3 (–≤–º–µ—Å—Ç–æ ESP32-S3)
- –ú–µ–Ω—å—à–µ GPIO, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞—Å–ø–∏–Ω–æ–≤–∫–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å PID —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∏ emergency protection
- Mock —Ä–µ–∂–∏–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ –¥–∞—Ç—á–∏–∫–æ–≤

---

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** ‚úÖ

