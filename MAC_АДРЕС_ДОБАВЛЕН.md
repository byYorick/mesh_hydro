# ‚úÖ MAC –ê–î–†–ï–° –î–û–ë–ê–í–õ–ï–ù –í –î–ï–¢–ê–õ–ò –£–ó–õ–ê

**–î–∞—Ç–∞:** 19 –æ–∫—Ç—è–±—Ä—è 2025  
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ MAC –∞–¥—Ä–µ—Å–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ—Ç–∞–ª–µ–π —É–∑–ª–∞

---

## üéØ –ß–¢–û –î–û–ë–ê–í–õ–ï–ù–û

### MAC –∞–¥—Ä–µ—Å –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —É–∑–ª–∞:
- üîå –ò–∫–æ–Ω–∫–∞ network-outline
- üìù –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: `00:4B:12:37:D5:A4`
- üé® –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–ø–æ—Å–ª–µ Hardware, –ø–µ—Ä–µ–¥ IP)

---

## üì± –ì–î–ï –û–¢–û–ë–†–ê–ñ–ê–ï–¢–°–Ø

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ç–∞–ª–µ–π —É–∑–ª–∞:

```
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞
‚îú‚îÄ üíæ –ü—Ä–æ—à–∏–≤–∫–∞: 1.0.0
‚îú‚îÄ üñ•Ô∏è –ê–ø–ø–∞—Ä–∞—Ç—É—Ä–∞: ESP32
‚îú‚îÄ üîå MAC –∞–¥—Ä–µ—Å: 00:4B:12:37:D5:A4  ‚Üê –ù–û–í–û–ï!
‚îú‚îÄ üåê IP –∞–¥—Ä–µ—Å: 192.168.1.191
‚îú‚îÄ üì° WiFi —Å–µ—Ç—å: Yorick
‚îî‚îÄ üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 19.10.2025
```

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### 1. ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç MAC –≤ Discovery:

#### climate_controller.c (—Å—Ç—Ä–æ–∫–∏ 266-290):

```c
// –ü–æ–ª—É—á–µ–Ω–∏–µ MAC –∞–¥—Ä–µ—Å–∞
uint8_t mac[6];
mesh_manager_get_mac(mac);

// –°–æ–∑–¥–∞–Ω–∏–µ discovery JSON
snprintf(discovery_msg, sizeof(discovery_msg),
        "{\"type\":\"discovery\","
        "\"node_id\":\"%s\","
        "\"node_type\":\"climate\","
        "\"mac_address\":\"%02X:%02X:%02X:%02X:%02X:%02X\","  ‚Üê –û—Ç–ø—Ä–∞–≤–∫–∞ MAC
        "\"firmware\":\"1.0.0\","
        "\"hardware\":\"ESP32\","
        "\"sensors\":[\"sht3x\",\"ccs811\",\"lux\"],"
        "\"heap_free\":%lu,"
        "\"wifi_rssi\":%d}",
        s_config->base.node_id,
        mac[0], mac[1], mac[2], mac[3], mac[4], mac[5],  ‚Üê –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        (unsigned long)heap_free,
        rssi);
```

**–§–æ—Ä–º–∞—Ç:** `"mac_address":"00:4B:12:37:D5:A4"`

---

### 2. Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç MAC:

#### MqttService.php - handleDiscovery:

**–î–ª—è –Ω–æ–≤—ã—Ö —É–∑–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 436):**
```php
$node = Node::create([
    'node_id' => $nodeId,
    'node_type' => $nodeType,
    'zone' => $data['zone'] ?? 'Auto-discovered',
    'online' => true,
    'last_seen_at' => now(),
    'mac_address' => $data['mac_address'] ?? $data['mac'] ?? null,  ‚Üê –í —Ç–∞–±–ª–∏—Ü—É nodes
    'metadata' => [
        // ...
        'mac_address' => $data['mac_address'] ?? $data['mac'] ?? null,  ‚Üê –í metadata —Ç–æ–∂–µ
        // ...
    ],
]);
```

**–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É–∑–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 408-428):**
```php
if (isset($data['mac_address']) || isset($data['mac'])) {
    $metadata = $existingNode->metadata ?? [];
    $metadata['mac_address'] = $data['mac_address'] ?? $data['mac'] ?? $metadata['mac_address'] ?? null;
    
    $updateData = [
        'metadata' => $metadata,
        'online' => true,
        'last_seen_at' => now(),
    ];
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–∫–∂–µ –ø–æ–ª–µ mac_address –≤ —Ç–∞–±–ª–∏—Ü–µ nodes
    if (isset($data['mac_address']) || isset($data['mac'])) {
        $updateData['mac_address'] = $data['mac_address'] ?? $data['mac'];
    }
    
    $existingNode->update($updateData);
}
```

---

### 3. Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç MAC:

#### NodeMetadataCard.vue (—Å—Ç—Ä–æ–∫–∏ 38-47):

```vue
<!-- MAC Address -->
<v-list-item v-if="node.mac_address || metadata.mac_address || metadata.mac">
  <template v-slot:prepend>
    <v-icon icon="mdi-network-outline" color="primary"></v-icon>
  </template>
  <v-list-item-title>MAC –∞–¥—Ä–µ—Å</v-list-item-title>
  <v-list-item-subtitle>
    {{ formatMac(node.mac_address || metadata.mac_address || metadata.mac) }}
  </v-list-item-subtitle>
</v-list-item>
```

#### –§—É–Ω–∫—Ü–∏—è formatMac() (—Å—Ç—Ä–æ–∫–∏ 288-307):

```javascript
function formatMac(mac) {
  if (!mac) return 'N/A'
  
  // –ï—Å–ª–∏ —É–∂–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å –¥–≤–æ–µ—Ç–æ—á–∏—è–º–∏ (00:4b:12:37:d5:a4)
  if (mac.includes(':')) {
    return mac.toUpperCase()  // ‚Üí 00:4B:12:37:D5:A4
  }
  
  // –ï—Å–ª–∏ –±–µ–∑ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π (004b1237d5a4)
  if (mac.length === 12) {
    return mac.match(/.{1,2}/g).join(':').toUpperCase()  // ‚Üí 00:4B:12:37:D5:A4
  }
  
  // –ï—Å–ª–∏ —Å –¥–µ—Ñ–∏—Å–∞–º–∏ (00-4b-12-37-d5-a4)
  if (mac.includes('-')) {
    return mac.replace(/-/g, ':').toUpperCase()  // ‚Üí 00:4B:12:37:D5:A4
  }
  
  return mac.toUpperCase()
}
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- `00:4B:12:37:D5:A4` (—Å –¥–≤–æ–µ—Ç–æ—á–∏—è–º–∏) ‚Üí `00:4B:12:37:D5:A4`
- `004b1237d5a4` (–±–µ–∑ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π) ‚Üí `00:4B:12:37:D5:A4`
- `00-4b-12-37-d5-a4` (—Å –¥–µ—Ñ–∏—Å–∞–º–∏) ‚Üí `00:4B:12:37:D5:A4`

**–í—Å–µ–≥–¥–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ!**

---

## üìä –ü–†–ò–ú–ï–† –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø

### –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ—Ç–∞–ª–µ–π climate_001:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üíæ –ü—Ä–æ—à–∏–≤–∫–∞                              ‚îÇ
‚îÇ    1.0.0                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üñ•Ô∏è –ê–ø–ø–∞—Ä–∞—Ç—É—Ä–∞                            ‚îÇ
‚îÇ    ESP32                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üîå MAC –∞–¥—Ä–µ—Å                             ‚îÇ ‚Üê –ù–û–í–û–ï!
‚îÇ    00:4B:12:37:D5:A4                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üåê IP –∞–¥—Ä–µ—Å                              ‚îÇ
‚îÇ    192.168.1.191                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üì° WiFi —Å–µ—Ç—å                             ‚îÇ
‚îÇ    Yorick                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                         ‚îÇ
‚îÇ    19 –æ–∫—Ç—è–±—Ä—è 2025, 15:03:46            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚ú® –°–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑                          ‚îÇ
‚îÇ    MQTT Heartbeat                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨

### 1. –î–æ–∂–¥–∏—Å—å —Å–±–æ—Ä–∫–∏:
Frontend –∏ backend –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—é—Ç—Å—è (2-3 –º–∏–Ω—É—Ç—ã).

### 2. –û—Ç–∫—Ä–æ–π Dashboard:
```
http://localhost:3000
```

### 3. –ü–µ—Ä–µ–π–¥–∏ –≤ –¥–µ—Ç–∞–ª–∏ —É–∑–ª–∞:
- –ù–∞–∂–º–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É —É–∑–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `climate_001`)
- –ò–ª–∏ –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É **"–î–µ—Ç–∞–ª–∏"** –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ

### 4. –ü—Ä–æ–∫—Ä—É—Ç–∏ –¥–æ –±–ª–æ–∫–∞ "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞":
–î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –ø—É–Ω–∫—Ç:
```
üîå MAC –∞–¥—Ä–µ—Å
   00:4B:12:37:D5:A4
```

### 5. –ï—Å–ª–∏ –Ω–µ –≤–∏–¥–Ω–æ:
- **Ctrl + Shift + R** (–∂—ë—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)
- –ü–æ–¥–æ–∂–¥–∏ 10-15 —Å–µ–∫—É–Ω–¥ (ESP32 –æ—Ç–ø—Ä–∞–≤–∏—Ç discovery)

---

## üîç –ü–†–û–í–ï–†–ö–ê –í –ë–î

### –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ MAC —Å–æ—Ö—Ä–∞–Ω—ë–Ω:

```bash
docker exec hydro_backend php artisan tinker --execute="echo json_encode(App\Models\Node::where('node_id', 'climate_001')->first()->only(['node_id', 'mac_address']), JSON_PRETTY_PRINT);"
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```json
{
    "node_id": "climate_001",
    "mac_address": "00:4B:12:37:D5:A4"  ‚Üê –î–û–õ–ñ–ù–û –ë–´–¢–¨!
}
```

### –ü—Ä–æ–≤–µ—Ä—å metadata:

```bash
docker exec hydro_backend php artisan tinker --execute="echo json_encode(App\Models\Node::where('node_id', 'climate_001')->first()->metadata, JSON_PRETTY_PRINT);"
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```json
{
    "discovered_at": "2025-10-19T12:03:46+00:00",
    "discovered_via": "heartbeat",
    "firmware": "1.0.0",
    "hardware": "ESP32",
    "mac_address": "00:4B:12:37:D5:A4",  ‚Üê –ò –ó–î–ï–°–¨ –¢–û–ñ–ï!
    "heap_free": 142684,
    "rssi_to_parent": -19,
    "uptime": 561
}
```

---

## üìã –ì–î–ï –•–†–ê–ù–ò–¢–°–Ø MAC

### 1. –í —Ç–∞–±–ª–∏—Ü–µ `nodes`:
```sql
SELECT node_id, mac_address FROM nodes WHERE node_id = 'climate_001';
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
node_id       | mac_address
--------------+------------------
climate_001   | 00:4B:12:37:D5:A4
```

### 2. –í metadata (JSON):
```
nodes.metadata['mac_address'] = "00:4B:12:37:D5:A4"
```

**–•—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞!**

---

## üéØ –ß–ê–°–¢–û–¢–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø MAC

### ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç MAC –≤:

#### Discovery (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏):
```
I (11420) climate_ctrl: üîç Discovery sent: climate_001 (RSSI=-45)
```

#### Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–∏:
- **Discovery message** (hydro/discovery)
- **–ü–µ—Ä–≤—ã–π heartbeat** (–µ—Å–ª–∏ —É–∑–µ–ª –Ω–æ–≤—ã–π)

**MAC –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è**, –ø–æ—ç—Ç–æ–º—É –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É–∑–ª–∞.

---

## üéâ –ì–û–¢–û–í–û!

### –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:

- ‚úÖ ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç MAC –∞–¥—Ä–µ—Å –≤ Discovery
- ‚úÖ Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç MAC –≤ `nodes.mac_address`
- ‚úÖ Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç MAC –≤ `nodes.metadata`
- ‚úÖ Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç MAC –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º Discovery
- ‚úÖ Frontend —á–∏—Ç–∞–µ—Ç MAC –∏–∑ `node.mac_address` –∏ `metadata.mac_address`
- ‚úÖ Frontend —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç MAC –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ —Å –¥–≤–æ–µ—Ç–æ—á–∏—è–º–∏
- ‚úÖ Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç MAC –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —É–∑–ª–∞

---

### –ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ (2-3 –º–∏–Ω—É—Ç—ã):

**–û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl + Shift + R) –∏ –æ—Ç–∫—Ä–æ–π –¥–µ—Ç–∞–ª–∏ —É–∑–ª–∞!**

**MAC –∞–¥—Ä–µ—Å –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö!** üîå‚úÖ

