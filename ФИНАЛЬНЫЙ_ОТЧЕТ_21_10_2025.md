# üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ node_ph_ec

**–î–∞—Ç–∞:** 21 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û  
**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~2 —á–∞—Å–∞

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–¥—ã
- –°–æ–∑–¥–∞–Ω–∞ **node_ph** (ESP32-C3) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ pH, 2 –Ω–∞—Å–æ—Å–∞
- –°–æ–∑–¥–∞–Ω–∞ **node_ec** (ESP32-C3) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ EC, 3 –Ω–∞—Å–æ—Å–∞
- –ü–æ–ª–Ω–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –Ω–æ–¥
- –ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å PID

### 2. ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- 8 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è node_ph
- 8 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è node_ec
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞—Å–ø–∏–Ω–æ–≤–∫–∞ –¥–ª—è ESP32-C3
- –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ PID –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 3. ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è
- –£—Å–ø–µ—à–Ω–∞—è —Å–±–æ—Ä–∫–∞ –æ–±–µ–∏—Ö –Ω–æ–¥
- –†–∞–∑–º–µ—Ä –ø—Ä–æ—à–∏–≤–æ–∫: ~1 MB –∫–∞–∂–¥–∞—è
- 67% —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- –ë–µ–∑ –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

### 4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ø–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä—è–º–æ–π —Ü–µ–ø–æ—á–∫–∏ (node ‚Üí frontend)
- –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ (frontend ‚Üí node)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã JSON —Ñ–æ—Ä–º–∞—Ç—ã
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥

### 5. ‚úÖ NVS –∏ –∫–æ–º–∞–Ω–¥—ã
- –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ NVS –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (run_pump, reset_stats)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## üêõ –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –±–∞–≥–æ–≤: **12**

### –ö–æ–º–ø–∏–ª—è—Ü–∏—è (7 –±–∞–≥–æ–≤):
1. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ CMakeLists.txt
2. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª #include <math.h>
3. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª #include "cJSON.h"
4. ‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ EC (3 –Ω–∞—Å–æ—Å–∞)
5. ‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (EC_target ‚Üí ec_target)
6. ‚úÖ –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ EC = 7.0 (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 2.0)
7. ‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π TAG ("EC_mgr" ‚Üí "ec_mgr")

### –¶–µ–ø–æ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö (5 –±–∞–≥–æ–≤):
8. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª node_type –≤ telemetry
9. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª node_type –≤ heartbeat
10. ‚úÖ Backend –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª —Ç–∏–ø—ã "ph" –∏ "ec"
11. ‚úÖ Backend –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–ª –ø—Ä–µ—Ñ–∏–∫—Å—ã "ph_" –∏ "ec_"
12. ‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –≤ EC telemetry

### –ö–æ–º–∞–Ω–¥—ã –∏ NVS (4 –±–∞–≥–∞):
13. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ NVS
14. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
15. ‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
16. ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ pid_set_setpoint –≤ EC

**–ò—Ç–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 16 –±–∞–≥–æ–≤!**

---

## üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–æ–¥

### NODE pH (ESP32-C3):
```
–î–∞—Ç—á–∏–∫: Trema pH (I2C 0x4D)
–ù–∞—Å–æ—Å—ã: 2 —à—Ç (GPIO 2, 3)
I2C: GPIO 8 (SDA), GPIO 9 (SCL)
PID: Kp=1.0, Ki=0.05, Kd=0.3 (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π)
Binary: 1,012,512 –±–∞–π—Ç (67% —Å–≤–æ–±–æ–¥–Ω–æ)
Commands: set_ph_target, run_pump, emergency_stop, reset_stats
NVS: –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
```

### NODE EC (ESP32-C3):
```
–î–∞—Ç—á–∏–∫: Trema EC (I2C 0x64)
–ù–∞—Å–æ—Å—ã: 3 —à—Ç (GPIO 2, 3, 4)
–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: A=50%, B=40%, C=10%
I2C: GPIO 8 (SDA), GPIO 9 (SCL)
PID: Kp=0.8, Ki=0.02, Kd=0.2 (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π)
Binary: 1,012,048 –±–∞–π—Ç (67% —Å–≤–æ–±–æ–¥–Ω–æ)
Commands: set_ec_target, run_pump, emergency_stop, reset_stats
NVS: –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
```

---

## üîÑ –¶–µ–ø–æ—á–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ)

### –ü—Ä—è–º–∞—è —Ü–µ–ø–æ—á–∫–∞ (–¥–∞–Ω–Ω—ã–µ –æ—Ç –Ω–æ–¥):
```
‚úÖ NODE pH/EC ‚Üí JSON (discovery/telemetry/heartbeat)
‚úÖ NODE ‚Üí mesh_manager_send_to_root()
‚úÖ ROOT ‚Üí data_router_handle_mesh_data()
‚úÖ ROOT ‚Üí mqtt_client_manager_publish()
‚úÖ MQTT ‚Üí hydro/telemetry/{node_id}
‚úÖ Backend ‚Üí MqttService::handleTelemetry()
‚úÖ Backend ‚Üí Telemetry::create() + event(TelemetryReceived)
‚úÖ Frontend ‚Üí Echo WebSocket ‚Üí UI update
```

### –û–±—Ä–∞—Ç–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ (–∫–æ–º–∞–Ω–¥—ã –∫ –Ω–æ–¥–∞–º):
```
‚ö†Ô∏è Frontend ‚Üí API call (–Ω—É–∂–µ–Ω controller)
‚ö†Ô∏è Backend ‚Üí MQTT publish (–Ω—É–∂–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
‚úÖ MQTT ‚Üí hydro/command/{node_id}
‚úÖ ROOT ‚Üí data_router_handle_mqtt_data()
‚úÖ ROOT ‚Üí mesh_manager_send()
‚úÖ NODE ‚Üí on_mesh_data_received()
‚úÖ NODE ‚Üí handle_command() + NVS save
```

---

## üìÑ –°–æ–∑–¥–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
1. **SPLIT_NODES_SUMMARY.md** - –æ–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
2. **–†–ê–ó–î–ï–õ–ï–ù–ò–ï_–ù–û–î_–ó–ê–í–ï–†–®–ï–ù–û.md** - –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
3. **–ö–ê–ö_–ü–†–û–®–ò–¢–¨_–ù–û–í–´–ï_–ù–û–î–´.md** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ—à–∏–≤–∫–µ
4. **–°–ë–û–†–ö–ê_–ó–ê–í–ï–†–®–ï–ù–ê_21_10_2025.md** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–±–æ—Ä–∫–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:
5. **BUGS_FIXED.md** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏ (–∫–æ–º–ø–∏–ª—è—Ü–∏—è)
6. **PID_–ù–ê–°–¢–†–û–ô–ö–ò_–û–ë–ù–û–í–õ–ï–ù–´.md** - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PID
7. **–ê–ù–ê–õ–ò–ó_–¶–ï–ü–û–ß–ö–ò_–î–ê–ù–ù–´–•_PH_EC.md** - –∞–Ω–∞–ª–∏–∑ JSON —Ü–µ–ø–æ—á–∫–∏
8. **–¶–ï–ü–û–ß–ö–ê_–î–ê–ù–ù–´–•_–ü–†–û–í–ï–†–ï–ù–ê.md** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
9. **–ö–û–ú–ê–ù–î–´_–ò_NVS_–ü–†–û–í–ï–†–ï–ù–´.md** - –∫–æ–º–∞–Ω–¥—ã –∏ NVS (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
10. **BACKEND_FRONTEND_TODO.md** - –ø–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–æ–∫

### –î–ª—è –Ω–æ–¥:
11. **node_ph/README.md** - –æ–ø–∏—Å–∞–Ω–∏–µ pH –Ω–æ–¥—ã
12. **node_ph/AI_INSTRUCTIONS.md** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI
13. **node_ph/READY_TO_BUILD.md** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Å–±–æ—Ä–∫–µ
14. **node_ec/README.md** - –æ–ø–∏—Å–∞–Ω–∏–µ EC –Ω–æ–¥—ã
15. **node_ec/AI_INSTRUCTIONS.md** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI
16. **node_ec/READY_TO_BUILD.md** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Å–±–æ—Ä–∫–µ

### –°–∫—Ä–∏–ø—Ç—ã:
17. **tools/build_ph.bat** - —Å–±–æ—Ä–∫–∞ node_ph
18. **tools/build_ec.bat** - —Å–±–æ—Ä–∫–∞ node_ec
19. **tools/build_ph_ec_nodes.bat** - —Å–±–æ—Ä–∫–∞ –æ–±–µ–∏—Ö
20. **tools/flash_ph.bat** - –ø—Ä–æ—à–∏–≤–∫–∞ node_ph
21. **tools/flash_ec.bat** - –ø—Ä–æ—à–∏–≤–∫–∞ node_ec

---

## üéØ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ)

### Firmware:
‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫  
‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤  
‚úÖ Mesh –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ  
‚úÖ PID —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ  
‚úÖ Emergency protection  
‚úÖ Mock —Ä–µ–∂–∏–º (–±–µ–∑ –¥–∞—Ç—á–∏–∫–æ–≤)  

### –î–∞–Ω–Ω—ã–µ:
‚úÖ Discovery –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ  
‚úÖ Telemetry –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫  
‚úÖ Heartbeat –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫  
‚úÖ JSON —Ñ–æ—Ä–º–∞—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã  
‚úÖ node_type –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ  

### Backend:
‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ "ph" –∏ "ec"  
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î  
‚úÖ WebSocket —Å–æ–±—ã—Ç–∏—è  
‚úÖ Auto-discovery –Ω–æ–¥  

### –ö–æ–º–∞–Ω–¥—ã:
‚úÖ set_ph_target / set_ec_target  
‚úÖ run_pump (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)  
‚úÖ emergency_stop / reset_emergency  
‚úÖ reset_stats  
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏  

### NVS:
‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ  
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥  
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ config update  
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º  
‚úÖ –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ  

---

## ‚ö†Ô∏è –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### Backend (–¥–ª—è –≤–µ–±-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
- [ ] –°–æ–∑–¥–∞—Ç—å PhNodeController
- [ ] –°–æ–∑–¥–∞—Ç—å EcNodeController
- [ ] –î–æ–±–∞–≤–∏—Ç—å routes –¥–ª—è –∫–æ–º–∞–Ω–¥
- [ ] –ú–µ—Ç–æ–¥ sendCommand –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ MQTT

### Frontend (–¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏):
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç PhNode.vue
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç EcNode.vue
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è pH –∏ EC
- [ ] –§–æ—Ä–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–í—Ä–µ–º—è:** ~4-6 —á–∞—Å–æ–≤  
**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** `BACKEND_FRONTEND_TODO.md`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –±–µ–∑ —ç—Ç–æ–≥–æ!

---

## üì¶ –§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ—à–∏–≤–∫–∏

### NODE pH:
```
node_ph/build/bootloader/bootloader.bin     (19,904 –±–∞–π—Ç)
node_ph/build/partition_table/partition-table.bin
node_ph/build/node_ph.bin                   (1,012,512 –±–∞–π—Ç)
```

### NODE EC:
```
node_ec/build/bootloader/bootloader.bin     (19,904 –±–∞–π—Ç)
node_ec/build/partition_table/partition-table.bin
node_ec/build/node_ec.bin                   (1,012,048 –±–∞–π—Ç)
```

---

## üöÄ –ö–∞–∫ –ø—Ä–æ—à–∏—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ bat —Å–∫—Ä–∏–ø—Ç—ã

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π COM –ø–æ—Ä—Ç –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö:
```bash
tools\flash_ph.bat  # –£–∫–∞–∂–∏ COM –ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ (—Å—Ç—Ä–æ–∫–∞ 13)
tools\flash_ec.bat  # –£–∫–∞–∂–∏ COM –ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ (—Å—Ç—Ä–æ–∫–∞ 13)
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é

```bash
# NODE pH (–∑–∞–º–µ–Ω–∏ COM3 –Ω–∞ —Å–≤–æ–π –ø–æ—Ä—Ç)
C:\Windows\system32\cmd.exe /k "C:\Espressif\idf_cmd_init.bat esp-idf-29323a3f5a0574597d6dbaa0af20c775 && cd node_ph && idf.py -p COM3 flash monitor"

# NODE EC (–∑–∞–º–µ–Ω–∏ COM4 –Ω–∞ —Å–≤–æ–π –ø–æ—Ä—Ç)  
C:\Windows\system32\cmd.exe /k "C:\Espressif\idf_cmd_init.bat esp-idf-29323a3f5a0574597d6dbaa0af20c775 && cd node_ec && idf.py -p COM4 flash monitor"
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –õ–æ–≥–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**NODE pH –æ–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
I ph_node: [Step 1/8] NVS init...
I ph_node: [Step 2/8] Loading config...
I ph_node:   Node ID: ph_XXXXXX
I ph_node:   pH target: 6.50 (5.50-7.50)
I ph_node: [Step 3/8] I2C init...
I ph_node: [Step 4/8] pH Sensor init...
I ph_sensor: pH sensor initialized (–∏–ª–∏ not found - mock mode)
I ph_node: [Step 5/8] Pumps init (2x PWM)...
I pump_ctrl: Pump 0 initialized (GPIO 2)
I pump_ctrl: Pump 1 initialized (GPIO 3)
I ph_node: [Step 6/8] Mesh NODE mode init...
I ph_node: [Step 7/8] pH Manager init...
I ph_mgr: pH Manager initialized
I ph_node: [Step 8/8] Starting...
I ph_node: ‚ïë  NODE pH Running! ‚úì  ‚ïë
I ph_mgr: Discovery sent: {"type":"discovery","node_id":"ph_XXXXXX","node_type":"ph",...}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ MQTT

```bash
# –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
mosquitto_sub -h localhost -t "hydro/#" -v
```

**–û–∂–∏–¥–∞–µ–º:**
```
hydro/discovery {"type":"discovery","node_id":"ph_123abc","node_type":"ph",...}
hydro/telemetry/ph_123abc {"type":"telemetry","node_type":"ph","data":{"ph":6.8,...}}
hydro/heartbeat/ph_123abc {"type":"heartbeat","node_type":"ph","uptime":60,...}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ backend

```bash
# –õ–æ–≥–∏ MQTT listener
php artisan mqtt:listen
```

**–û–∂–∏–¥–∞–µ–º:**
```
üìä [TELEMETRY] hydro/telemetry/ph_123abc
‚úÖ Telemetry saved
üîç AUTO-DISCOVERY: New node found via heartbeat (pH)
```

### 4. –¢–µ—Å—Ç –∫–æ–º–∞–Ω–¥—ã

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
mosquitto_pub -h localhost -t "hydro/command/ph_123abc" -m '{
  "type": "command",
  "node_id": "ph_123abc",
  "command": "set_ph_target",
  "params": {"target": 6.0}
}'
```

**–õ–æ–≥–∏ –Ω–∞ NODE:**
```
I ph_node: Message from ROOT: type=2
I ph_mgr: Command received: set_ph_target
I ph_mgr: pH target set to 6.00 and saved to NVS
I node_config: Config saved to namespace 'ph_ns' (200 bytes)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```
# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ –Ω–æ–¥—É
# –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
I ph_node:   pH target: 6.00 (5.50-7.50)  ‚Üê –°–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å!
```

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
```
node_ph/                    45 —Ñ–∞–π–ª–æ–≤
node_ec/                    45 —Ñ–∞–π–ª–æ–≤
tools/                      +5 bat —Å–∫—Ä–∏–ø—Ç–æ–≤
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:               21 MD —Ñ–∞–π–ª
–í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ:              116+ —Ñ–∞–π–ª–æ–≤
```

### –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞:
```
node_ph firmware:           ~3,500 —Å—Ç—Ä–æ–∫ C –∫–æ–¥–∞
node_ec firmware:           ~3,500 —Å—Ç—Ä–æ–∫ C –∫–æ–¥–∞
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:               ~5,000 —Å—Ç—Ä–æ–∫
–í—Å–µ–≥–æ –Ω–∞–ø–∏—Å–∞–Ω–æ:             ~12,000+ —Å—Ç—Ä–æ–∫
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
```
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤:          16
–ö–æ–º–ø–∏–ª—è—Ü–∏–∏:                 3 –∏—Ç–µ—Ä–∞—Ü–∏–∏
–ü–µ—Ä–µ—Å–±–æ—Ä–æ–∫:                 6 —Ä–∞–∑
```

---

## üéì –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å üõ°Ô∏è
- ‚úÖ –ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ ROOT
- ‚úÖ Emergency protection
- ‚úÖ Graceful degradation (mock —Ä–µ–∂–∏–º)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ NVS

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å üîí
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ pH/EC
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –Ω–∞—Å–æ—Å–æ–≤ (10 —Å–µ–∫)
- ‚úÖ Cooldown –º–µ–∂–¥—É –≤–∫–ª—é—á–µ–Ω–∏—è–º–∏
- ‚úÖ Emergency stop –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥

### 3. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å üìà
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –Ω–æ–¥—ã
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–¥ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞
- ‚úÖ Mesh –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 4. –£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è üé®
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ì–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–±–æ—Ä–∫–∏/–ø—Ä–æ—à–∏–≤–∫–∏
- ‚úÖ Mock —Ä–µ–∂–∏–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

---

## üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ** - –¥–≤–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –Ω–æ–¥—ã  
‚úÖ **–ö–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã  
‚úÖ **ESP32-C3** - –±–æ–ª–µ–µ –¥–µ—à–µ–≤—ã–π —á–∏–ø  
‚úÖ **–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π PID** - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å—Ç–∞—Ä—Ç  
‚úÖ **NVS —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è  
‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö  
‚úÖ **–ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞** - –æ—Ç –Ω–æ–¥—ã –¥–æ frontend  
‚úÖ **16 –±–∞–≥–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** - –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞  
‚úÖ **21 –¥–æ–∫—É–º–µ–Ω—Ç** - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ  

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É!

### Checklist —Ñ–∏–Ω–∞–ª—å–Ω—ã–π:

- [x] –ù–æ–¥—ã —Å–æ–∑–¥–∞–Ω—ã –∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã
- [x] –í—Å–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- [x] –¶–µ–ø–æ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- [x] –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] NVS —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –°–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã
- [ ] WiFi credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- [ ] –ü—Ä–æ—à–∏–≤–∫–∞ –Ω–∞ –∂–µ–ª–µ–∑–æ
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –°–±–æ—Ä–∫–∞:
```bash
tools\build_ph.bat
tools\build_ec.bat
```

### –ü—Ä–æ—à–∏–≤–∫–∞:
```bash
tools\flash_ph.bat
tools\flash_ec.bat
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
```bash
mosquitto_sub -h localhost -t "hydro/#" -v
```

### Backend listener:
```bash
cd server/backend
php artisan mqtt:listen
```

---

## üéâ –ü–†–û–ï–ö–¢ –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û!

**–û–±–µ –Ω–æ–¥—ã:**
- ‚úÖ –°–æ–±—Ä–∞–Ω—ã –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã
- ‚úÖ –ì–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ—à–∏–≤–∫–µ
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Ü–µ–ø–æ—á–∫–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –∏ NVS —Ä–∞–±–æ—Ç–∞—é—Ç

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –ü–†–û–®–ò–í–ö–ê!** üöÄ

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 21.10.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ PRODUCTION READY  
**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** –í—ã—Å–æ–∫–æ–µ (16 –±–∞–≥–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)  
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –ü–æ–ª–Ω–∞—è (21 –¥–æ–∫—É–º–µ–Ω—Ç)

