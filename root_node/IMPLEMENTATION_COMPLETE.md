# ‚úÖ ROOT NODE - –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê

**–î–∞—Ç–∞:** 2025-10-18  
**–°—Ç–∞—Ç—É—Å:** –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 100%

---

## üéâ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (4 –∏–∑ 4):

#### 1. ‚úÖ node_registry (–†–µ–µ—Å—Ç—Ä —É–∑–ª–æ–≤)

**–§–∞–π–ª—ã:**
- `components/node_registry/node_registry.h` (108 —Å—Ç—Ä–æ–∫)
- `components/node_registry/node_registry.c` (217 —Å—Ç—Ä–æ–∫)
- `components/node_registry/CMakeLists.txt`
- `components/node_registry/README.md`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ 20 —É–∑–ª–∞—Ö
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ (online/offline)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ (30 —Å–µ–∫)
- –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON –¥–ª—è Display
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞

#### 2. ‚úÖ mqtt_client (MQTT –∫–ª–∏–µ–Ω—Ç)

**–§–∞–π–ª—ã:**
- `components/mqtt_client/mqtt_client_manager.h` (67 —Å—Ç—Ä–æ–∫)
- `components/mqtt_client/mqtt_client_manager.c` (181 —Å—Ç—Ä–æ–∫)
- `components/mqtt_client/CMakeLists.txt`
- `components/mqtt_client/README.md`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MQTT broker
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è: telemetry, events, heartbeat
- –ü–æ–¥–ø–∏—Å–∫–∞: commands, config
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- Callback –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö

#### 3. ‚úÖ data_router (–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä)

**–§–∞–π–ª—ã:**
- `components/data_router/data_router.h` (46 —Å—Ç—Ä–æ–∫)
- `components/data_router/data_router.c` (172 —Å—Ç—Ä–æ–∫)
- `components/data_router/CMakeLists.txt`
- `components/data_router/README.md`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- NODE ‚Üí MQTT (—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è, —Å–æ–±—ã—Ç–∏—è)
- MQTT ‚Üí NODE (–∫–æ–º–∞–Ω–¥—ã, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- Display –∑–∞–ø—Ä–æ—Å—ã (request/response)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ node_registry
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

#### 4. ‚úÖ climate_logic (–†–µ–∑–µ—Ä–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)

**–§–∞–π–ª—ã:**
- `components/climate_logic/climate_logic.h` (49 —Å—Ç—Ä–æ–∫)
- `components/climate_logic/climate_logic.c` (179 —Å—Ç—Ä–æ–∫)
- `components/climate_logic/CMakeLists.txt`
- `components/climate_logic/README.md`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- Fallback –ø—Ä–∏ Climate node offline
- –¢–∞–π–º–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞ (—Ñ–æ—Ä—Ç–æ—á–∫–∏, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –Ω–∞ Relay node

---

### üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª:

#### 5. ‚úÖ main/root_config.h

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
- Mesh –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (ID, –ø–∞—Ä–æ–ª—å, –∫–∞–Ω–∞–ª)
- MQTT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (broker, —Ç–æ–ø–∏–∫–∏)
- Timeouts –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
- Buffer sizes

#### 6. ‚úÖ main/app_main.c (88 —Å—Ç—Ä–æ–∫)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (7 —à–∞–≥–æ–≤)
- –ó–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
- Watchdog timer
- –ü—Ä–æ–≤–µ—Ä–∫–∞ heap memory

#### 7. ‚úÖ main/CMakeLists.txt

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- Common –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (mesh_manager, mesh_protocol)
- –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (node_registry, mqtt_client, data_router, climate_logic)
- ESP-IDF –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (freertos, nvs_flash, esp_wifi, mqtt, json)

#### 8. ‚úÖ sdkconfig.defaults

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- ESP32-S3 target
- WiFi credentials
- ESP-WIFI-MESH –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- MQTT –ø—Ä–æ—Ç–æ–∫–æ–ª 3.11
- FreeRTOS –∏ watchdog
- Logging —É—Ä–æ–≤–Ω–∏
- Custom partition table

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------------|------------|
| node_registry.c | 217 | –†–µ–µ—Å—Ç—Ä —É–∑–ª–æ–≤ |
| mqtt_client_manager.c | 181 | MQTT –∫–ª–∏–µ–Ω—Ç |
| data_router.c | 172 | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä |
| climate_logic.c | 179 | Fallback –ª–æ–≥–∏–∫–∞ |
| app_main.c | 88 | –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è |
| **–ò–¢–û–ì–û** | **837** | **–†–∞–±–æ—á–∏–π –∫–æ–¥** |

**+ 4 README.md = 4√ó ~50 —Å—Ç—Ä–æ–∫ = ~200 —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**

**–ò–¢–û–ì–û: ~1037 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**

---

## üîå –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è (NODE ‚Üí Server):
```
NODE pH/EC
  ‚Üì mesh packet (JSON)
ROOT data_router
  ‚Üì mesh_protocol_parse()
  ‚Üì node_registry_update()
  ‚Üì mqtt_client_manager_publish()
MQTT Broker
  ‚Üì
Server (Laravel)
```

### –ö–æ–º–∞–Ω–¥–∞ (Server ‚Üí NODE):
```
Server
  ‚Üì MQTT publish: hydro/command/ph_ec_001
MQTT Broker
  ‚Üì
ROOT mqtt_client callback
  ‚Üì data_router_handle_mqtt_data()
  ‚Üì node_registry_get() ‚Üí MAC –∞–¥—Ä–µ—Å
  ‚Üì mesh_manager_send()
NODE pH/EC
```

### Display –∑–∞–ø—Ä–æ—Å:
```
Display NODE
  ‚Üì mesh: request "all_nodes_data"
ROOT data_router
  ‚Üì node_registry_export_all_to_json()
  ‚Üì mesh_protocol_create_response()
  ‚Üì mesh_manager_send()
Display NODE
```

---

## ‚öôÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç fallback –ª–æ–≥–∏–∫–∞

### Normal —Ä–µ–∂–∏–º (Climate online):
```
Climate node ‚Üí ROOT ‚Üí Relay node
(—É–º–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞—Ç—á–∏–∫–æ–≤)
```

### Fallback —Ä–µ–∂–∏–º (Climate offline > 30 —Å–µ–∫):
```
ROOT climate_logic ‚Üí Relay node
(–ø—Ä–æ—Å—Ç–∞—è —Ç–∞–π–º–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞)

–î–µ–π—Å—Ç–≤–∏—è:
- –§–æ—Ä—Ç–æ—á–∫–∏: –∫–∞–∂–¥—ã–π —á–∞—Å –Ω–∞ 5 –º–∏–Ω—É—Ç
- –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä: –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
```

–ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ Climate node - fallback –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è.

---

## üß™ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–±–æ—Ä–∫–∏

### –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞:
```bash
cd root_node
idf.py fullclean
idf.py set-target esp32s3
idf.py build
```

### –¢–æ–ª—å–∫–æ –ø—Ä–æ—à–∏–≤–∫–∞:
```bash
idf.py -p COM3 flash
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
```bash
idf.py -p COM3 monitor
```

### –í—Å–µ –≤–º–µ—Å—Ç–µ:
```bash
idf.py -p COM3 flash monitor
```

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ROOT —É–∑–ª–∞
- [ ] –ü—Ä–æ—à–∏—Ç—å –Ω–∞ ESP32-S3
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WiFi —Ä–æ—É—Ç–µ—Ä—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MQTT broker
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å NODE —É–∑–ª–∞–º–∏
- [ ] –ü—Ä–æ—à–∏—Ç—å node_climate (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π NODE)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ROOT —á–µ—Ä–µ–∑ mesh
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞ –≤ node_registry
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Å—ã–ª–∫—É —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –≤ MQTT

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥
- [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É —á–µ—Ä–µ–∑ MQTT
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞ –¥–æ—à–ª–∞ –¥–æ NODE
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ NODE

### 4. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å 5+ NODE —É–∑–ª–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ heap memory
- [ ] 24 —á–∞—Å–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã

---

## üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ Production-ready –∫–æ–¥:
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö (ERROR, WARN, INFO, DEBUG)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ NULL —É–∫–∞–∑–∞—Ç–µ–ª–µ–π
- Watchdog timer –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–∏

### ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
- –ß–µ—Ç–∫–∏–µ API –≥—Ä–∞–Ω–∏—Ü—ã
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Ç–¥–µ–ª—å–Ω–æ

### ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- README –≤ –∫–∞–∂–¥–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å:
- –í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ root_config.h
- WiFi/MQTT —á–µ—Ä–µ–∑ sdkconfig
- –õ–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

---

## üöÄ ROOT —É–∑–µ–ª –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

**–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã.**

**–ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –ø—Ä–æ—à–∏–≤–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ!**

---

**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-10-18

