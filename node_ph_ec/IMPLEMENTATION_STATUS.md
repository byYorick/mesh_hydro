# NODE pH/EC - –°–¢–ê–¢–£–° –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

**–î–∞—Ç–∞:** 2025-10-18  
**–°—Ç–∞—Ç—É—Å:** –ë–ê–ó–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ì–û–¢–û–í–ê  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 70% (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞) + 30% (TODO –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## ‚úÖ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (70%)

### üì¶ –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (5/5):

#### 1. ‚úÖ node_controller (–ì–ª–∞–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- `node_controller.h` (61 —Å—Ç—Ä–æ–∫–∞)
- `node_controller.c` (192 —Å—Ç—Ä–æ–∫–∏)
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª (10 —Å–µ–∫)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º
- Emergency –æ–±—Ä–∞–±–æ—Ç–∫–∞

#### 2. ‚úÖ connection_monitor (–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–≤—è–∑–∏)
- `connection_monitor.h` (85 —Å—Ç—Ä–æ–∫)
- `connection_monitor.c` (175 —Å—Ç—Ä–æ–∫)
- 4 —Å–æ—Å—Ç–æ—è–Ω–∏—è: ONLINE ‚Üí DEGRADED ‚Üí AUTONOMOUS ‚Üí EMERGENCY
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
- Callback –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### 3. ‚úÖ local_storage (Ring buffer)
- `local_storage.h` (93 —Å—Ç—Ä–æ–∫–∏)
- `local_storage.c` (149 —Å—Ç—Ä–æ–∫)
- Ring buffer –Ω–∞ 1000 –∑–∞–ø–∏—Å–µ–π
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å ROOT
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É—Ñ–µ—Ä–∞

#### 4. ‚úÖ oled_display (SSD1306)
- `oled_display.h` (61 —Å—Ç—Ä–æ–∫–∞)
- `oled_display.c` (94 —Å—Ç—Ä–æ–∫–∏)
- I2C –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
- Emergency –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- **TODO:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥—Ä–∞–π–≤–µ—Ä SSD1306

#### 5. ‚úÖ buzzer_led (–ò–Ω–¥–∏–∫–∞—Ü–∏—è)
- `buzzer_led.h` (82 —Å—Ç—Ä–æ–∫–∏)
- `buzzer_led.c` (180 —Å—Ç—Ä–æ–∫)
- LED —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏
- Buzzer —Å–∏–≥–Ω–∞–ª—ã
- Button –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–∫–æ—Ä–æ—Ç–∫–æ–µ/–¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ)

---

### üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª:

#### 6. ‚úÖ main/app_main.c (130 —Å—Ç—Ä–æ–∫)
- 11-—à–∞–≥–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- Mesh callback
- Button callback
- –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞

#### 7. ‚úÖ main/CMakeLists.txt
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (common + –ª–æ–∫–∞–ª—å–Ω—ã–µ)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ REQUIRES

#### 8. ‚úÖ CMakeLists.txt
- EXTRA_COMPONENT_DIRS –Ω–∞ ../common

#### 9. ‚úÖ sdkconfig.defaults
- ESP32-S3 target
- Watchdog, FreeRTOS
- I2C –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- OTA –ø–∞—Ä—Ç–∏—Ü–∏–∏

#### 10. ‚úÖ partitions.csv
- OTA_0, OTA_1 –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

## üîÑ –ß–¢–û –ù–£–ñ–ù–û –ü–û–†–¢–ò–†–û–í–ê–¢–¨ (30%)

### –ò–∑ hydro1.0/components/:

#### 1. üîÑ sensor_manager (–ó–ê–ì–õ–£–®–ö–ê –°–û–ó–î–ê–ù–ê)
**TODO:** –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
- Trema pH –¥–∞—Ç—á–∏–∫ (I2C 0x0A)
- Trema EC –¥–∞—Ç—á–∏–∫ (I2C 0x08)
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –¥–∞—Ç—á–∏–∫
- Retry –ª–æ–≥–∏–∫–∞ (3 –ø–æ–ø—ã—Ç–∫–∏)
- –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ (–∑–∞–≥—Ä—É–∑–∫–∞/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ NVS)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ó–∞–≥–ª—É—à–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (pH=6.5, EC=1.8)

#### 2. üîÑ pump_manager (–ó–ê–ì–õ–£–®–ö–ê –°–û–ó–î–ê–ù–ê)
**TODO:** –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
- GPIO —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 5 –Ω–∞—Å–æ—Å–∞–º–∏
- Safety: max_pump_time_ms, cooldown_ms
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ (max_daily_volume_ml)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–º–ª –∑–∞ —á–∞—Å/–¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é)
- Emergency stop (–≤—Å–µ –Ω–∞—Å–æ—Å—ã OFF)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ NVS

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ó–∞–≥–ª—É—à–∫–∞ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ—Ç, –Ω–∞—Å–æ—Å—ã –Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è

#### 3. üîÑ adaptive_pid (–ó–ê–ì–õ–£–®–ö–ê –°–û–ó–î–ê–ù–ê)
**TODO:** –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
- PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è pH (UP/DOWN)
- PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è EC (A/B/C)
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Kp, Ki, Kd
- Anti-windup –∑–∞—â–∏—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å pump_manager
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ NVS

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ó–∞–≥–ª—É—à–∫–∞ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ—Ç, PID –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ | –°—Ç–∞—Ç—É—Å |
|-----------|-------------|--------|
| node_controller.c | 192 | ‚úÖ –ì–û–¢–û–í |
| connection_monitor.c | 175 | ‚úÖ –ì–û–¢–û–í |
| local_storage.c | 149 | ‚úÖ –ì–û–¢–û–í |
| buzzer_led.c | 180 | ‚úÖ –ì–û–¢–û–í |
| oled_display.c | 94 | ‚úÖ –ì–û–¢–û–í (–Ω—É–∂–µ–Ω –¥—Ä–∞–π–≤–µ—Ä) |
| sensor_manager.c | 57 | üîÑ –ó–ê–ì–õ–£–®–ö–ê |
| pump_manager.c | 43 | üîÑ –ó–ê–ì–õ–£–®–ö–ê |
| adaptive_pid.c | 46 | üîÑ –ó–ê–ì–õ–£–®–ö–ê |
| app_main.c | 130 | ‚úÖ –ì–û–¢–û–í |
| **–ò–¢–û–ì–û** | **1066** | **70% –≥–æ—Ç–æ–≤–æ** |

---

## üöÄ –ì–û–¢–û–í–û –ö –ö–û–ú–ü–ò–õ–Ø–¶–ò–ò

–ü—Ä–æ–µ–∫—Ç **–º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∏ –ø—Ä–æ—à–∏—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å**:

```bash
cd node_ph_ec
idf.py build
```

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ Mesh NODE —Ä–µ–∂–∏–º
- ‚úÖ Connection monitor (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π)
- ‚úÖ Local storage (–±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è)
- ‚úÖ LED –∏–Ω–¥–∏–∫–∞—Ü–∏—è
- ‚úÖ Button –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ Watchdog timer

**–ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (–∑–∞–≥–ª—É—à–∫–∏):**
- ‚ùå –ß—Ç–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤ (pH, EC)
- ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–∞–º–∏
- ‚ùå PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

---

## üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:

1. **–ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å sensor_manager –∏–∑ hydro1.0**
   - –ù–∞–π—Ç–∏ `hydro1.0/components/sensor_manager/`
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã
   - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è mesh (–≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ MQTT)

2. **–ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å pump_manager –∏–∑ hydro1.0**
   - –ù–∞–π—Ç–∏ `hydro1.0/components/pump_manager/`
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å node_controller

3. **–ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å adaptive_pid –∏–∑ hydro1.0**
   - –ù–∞–π—Ç–∏ `hydro1.0/components/adaptive_pid/`
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å sensor_manager –∏ pump_manager

4. **–î–æ–±–∞–≤–∏—Ç—å SSD1306 –¥—Ä–∞–π–≤–µ—Ä**
   - –ú–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ ESP-IDF Component Registry
   - –ò–ª–∏ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ hydro1.0

### –ü–æ—Å–ª–µ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞—Ç—á–∏–∫–∞–º–∏
6. –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ pH –∏ EC
7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PID –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (24 —á–∞—Å–∞)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ NODE pH/EC

```
node_ph_ec/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ node_controller/       ‚úÖ –ì–û–¢–û–í
‚îÇ   ‚îú‚îÄ‚îÄ connection_monitor/    ‚úÖ –ì–û–¢–û–í
‚îÇ   ‚îú‚îÄ‚îÄ local_storage/         ‚úÖ –ì–û–¢–û–í
‚îÇ   ‚îú‚îÄ‚îÄ oled_display/          ‚úÖ –ì–û–¢–û–í (–Ω—É–∂–µ–Ω –¥—Ä–∞–π–≤–µ—Ä)
‚îÇ   ‚îú‚îÄ‚îÄ buzzer_led/            ‚úÖ –ì–û–¢–û–í
‚îÇ   ‚îú‚îÄ‚îÄ sensor_manager/        üîÑ –ó–ê–ì–õ–£–®–ö–ê
‚îÇ   ‚îú‚îÄ‚îÄ pump_manager/          üîÑ –ó–ê–ì–õ–£–®–ö–ê
‚îÇ   ‚îî‚îÄ‚îÄ adaptive_pid/          üîÑ –ó–ê–ì–õ–£–®–ö–ê
‚îÇ
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îú‚îÄ‚îÄ app_main.c             ‚úÖ –ì–û–¢–û–í
‚îÇ   ‚îî‚îÄ‚îÄ CMakeLists.txt         ‚úÖ –ì–û–¢–û–í
‚îÇ
‚îú‚îÄ‚îÄ CMakeLists.txt             ‚úÖ –ì–û–¢–û–í
‚îú‚îÄ‚îÄ sdkconfig.defaults         ‚úÖ –ì–û–¢–û–í
‚îú‚îÄ‚îÄ partitions.csv             ‚úÖ –ì–û–¢–û–í
‚îú‚îÄ‚îÄ AI_INSTRUCTIONS.md         ‚úÖ –ì–û–¢–û–í (490 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ README.md                  ‚úÖ –ì–û–¢–û–í
```

---

## üéâ –ò–¢–û–ì–û

**NODE pH/EC –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞!**

- ‚úÖ 5 –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
- ‚úÖ 3 –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ app_main.c
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–±–æ—Ä–∫–∞ –≥–æ—Ç–æ–≤—ã
- ‚úÖ –ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ Watchdog –∏ safety —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

**–ü—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –∏ –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!**

**–î–ª—è production:** –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–∑ hydro1.0.

---

**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-10-18

