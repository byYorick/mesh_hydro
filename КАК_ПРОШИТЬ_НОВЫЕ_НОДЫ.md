# üöÄ –ö–∞–∫ –ø—Ä–æ—à–∏—Ç—å –Ω–æ–≤—ã–µ –Ω–æ–¥—ã pH –∏ EC

**–û–±–µ –Ω–æ–¥—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ—à–∏–≤–∫–µ!**

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥ –ø—Ä–æ—à–∏–≤–∫–æ–π

### 1. –ù–∞—Å—Ç—Ä–æ–π WiFi credentials

**node_ph/sdkconfig.defaults:**
```
CONFIG_ESP_WIFI_SSID="YourWiFiName"
CONFIG_ESP_WIFI_PASSWORD="YourWiFiPassword"
```

**node_ec/sdkconfig.defaults:**
```
CONFIG_ESP_WIFI_SSID="YourWiFiName"
CONFIG_ESP_WIFI_PASSWORD="YourWiFiPassword"
```

‚ö†Ô∏è **WiFi credentials –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å ROOT node!**

### 2. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è WiFi - –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏:

```bash
# node_ph
cd node_ph
idf.py build

# node_ec
cd node_ec
idf.py build
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
```bash
tools\build_ph.bat
tools\build_ec.bat
```

---

## üìã –®–∞–≥ –∑–∞ —à–∞–≥–æ–º

### NODE pH

#### 1. –û–ø—Ä–µ–¥–µ–ª–∏ COM –ø–æ—Ä—Ç
–ü–æ–¥–∫–ª—é—á–∏ ESP32-C3 –∫ USB –∏ –ø–æ—Å–º–æ—Ç—Ä–∏ –≤ Device Manager ‚Üí Ports (COM & LPT)

–ù–∞–ø—Ä–∏–º–µ—Ä: **Silicon Labs CP210x USB to UART Bridge (COM3)**

#### 2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ—à–∏–≤–∫–∏
–û—Ç–∫—Ä–æ–π `tools\flash_ph.bat` –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ:
```batch
set "COM_PORT=COM3"  ‚Üê –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –ø–æ—Ä—Ç
```

#### 3. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É
```bash
tools\flash_ph.bat
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**
```bash
C:\Windows\system32\cmd.exe /k "C:\Espressif\idf_cmd_init.bat esp-idf-29323a3f5a0574597d6dbaa0af20c775 && cd node_ph && idf.py -p COM3 flash monitor"
```

#### 4. –û–∂–∏–¥–∞–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```
Writing at 0x00010000... (100%)
Wrote 1009744 bytes at 0x00010000 in 24.5 seconds...
Hash of data verified.

Leaving...
Hard resetting via RTS pin...
```

#### 5. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤ –º–æ–Ω–∏—Ç–æ—Ä–µ
```
I ph_node: ‚ïë  NODE pH Running! ‚úì  ‚ïë
```

---

### NODE EC

–ü–æ–≤—Ç–æ—Ä–∏ —Ç–µ –∂–µ —à–∞–≥–∏ –¥–ª—è node_ec:

#### 1. –û–ø—Ä–µ–¥–µ–ª–∏ COM –ø–æ—Ä—Ç
–ü–æ–¥–∫–ª—é—á–∏ –≤—Ç–æ—Ä–æ–π ESP32-C3

–ù–∞–ø—Ä–∏–º–µ—Ä: **COM4**

#### 2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Å–∫—Ä–∏–ø—Ç
`tools\flash_ec.bat`:
```batch
set "COM_PORT=COM4"  ‚Üê –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –ø–æ—Ä—Ç
```

#### 3. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É
```bash
tools\flash_ec.bat
```

#### 4. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏
```
I ec_node: ‚ïë  NODE EC Running! ‚úì  ‚ïë
```

---

## üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤ (–ø–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏)

### NODE pH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

**I2C —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–æ–±—â–∞—è —à–∏–Ω–∞):**
```
pH Sensor Trema (0x4D):
  VCC ‚Üí 3.3V
  GND ‚Üí GND
  SDA ‚Üí GPIO 8
  SCL ‚Üí GPIO 9

OLED SSD1306 (0x3C):
  VCC ‚Üí 3.3V
  GND ‚Üí GND
  SDA ‚Üí GPIO 8
  SCL ‚Üí GPIO 9
```

**–ù–∞—Å–æ—Å—ã:**
```
Pump pH UP:
  Control ‚Üí GPIO 2
  VCC ‚Üí 5V (—á–µ—Ä–µ–∑ MOSFET/—Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä)
  GND ‚Üí GND

Pump pH DOWN:
  Control ‚Üí GPIO 3
  VCC ‚Üí 5V (—á–µ—Ä–µ–∑ MOSFET/—Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä)
  GND ‚Üí GND
```

### NODE EC –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

**I2C —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–æ–±—â–∞—è —à–∏–Ω–∞):**
```
EC Sensor Trema (0x64):
  VCC ‚Üí 3.3V
  GND ‚Üí GND
  SDA ‚Üí GPIO 8
  SCL ‚Üí GPIO 9

OLED SSD1306 (0x3C):
  VCC ‚Üí 3.3V
  GND ‚Üí GND
  SDA ‚Üí GPIO 8
  SCL ‚Üí GPIO 9
```

**–ù–∞—Å–æ—Å—ã:**
```
Pump EC A:
  Control ‚Üí GPIO 2
  VCC ‚Üí 5V (—á–µ—Ä–µ–∑ MOSFET/—Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä)
  GND ‚Üí GND

Pump EC B:
  Control ‚Üí GPIO 3
  VCC ‚Üí 5V (—á–µ—Ä–µ–∑ MOSFET/—Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä)
  GND ‚Üí GND

Pump EC C:
  Control ‚Üí GPIO 4
  VCC ‚Üí 5V (—á–µ—Ä–µ–∑ MOSFET/—Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä)
  GND ‚Üí GND
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ë–µ–∑ –¥–∞—Ç—á–∏–∫–æ–≤ (Mock —Ä–µ–∂–∏–º)

–ï—Å–ª–∏ –¥–∞—Ç—á–∏–∫–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã, –Ω–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—Å—è –≤ mock —Ä–µ–∂–∏–º:

**–õ–æ–≥–∏ node_ph:**
```
W ph_sensor: pH sensor not found at 0x4D - will use default values
I ph_mgr: pH: 7.00 (target: 6.50)
```

**–õ–æ–≥–∏ node_ec:**
```
W ec_sensor: EC sensor not found at 0x64 - will use default values
I ec_mgr: EC: 2.00 (target: 2.50)
```

–≠—Ç–æ **–Ω–æ—Ä–º–∞–ª—å–Ω–æ** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ –¥–∞—Ç—á–∏–∫–æ–≤!

### 2. –° –¥–∞—Ç—á–∏–∫–∞–º–∏

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ –Ω–æ–¥—ã (–Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É RESET).

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
I ph_sensor: pH sensor initialized
I ec_sensor: EC sensor initialized
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ mesh –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–£–±–µ–¥–∏—Å—å —á—Ç–æ **ROOT node –∑–∞–ø—É—â–µ–Ω**!

**–õ–æ–≥–∏ –Ω–∞ –Ω–æ–¥–∞—Ö:**
```
I mesh_mgr: Mesh connected
I ph_mgr: Discovery sent: {"type":"discovery","node_id":"ph_XXXXXX",...}
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

–û—Ç–∫—Ä–æ–π http://localhost:3000 (–µ—Å–ª–∏ frontend –∑–∞–ø—É—â–µ–Ω)

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤—ã–µ –Ω–æ–¥—ã:
- **ph_XXXXXX** - NODE pH
- **ec_XXXXXX** - NODE EC

---

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to connect"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å COM –ø–æ—Ä—Ç (Device Manager)
2. –ó–∞–∫—Ä–æ–π –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ COM –ø–æ—Ä—Ç
3. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É BOOT –Ω–∞ ESP32-C3 –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—à–∏–≤–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: "Brownout detector"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑—É–π –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π USB –∫–∞–±–µ–ª—å
2. –ü–æ–¥–∫–ª—é—á–∏ –∫ USB –ø–æ—Ä—Ç—É –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (–Ω–µ —á–µ—Ä–µ–∑ HUB)
3. –ü—Ä–æ–≤–µ—Ä—å –ø–∏—Ç–∞–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "Mesh not connected"
**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Å—å —á—Ç–æ ROOT node –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å WiFi credentials (–¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å)
3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ MESH_ID –∏ MESH_PASSWORD —Å–æ–≤–ø–∞–¥–∞—é—Ç
4. –ü–æ–¥–æ–∂–¥–∏ 30-60 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "pH sensor not found"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ I2C (SDA=8, SCL=9)
2. –ü—Ä–æ–≤–µ—Ä—å –∞–¥—Ä–µ—Å –¥–∞—Ç—á–∏–∫–∞ (–º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç 0x4D)
3. –ü—Ä–æ–≤–µ—Ä—å –ø–∏—Ç–∞–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞ (3.3V)
4. –ò–ª–∏ —Ä–∞–±–æ—Ç–∞–π –≤ mock —Ä–µ–∂–∏–º–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±–æ—Ä–∫–∏

```
node_ph.bin:  1,009,744 bytes (67% —Å–≤–æ–±–æ–¥–Ω–æ)
node_ec.bin:  1,009,776 bytes (67% —Å–≤–æ–±–æ–¥–Ω–æ)

–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏: ~4 –º–∏–Ω—É—Ç—ã –Ω–∞ –∫–∞–∂–¥—É—é –Ω–æ–¥—É
–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä: GCC 14.2.0
ESP-IDF: v5.5.1
Target: ESP32-C3
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
- [ ] WiFi credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è WiFi
- [ ] COM –ø–æ—Ä—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] ROOT node –∑–∞–ø—É—â–µ–Ω

### –ü—Ä–æ—à–∏–≤–∫–∞ node_ph:
- [ ] COM –ø–æ—Ä—Ç —É–∫–∞–∑–∞–Ω –≤ flash_ph.bat
- [ ] –ü—Ä–æ—à–∏–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "NODE pH Running!"
- [ ] Mesh –ø–æ–¥–∫–ª—é—á–µ–Ω (–∏–ª–∏ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º)

### –ü—Ä–æ—à–∏–≤–∫–∞ node_ec:
- [ ] COM –ø–æ—Ä—Ç —É–∫–∞–∑–∞–Ω –≤ flash_ec.bat
- [ ] –ü—Ä–æ—à–∏–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "NODE EC Running!"
- [ ] Mesh –ø–æ–¥–∫–ª—é—á–µ–Ω (–∏–ª–∏ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º)

### –î–∞—Ç—á–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- [ ] pH –¥–∞—Ç—á–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –Ω–∞–π–¥–µ–Ω
- [ ] EC –¥–∞—Ç—á–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –Ω–∞–π–¥–µ–Ω
- [ ] OLED –¥–∏—Å–ø–ª–µ–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
- [ ] –ù–∞—Å–æ—Å—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã

---

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ—à–∏–≤–∫–µ!

–ò—Å–ø–æ–ª—å–∑—É–π —Å–∫—Ä–∏–ø—Ç—ã:
```bash
tools\flash_ph.bat
tools\flash_ec.bat
```

–ò–ª–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–∞–ø—Ä—è–º—É—é (–∑–∞–º–µ–Ω–∏ COM –ø–æ—Ä—Ç—ã):
```bash
# node_ph
cd node_ph
idf.py -p COM3 flash monitor

# node_ec
cd node_ec
idf.py -p COM4 flash monitor
```

---

**–£—Å–ø–µ—Ö–æ–≤ –≤ –ø—Ä–æ—à–∏–≤–∫–µ!** üöÄ

