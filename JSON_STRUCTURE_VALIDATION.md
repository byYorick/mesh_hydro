# ‚úÖ –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ JSON –°–û–û–ë–©–ï–ù–ò–ô

**–î–∞—Ç–∞:** 19.10.2025  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –í—Å–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –≤–æ –≤—Å–µ—Ö —É–∑–ª–∞—Ö

---

## üì® –¢–ò–ü–´ –°–û–û–ë–©–ï–ù–ò–ô (7 —à—Ç)

### 1. ‚úÖ HEARTBEAT (NODE ‚Üí ROOT ‚Üí MQTT)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "type": "heartbeat",
  "node_id": "climate_001",
  "uptime": 3600,
  "heap_free": 158044,
  "rssi_to_parent": -42
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `type` - string
- ‚úÖ `node_id` - string
- ‚úÖ `uptime` - number (uint32)
- ‚úÖ `heap_free` - number (uint32)
- ‚úÖ `rssi_to_parent` - number (int8)

**–ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- `node_climate/components/climate_controller/climate_controller.c:310`
- `node_ph_ec/components/ph_ec_manager/ph_ec_manager.c:412`

**–ö–æ–¥ (–ø—Ä–∏–º–µ—Ä Climate):**
```c
char heartbeat_msg[256];
snprintf(heartbeat_msg, sizeof(heartbeat_msg),
        "{\"type\":\"heartbeat\","
        "\"node_id\":\"%s\","
        "\"uptime\":%lu,"
        "\"heap_free\":%lu,"
        "\"rssi_to_parent\":%d}",
        s_config->base.node_id,
        (unsigned long)uptime,
        (unsigned long)heap_free,
        rssi);
```

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!**

---

### 2. ‚úÖ TELEMETRY (NODE ‚Üí ROOT ‚Üí MQTT)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ Climate:**
```json
{
  "type": "telemetry",
  "node_id": "climate_001",
  "timestamp": 1729346400,
  "data": {
    "temperature": 24.5,
    "humidity": 65.2,
    "co2": 820,
    "lux": 450,
    "rssi_to_parent": -42
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `mesh_protocol_create_telemetry()`
- ‚úÖ `data` - cJSON object
- ‚úÖ –í—Å–µ –ø–æ–ª—è numbers
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- `node_climate/components/climate_controller/climate_controller.c:340-361`
- `common/mesh_protocol/mesh_protocol.c:96-130` (—Ñ—É–Ω–∫—Ü–∏—è create)

**–ö–æ–¥:**
```c
cJSON *data = cJSON_CreateObject();
cJSON_AddNumberToObject(data, "temperature", temp);
cJSON_AddNumberToObject(data, "humidity", humidity);
cJSON_AddNumberToObject(data, "co2", co2);
cJSON_AddNumberToObject(data, "lux", lux);
cJSON_AddNumberToObject(data, "rssi_to_parent", rssi);

char json_buf[512];
mesh_protocol_create_telemetry(s_config->base.node_id, data, json_buf, sizeof(json_buf));

cJSON_Delete(data);
```

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è cJSON –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏)

---

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ pH/EC:**
```json
{
  "type": "telemetry",
  "node_id": "ph_ec_001",
  "timestamp": 1729346400,
  "data": {
    "ph": 6.5,
    "ec": 1.8,
    "temperature": 22.5,
    "ph_target": 6.5,
    "ec_target": 2.5,
    "pump_ph_up_ml": 120.5,
    "pump_ph_down_ml": 85.2,
    "pump_ec_a_ml": 250.0,
    "pump_ec_b_ml": 250.0,
    "pump_ec_c_ml": 50.0,
    "mode": "online",
    "emergency": true,
    "autonomous": false,
    "rssi_to_parent": -45
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –í—Å–µ —á–∏—Å–ª–∞ - numbers (–Ω–µ —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ `mode` - string ("online"/"autonomous")
- ‚úÖ `emergency`, `autonomous` - boolean (true/false)
- ‚úÖ –î–≤–æ–π–Ω—ã–µ `}}` –≤ –∫–æ–Ω—Ü–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –∑–∞–∫—Ä—ã–≤–∞—é—Ç data –∏ –≤–µ—Å—å –æ–±—ä–µ–∫—Ç)

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!**

---

### 3. ‚úÖ DISCOVERY (ROOT/NODE ‚Üí MQTT)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ ROOT:**
```json
{
  "type": "discovery",
  "node_id": "root_98a316f5fde8",
  "node_type": "root",
  "mac_address": "98:A3:16:F5:FD:E8",
  "firmware": "2.0.0",
  "hardware": "ESP32-S3",
  "heap_free": 192196,
  "heap_min": 190616,
  "flash_total": 4194304,
  "flash_used": 2097152,
  "wifi_rssi": -34,
  "capabilities": ["mesh_coordinator", "mqtt_bridge", "data_router"]
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `capabilities` - –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
- ‚úÖ –í—Å–µ —á–∏—Å–ª–∞ - numbers
- ‚úÖ MAC address - —Å—Ç—Ä–æ–∫–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º

**–ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- `root_node/components/mqtt_client/mqtt_client_manager.c:276-303`

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!**

---

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ NODE Climate:**
```json
{
  "type": "discovery",
  "node_id": "climate_001",
  "node_type": "climate",
  "mac_address": "00:4B:12:37:D5:A4",
  "firmware": "1.0.0",
  "hardware": "ESP32",
  "sensors": ["sht3x", "ccs811", "lux"],
  "heap_free": 158044,
  "wifi_rssi": -42
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `sensors` - –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
- ‚úÖ –í—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

**–ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- `node_climate/components/climate_controller/climate_controller.c:273-287`

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!**

---

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ NODE pH/EC:**
```json
{
  "type": "discovery",
  "node_id": "ph_ec_001",
  "node_type": "ph_ec",
  "mac_address": "XX:XX:XX:XX:XX:XX",
  "firmware": "1.0.0",
  "hardware": "ESP32-S3",
  "actuators": ["pump_ph_up", "pump_ph_down", "pump_ec_a", "pump_ec_b", "pump_ec_c"],
  "heap_free": 165000,
  "wifi_rssi": -45
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `actuators` - –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ (–≤–º–µ—Å—Ç–æ sensors)
- ‚úÖ –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Climate (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!**

---

### 4. ‚úÖ EVENT (NODE ‚Üí ROOT ‚Üí MQTT)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "type": "event",
  "node_id": "ph_ec_001",
  "timestamp": 1729346400,
  "level": "critical",
  "message": "pH out of safe range",
  "data": {
    "current_ph": 5.2,
    "target_ph": 6.5,
    "action": "pump_ph_up_activated"
  }
}
```

**–£—Ä–æ–≤–Ω–∏:**
- `info` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `warning` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- `critical` - –∫—Ä–∏—Ç–∏—á–Ω–æ
- `emergency` - –∞–≤–∞—Ä–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `level` - enum –∫–∞–∫ string
- ‚úÖ `data` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç
- ‚úÖ `timestamp` - number

**–ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- `common/mesh_protocol/mesh_protocol.c:170-210` (—Ñ—É–Ω–∫—Ü–∏—è create_event)

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!**

---

### 5. ‚úÖ COMMAND (MQTT ‚Üí ROOT ‚Üí NODE)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (Climate):**
```json
{
  "type": "command",
  "node_id": "climate_001",
  "command": "set_read_interval",
  "params": {
    "interval_ms": 30000
  }
}
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (pH/EC):**
```json
{
  "type": "command",
  "node_id": "ph_ec_001",
  "command": "set_targets",
  "params": {
    "ph_target": 6.2,
    "ec_target": 2.0
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `command` - string (–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ `params` - –æ–±—ä–µ–∫—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ MqttService

**–ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- Backend: `server/backend/app/Services/MqttService.php:581-594`
- –ü–∞—Ä—Å–∏—Ç—Å—è: `node_climate/main/app_main.c:59-63`
- –ü–∞—Ä—Å–∏—Ç—Å—è: `node_ph_ec/main/app_main.c:253-259`

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!**

---

### 6. ‚úÖ CONFIG (MQTT ‚Üí ROOT ‚Üí NODE)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "type": "config",
  "node_id": "climate_001",
  "config": {
    "read_interval_ms": 30000,
    "temp_target": 24.0,
    "humidity_target": 65.0,
    "co2_target": 800,
    "lux_target": 500
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `config` - –æ–±—ä–µ–∫—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

**–ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- `common/mesh_protocol/mesh_protocol.c:149-168` (—Ñ—É–Ω–∫—Ü–∏—è create_config)

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!**

---

### 7. ‚úÖ REQUEST/RESPONSE (Display ‚Üî ROOT)

**REQUEST:**
```json
{
  "type": "request",
  "from": "display_001",
  "request": "all_nodes_data"
}
```

**RESPONSE:**
```json
{
  "type": "response",
  "to": "display_001",
  "data": {
    "nodes": [
      {
        "node_id": "climate_001",
        "node_type": "climate",
        "online": true,
        "data": {...}
      },
      {
        "node_id": "ph_ec_001",
        "node_type": "ph_ec",
        "online": true,
        "data": {...}
      }
    ]
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `nodes` - –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ `online` - boolean

**–ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- REQUEST: `common/mesh_protocol/mesh_protocol.c:259-283`
- RESPONSE: `common/mesh_protocol/mesh_protocol.c:286-313`
- –û–±—Ä–∞–±–æ—Ç–∫–∞: `root_node/components/data_router/data_router.c:138-164`

‚úÖ **–í–∞–ª–∏–¥–Ω—ã–π JSON!**

---

## üîç –ü–†–û–í–ï–†–ö–ê –ù–ê –¢–ò–ü–ò–ß–ù–´–ï –û–®–ò–ë–ö–ò

### ‚ùå –û–®–ò–ë–ö–ê: Boolean –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞

```json
// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
{"online": "true"}

// –ü–†–ê–í–ò–õ–¨–ù–û ‚úÖ
{"online": true}
```

**–ü—Ä–æ–≤–µ—Ä–∏–ª:** ‚úÖ –í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

---

### ‚ùå –û–®–ò–ë–ö–ê: –ß–∏—Å–ª–∞ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏

```json
// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
{"temperature": "24.5"}

// –ü–†–ê–í–ò–õ–¨–ù–û ‚úÖ
{"temperature": 24.5}
```

**–ü—Ä–æ–≤–µ—Ä–∏–ª:** ‚úÖ –í—Å–µ —á–∏—Å–ª–∞ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫

---

### ‚ùå –û–®–ò–ë–ö–ê: –ù–µ–∑–∞–∫—Ä—ã—Ç—ã–µ —Å–∫–æ–±–∫–∏

```json
// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
{"data": {"temp": 24.5}  ‚Üê –Ω–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π }

// –ü–†–ê–í–ò–õ–¨–ù–û ‚úÖ
{"data": {"temp": 24.5}}
```

**–ü—Ä–æ–≤–µ—Ä–∏–ª:** ‚úÖ –í—Å–µ —Å–∫–æ–±–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### ‚ùå –û–®–ò–ë–ö–ê: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–ø—è—Ç—ã—Ö

```json
// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
{"temp": 24.5 "humidity": 65}

// –ü–†–ê–í–ò–õ–¨–ù–û ‚úÖ
{"temp": 24.5, "humidity": 65}
```

**–ü—Ä–æ–≤–µ—Ä–∏–ª:** ‚úÖ –í—Å–µ –∑–∞–ø—è—Ç—ã–µ –Ω–∞ –º–µ—Å—Ç–µ

---

### ‚ùå –û–®–ò–ë–ö–ê: Trailing comma

```json
// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå (JSON –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
{"temp": 24.5, "humidity": 65,}

// –ü–†–ê–í–ò–õ–¨–ù–û ‚úÖ
{"temp": 24.5, "humidity": 65}
```

**–ü—Ä–æ–≤–µ—Ä–∏–ª:** ‚úÖ –ù–µ—Ç trailing comma

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–ö–ò

### Heartbeat:

| –£–∑–µ–ª | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ | –°—Ç–∞—Ç—É—Å |
|------|------|--------|--------|
| Climate | climate_controller.c | 310 | ‚úÖ OK |
| pH/EC | ph_ec_manager.c | 412 | ‚úÖ OK (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ) |

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –£–¥–∞–ª—ë–Ω –ª–∏—à–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä `autonomous` –∏–∑ heartbeat pH/EC

---

### Telemetry:

| –£–∑–µ–ª | –ú–µ—Ç–æ–¥ | –°—Ç–∞—Ç—É—Å |
|------|-------|--------|
| Climate | cJSON API | ‚úÖ OK (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–∞–ª–∏–¥–Ω—ã–π) |
| pH/EC | snprintf | ‚úÖ OK (–ø—Ä–æ–≤–µ—Ä–µ–Ω –≤—Ä—É—á–Ω—É—é) |

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ pH/EC telemetry:**
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞—Å–æ—Å–æ–≤ (pump_*_ml)
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∂–∏–º (mode: "online"/"autonomous")
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Ñ–ª–∞–≥–∏ emergency/autonomous

---

### Discovery:

| –£–∑–µ–ª | –†–∞–∑–ª–∏—á–∏—è | –°—Ç–∞—Ç—É—Å |
|------|----------|--------|
| ROOT | `capabilities` array | ‚úÖ OK |
| Climate | `sensors` array | ‚úÖ OK |
| pH/EC | `actuators` array | ‚úÖ OK |

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –ö–∞–∂–¥—ã–π —É–∑–µ–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–π –Ω–∞–±–æ—Ä –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π!

---

### Command:

| –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –ú–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è | –°—Ç–∞—Ç—É—Å |
|-------------|----------------|--------|
| Backend ‚Üí MQTT | PHP json_encode() | ‚úÖ OK (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–Ω—ã–π) |
| –ü–∞—Ä—Å–∏–Ω–≥ –≤ NODE | mesh_protocol_parse() + cJSON | ‚úÖ OK |

---

### Config:

| –°–æ–∑–¥–∞—ë—Ç—Å—è | –ú–µ—Ç–æ–¥ | –°—Ç–∞—Ç—É—Å |
|-----------|-------|--------|
| common/mesh_protocol | cJSON API | ‚úÖ OK |

---

### Event:

| –°–æ–∑–¥–∞—ë—Ç—Å—è | –ú–µ—Ç–æ–¥ | –°—Ç–∞—Ç—É—Å |
|-----------|-------|--------|
| common/mesh_protocol | cJSON API | ‚úÖ OK |

---

### Request/Response:

| –°–æ–∑–¥–∞—ë—Ç—Å—è | –ú–µ—Ç–æ–¥ | –°—Ç–∞—Ç—É—Å |
|-----------|-------|--------|
| common/mesh_protocol | cJSON API | ‚úÖ OK |

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï JSON

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:

**1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ (cJSON):**
```c
cJSON *root = cJSON_CreateObject();
cJSON_AddStringToObject(root, "type", "telemetry");
// ...
char *json_str = cJSON_PrintUnformatted(root);  // ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–∞–ª–∏–¥–Ω—ã–π!
```

**2. –ü—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ (cJSON):**
```c
cJSON *root = cJSON_Parse(json_str);
if (root == NULL) {
    ESP_LOGE(TAG, "JSON parse error");  // ‚Üê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    return false;
}
```

**3. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ (snprintf):**
```c
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë –≤–ª–µ–∑–ª–æ –≤ –±—É—Ñ–µ—Ä:
if (strlen(json_str) >= max_len) {
    ESP_LOGW(TAG, "JSON too large: %d bytes", strlen(json_str));
    return false;
}
```

---

## üìä –†–ê–ó–ú–ï–†–´ JSON

| –¢–∏–ø | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π | –¢–∏–ø–∏—á–Ω—ã–π | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π |
|-----|-------------|----------|--------------|
| **HEARTBEAT** | 95 –±–∞–π—Ç | 97 –±–∞–π—Ç | 110 –±–∞–π—Ç |
| **TELEMETRY (Climate)** | 200 –±–∞–π—Ç | 250 –±–∞–π—Ç | 300 –±–∞–π—Ç |
| **TELEMETRY (pH/EC)** | 400 –±–∞–π—Ç | 600 –±–∞–π—Ç | 1000 –±–∞–π—Ç |
| **DISCOVERY** | 250 –±–∞–π—Ç | 300 –±–∞–π—Ç | 500 –±–∞–π—Ç |
| **COMMAND** | 100 –±–∞–π—Ç | 150 –±–∞–π—Ç | 400 –±–∞–π—Ç |
| **EVENT** | 150 –±–∞–π—Ç | 250 –±–∞–π—Ç | 500 –±–∞–π—Ç |
| **REQUEST** | 50 –±–∞–π—Ç | 80 –±–∞–π—Ç | 150 –±–∞–π—Ç |
| **RESPONSE** | 500 –±–∞–π—Ç | 2000 –±–∞–π—Ç | 4000 –±–∞–π—Ç |

**–ë—É—Ñ–µ—Ä—ã –≤ –∫–æ–¥–µ:**
- ‚úÖ Heartbeat: 256 –±–∞–π—Ç (–∑–∞–ø–∞—Å 2.6x)
- ‚úÖ Telemetry Climate: 512 –±–∞–π—Ç (–∑–∞–ø–∞—Å 2x)
- ‚úÖ Telemetry pH/EC: 1024 –±–∞–π—Ç (–∑–∞–ø–∞—Å 1.7x)
- ‚úÖ Discovery: 768 –±–∞–π—Ç (–∑–∞–ø–∞—Å 2.5x)
- ‚úÖ Response (ROOT): 2048 –±–∞–π—Ç (–∑–∞–ø–∞—Å 2x)

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (pH/EC heartbeat):
```json
{
  "type": "heartbeat",
  "node_id": "ph_ec_001",
  "uptime": 3600,
  "heap_free": 165000,
  "rssi_to_parent": -45,
  "autonomous": "true"  ‚Üê ‚ùå –°–¢–†–û–ö–ê –≤–º–µ—Å—Ç–æ boolean!
}
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```json
{
  "type": "heartbeat",
  "node_id": "ph_ec_001",
  "uptime": 3600,
  "heap_free": 165000,
  "rssi_to_parent": -45
}
```

‚úÖ **–£–¥–∞–ª—ë–Ω –ª–∏—à–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä** (autonomous –µ—Å—Ç—å –≤ telemetry, –Ω–µ –Ω—É–∂–µ–Ω –≤ heartbeat)

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:
- ‚úÖ HEARTBEAT (2 —É–∑–ª–∞) - OK
- ‚úÖ TELEMETRY (2 —É–∑–ª–∞) - OK
- ‚úÖ DISCOVERY (3 –≤–∞—Ä–∏–∞–Ω—Ç–∞) - OK
- ‚úÖ COMMAND - OK
- ‚úÖ CONFIG - OK
- ‚úÖ EVENT - OK
- ‚úÖ REQUEST/RESPONSE - OK

### –ù–∞–π–¥–µ–Ω–æ –æ—à–∏–±–æ–∫:
- ‚ùå 1 –æ—à–∏–±–∫–∞ –≤ pH/EC heartbeat (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

### –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- ‚úÖ –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö snprintf
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (cJSON)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –±—É—Ñ–µ—Ä–æ–≤

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –ò—Å–ø–æ–ª—å–∑—É–π cJSON –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ:

```c
// –•–û–†–û–®–û ‚úÖ
cJSON *data = cJSON_CreateObject();
cJSON_AddNumberToObject(data, "temperature", temp);
char *json_str = cJSON_PrintUnformatted(data);  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–Ω—ã–π!
```

### 2. –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –º–æ–∂–Ω–æ snprintf:

```c
// –î–û–ü–£–°–¢–ò–ú–û ‚úÖ (–¥–ª—è heartbeat - –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
snprintf(msg, size, "{\"type\":\"heartbeat\",\"node_id\":\"%s\",\"uptime\":%lu}", ...);
```

### 3. –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞:

```c
// –•–û–†–û–®–û ‚úÖ
if (strlen(json_str) >= buffer_size) {
    ESP_LOGW(TAG, "JSON too large!");
    return false;
}
```

---

**–í–°–ï JSON –°–¢–†–£–ö–¢–£–†–´ –ü–†–û–í–ï–†–ï–ù–´ –ò –í–ê–õ–ò–î–ù–´!** ‚úÖüéâ

