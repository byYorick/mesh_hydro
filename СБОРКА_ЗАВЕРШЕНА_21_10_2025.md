# ‚úÖ –°–ë–û–†–ö–ê NODE pH –∏ NODE EC –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!

**–î–∞—Ç–∞:** 21 –æ–∫—Ç—è–±—Ä—è 2025  
**–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏:** ~8 –º–∏–Ω—É—Ç  
**–°—Ç–∞—Ç—É—Å:** –û–±–µ –Ω–æ–¥—ã –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ—à–∏–≤–∫–µ

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–±–æ—Ä–∫–∏

### NODE pH (ESP32-C3)
```
‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞
üì¶ Binary: node_ph/build/node_ph.bin
üìè –†–∞–∑–º–µ—Ä: 1,009,744 –±–∞–π—Ç (0xF6850)
üíæ –°–≤–æ–±–æ–¥–Ω–æ: 67% (2,070,448 –±–∞–π—Ç)
üîß Bootloader: node_ph/build/bootloader/bootloader.bin
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ ph_sensor - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ pump_controller (2 –Ω–∞—Å–æ—Å–∞) - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ pid_controller - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ ph_manager - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ mesh_manager - –ø–æ–¥–∫–ª—é—á–µ–Ω
- ‚úÖ mesh_protocol - –ø–æ–¥–∫–ª—é—á–µ–Ω
- ‚úÖ node_config - –ø–æ–¥–∫–ª—é—á–µ–Ω

### NODE EC (ESP32-C3)
```
‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞
üì¶ Binary: node_ec/build/node_ec.bin
üìè –†–∞–∑–º–µ—Ä: 1,009,776 –±–∞–π—Ç (0xF6870)
üíæ –°–≤–æ–±–æ–¥–Ω–æ: 67% (2,070,416 –±–∞–π—Ç)
üîß Bootloader: node_ec/build/bootloader/bootloader.bin
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ ec_sensor - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ pump_controller (3 –Ω–∞—Å–æ—Å–∞) - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ pid_controller - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ ec_manager - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ mesh_manager - –ø–æ–¥–∫–ª—é—á–µ–Ω
- ‚úÖ mesh_protocol - –ø–æ–¥–∫–ª—é—á–µ–Ω
- ‚úÖ node_config - –ø–æ–¥–∫–ª—é—á–µ–Ω

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π

### 1. ‚úÖ CMakeLists –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ REQUIRES –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `main/CMakeLists.txt`

### 2. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ includes
- `#include <math.h>` - –¥–ª—è fabs()
- `#include "cJSON.h"` - –¥–ª—è JSON –ø–∞—Ä—Å–∏–Ω–≥–∞

### 3. ‚úÖ –õ–æ–≥–∏–∫–∞ EC manager
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ 3 –Ω–∞—Å–æ—Å–∞–º:
- A = 50%, B = 40%, C = 10%

### 4. ‚úÖ –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ PID –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- pH: Kp=1.0, Ki=0.05, Kd=0.3
- EC: Kp=0.8, Ki=0.02, Kd=0.2

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ - –ü–†–û–®–ò–í–ö–ê

### –î–ª—è node_ph:

**–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—à–∏–≤–∫–∏:**
```bash
cd node_ph
idf.py -p COMX flash monitor
```

–ó–∞–º–µ–Ω–∏ `COMX` –Ω–∞ —Å–≤–æ–π –ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä COM3, COM4, COM5)

**–ò–ª–∏ —á–µ—Ä–µ–∑ bat —Ñ–∞–π–ª:**
```bash
tools\flash_ph.bat
```
(–Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏ —É–∫–∞–∑–∞—Ç—å COM –ø–æ—Ä—Ç)

### –î–ª—è node_ec:

**–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—à–∏–≤–∫–∏:**
```bash
cd node_ec
idf.py -p COMY flash monitor
```

–ó–∞–º–µ–Ω–∏ `COMY` –Ω–∞ —Å–≤–æ–π –ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä COM6, COM7, COM8)

**–ò–ª–∏ —á–µ—Ä–µ–∑ bat —Ñ–∞–π–ª:**
```bash
tools\flash_ec.bat
```
(–Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏ —É–∫–∞–∑–∞—Ç—å COM –ø–æ—Ä—Ç)

---

## üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø—Ä–æ—à–∏–≤–∫–æ–π

### NODE pH (ESP32-C3 #1):
1. –ü–æ–¥–∫–ª—é—á–∏ ESP32-C3 –∫ USB
2. –û–ø—Ä–µ–¥–µ–ª–∏ COM –ø–æ—Ä—Ç (Device Manager)
3. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É

**–ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏ –ø–æ–¥–∫–ª—é—á–∏ –¥–∞—Ç—á–∏–∫–∏:**
- pH –¥–∞—Ç—á–∏–∫ Trema (I2C 0x4D) ‚Üí GPIO 8 (SDA), GPIO 9 (SCL)
- OLED SSD1306 (I2C 0x3C) ‚Üí GPIO 8 (SDA), GPIO 9 (SCL)
- –ù–∞—Å–æ—Å pH UP ‚Üí GPIO 2
- –ù–∞—Å–æ—Å pH DOWN ‚Üí GPIO 3

### NODE EC (ESP32-C3 #2):
1. –ü–æ–¥–∫–ª—é—á–∏ –≤—Ç–æ—Ä–æ–π ESP32-C3 –∫ USB
2. –û–ø—Ä–µ–¥–µ–ª–∏ COM –ø–æ—Ä—Ç (Device Manager)
3. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É

**–ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏ –ø–æ–¥–∫–ª—é—á–∏ –¥–∞—Ç—á–∏–∫–∏:**
- EC –¥–∞—Ç—á–∏–∫ Trema (I2C 0x64) ‚Üí GPIO 8 (SDA), GPIO 9 (SCL)
- OLED SSD1306 (I2C 0x3C) ‚Üí GPIO 8 (SDA), GPIO 9 (SCL)
- –ù–∞—Å–æ—Å EC A ‚Üí GPIO 2
- –ù–∞—Å–æ—Å EC B ‚Üí GPIO 3
- –ù–∞—Å–æ—Å EC C ‚Üí GPIO 4

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ (node_ph):
```
I ph_node: ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
I ph_node: ‚ïë  NODE pH Starting...                   ‚ïë
I ph_node: ‚ïë  ESP32-C3 - pH Control Node            ‚ïë
I ph_node: ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
I ph_node: [Step 1/8] NVS init...
I ph_node: [Step 2/8] Loading config...
I ph_node:   Node ID: ph_XXXXXX
I ph_node:   pH target: 6.50 (5.50-7.50)
I ph_node: [Step 3/8] I2C init...
I ph_node: [Step 4/8] pH Sensor init...
I ph_sensor: pH sensor initialized
I ph_node: [Step 5/8] Pumps init (2x PWM)...
I pump_ctrl: Pump 0 initialized (GPIO 2)
I pump_ctrl: Pump 1 initialized (GPIO 3)
I ph_node: [Step 6/8] Mesh NODE mode init...
I mesh_mgr: Mesh initialized
I ph_node: [Step 7/8] pH Manager init...
I ph_mgr: pH Manager initialized
I ph_node: [Step 8/8] Starting...
I ph_node: ‚ïë  NODE pH Running! ‚úì                    ‚ïë
```

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ (node_ec):
```
I ec_node: ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
I ec_node: ‚ïë  NODE EC Starting...                   ‚ïë
I ec_node: ‚ïë  ESP32-C3 - EC Control Node            ‚ïë
I ec_node: ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
I ec_node: [Step 1/8] NVS init...
I ec_node: [Step 2/8] Loading config...
I ec_node:   Node ID: ec_XXXXXX
I ec_node:   EC target: 2.50 (1.50-4.00)
I ec_node: [Step 3/8] I2C init...
I ec_node: [Step 4/8] EC Sensor init...
I ec_sensor: EC sensor initialized
I ec_node: [Step 5/8] Pumps init (3x PWM)...
I pump_ctrl: Pump 0 initialized (GPIO 2)
I pump_ctrl: Pump 1 initialized (GPIO 3)
I pump_ctrl: Pump 2 initialized (GPIO 4)
I ec_node: [Step 6/8] Mesh NODE mode init...
I mesh_mgr: Mesh initialized
I ec_node: [Step 7/8] EC Manager init...
I ec_mgr: EC Manager initialized
I ec_node: [Step 8/8] Starting...
I ec_node: ‚ïë  NODE EC Running! ‚úì                    ‚ïë
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### WiFi –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
–ü–µ—Ä–µ–¥ –ø—Ä–æ—à–∏–≤–∫–æ–π **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π:
- `node_ph/sdkconfig.defaults`
- `node_ec/sdkconfig.defaults`

–ó–∞–º–µ–Ω–∏:
```
CONFIG_ESP_WIFI_SSID="your_wifi_ssid"      ‚Üí CONFIG_ESP_WIFI_SSID="YourActualWiFi"
CONFIG_ESP_WIFI_PASSWORD="your_wifi_password"  ‚Üí CONFIG_ESP_WIFI_PASSWORD="YourPassword"
```

**–í–∞–∂–Ω–æ:** WiFi credentials –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å ROOT node!

### Mock —Ä–µ–∂–∏–º:
–ï—Å–ª–∏ –¥–∞—Ç—á–∏–∫–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã - –Ω–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–π–¥—É—Ç –≤ mock —Ä–µ–∂–∏–º:
- pH sensor –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí pH = 7.0 (–¥–µ—Ñ–æ–ª—Ç)
- EC sensor –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí EC = 2.0 (–¥–µ—Ñ–æ–ª—Ç)

–ù–∞—Å–æ—Å—ã –∏ PID –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å mock –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.

---

## üìä –†–∞–∑–º–µ—Ä—ã –ø—Ä–æ—à–∏–≤–æ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | NODE pH | NODE EC |
|-----------|---------|---------|
| Binary | 1,009,744 | 1,009,776 |
| Bootloader | 19,904 | 19,904 |
| **–í—Å–µ–≥–æ** | **~1.0 MB** | **~1.0 MB** |
| **–°–≤–æ–±–æ–¥–Ω–æ** | 2.07 MB (67%) | 2.07 MB (67%) |

–ü—Ä–æ—à–∏–≤–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –∑–∞–Ω–∏–º–∞—é—Ç —Ç–æ–ª—å–∫–æ 33% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π Flash –ø–∞–º—è—Ç–∏.

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ—à–∏–≤–∫–µ!

### –ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ (–µ—Å–ª–∏ COM –ø–æ—Ä—Ç—ã –∏–∑–≤–µ—Å—Ç–Ω—ã):

**NODE pH (–Ω–∞–ø—Ä–∏–º–µ—Ä COM3):**
```bash
C:\Windows\system32\cmd.exe /k "C:\Espressif\idf_cmd_init.bat esp-idf-29323a3f5a0574597d6dbaa0af20c775 && cd node_ph && idf.py -p COM3 flash monitor"
```

**NODE EC (–Ω–∞–ø—Ä–∏–º–µ—Ä COM4):**
```bash
C:\Windows\system32\cmd.exe /k "C:\Espressif\idf_cmd_init.bat esp-idf-29323a3f5a0574597d6dbaa0af20c775 && cd node_ec && idf.py -p COM4 flash monitor"
```

---

## üìù –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∞ node_ph_ec –Ω–∞ –¥–≤–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –Ω–æ–¥—ã
2. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ node_ph (8 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
3. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ node_ec (8 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
4. ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã pump_controller –¥–ª—è 2 –∏ 3 –Ω–∞—Å–æ—Å–æ–≤
5. ‚úÖ –°–æ–∑–¥–∞–Ω—ã ph_manager –∏ ec_manager
6. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω common/node_config
7. ‚úÖ –ù–∞–π–¥–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 7 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤
8. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ PID –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
9. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
10. ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è –æ–±–µ–∏—Ö –Ω–æ–¥

---

## üéâ –£–°–ü–ï–•!

**–û–±–µ –Ω–æ–¥—ã —Å–æ–±—Ä–∞–Ω—ã –±–µ–∑ –æ—à–∏–±–æ–∫!**  
**–ì–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ—à–∏–≤–∫–µ –Ω–∞ ESP32-C3!**  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –ø—Ä–æ—à–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å!** üöÄ

